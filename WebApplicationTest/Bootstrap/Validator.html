<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- 上述3个meta标签*必须*放在最前面，任何其他内容都*必须*跟随其后！ -->
    <title>bootstrap-validator</title>
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link href="../Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet"/>

    <!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
    <link href="../Scripts/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet"/>
    <link href="../Scripts/bootstrap/css/bootstrap-datetimepicker.min.css" rel="stylesheet"/>

    <link href="../Scripts/bootstrap/css/bootstrap-validator.css" rel="stylesheet"/>
    <link href="../Scripts/bootstrap/css/bootstrap-fileinput.css" rel="stylesheet"/>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="../Scripts/html5shiv.min.js"></script>
        <script src="../Scripts/respond.min.js"></script>
    <![endif]-->

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <!--<script src="https://cdn.bootcss.com/jquery/1.12.4/jquery.min.js"></script>-->
    <script src="../Scripts/jquery/jquery-1.12.4.min.js"></script>

    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <!--<script src="js/bootstrap.min.js"></script>-->


    <!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
    <!--<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>-->
    <script src="../Scripts/bootstrap/js/bootstrap.min.js"></script>
    <script src="../Scripts/bootstrap/js/bootstrap-datetimepicker.min.js"></script>
    <script src="../Scripts/bootstrap/js/locales/bootstrap-datetimepicker.zh-CN.js"></script>

    <script src="../Scripts/bootstrap/js/bootstrap-validator.js"></script>
    <script src="../Scripts/bootstrap/js/locales/bootstrap-validator-zh-CN.js"></script>
    <script src="../Scripts/bootstrap/js/bootstrap-fileinput.js"></script>
    <script src="../Scripts/bootstrap/js/locales/bootstrap-fileinput-zh-CN.js"></script>

    <style type="text/css">
        body { padding: 15px; }
        
    </style>

    <script type="text/javascript">

        var $inputfile = null;

        $(function () {

            $inputfile = $("#input_file");

            //$("#btnValidator").click(function() {});

            $("#btnSave").click(function() {
                // 提交验证 
                //var validator = $('#editModelForm').data('bootstrapValidator');

                // 加载验证
                var validFields = {
                    coursewareName: {
                        validators: {
                            notEmpty: {
                                message: '课件名称不能为空'
                            }
                        }
                    },
                    txtIdx: {
                        validators: {
                            notEmpty: {
                                message: '排序号码不能为空'
                            }
                            //,regexp: {
                            //    regexp: "^[0-9]*$",
                            //    message: '排序号必须是数字'
                            //}
                        }
                    }
                };

                // 验证
                $("#editModelForm").bootstrapValidator({
                    live: "enabled", //验证时机，enabled是内容有变化就验证（默认），disabled和submitted是提交再验证  
                    excluded: [":disabled", ":hidden", ":not(:visible)"], //排除无需验证的控件，比如被禁用的或者被隐藏的  
                    //submitButtons: submitbutton, //指定提交按钮，如果验证失败则变成disabled，但我没试成功，反而加了这句话非submit按钮也会提交到action指定页面  
                    message: "通用的验证失败消息", //好像从来没出现过  
                    feedbackIcons: {
                        //根据验证结果显示的各种图标  
                        valid: "glyphicon glyphicon-ok",
                        invalid: "glyphicon glyphicon-remove",
                        validating: "glyphicon glyphicon-refresh"
                    },
                    fields: validFields
                });

                //valid.validate();
                //if (!valid.isValid()) return;
            });

            //登录验证
            $("#editModelForm").bootstrapValidator({
                message: 'This value is not valid',
                excluded: [':disabled'],
                feedbackIcons: {
                    valid: 'glyphicon glyphicon-ok',
                    invalid: 'glyphicon glyphicon-remove',
                    validating: 'glyphicon glyphicon-refresh'
                },
                fields: {
                    coursewareName: {
                        validators: {
                            notEmpty: {
                                message: '课件名称不能为空'
                            }
                        }
                    },
                    txtIdx: {
                        validators: {
                            notEmpty: {
                                message: '排序号码不能为空'
                            }
                            //,regexp: {
                            //    regexp: "^[0-9]*$",
                            //    message: '排序号必须是数字'
                            //}
                        }

                    }
                }
            }).on('success.form.bv', function(e) {
                e.preventDefault();
                alert("验证通过");
            });


            FileInputInit($inputfile);
        });


        // 文件上传附加参数
        function inputfileExtraData() {
            var data = {
                //GroupId: $("#coursewareId").val(),
                //MediaType: $("#coursewareType").val()
                //, Md5: "" // 文件Hash值
            };
            return data;
        }

         function FileInputInit($input) {

            //先销毁上传 
            $input.fileinput("destroy");

            // 上传控件初始化
            $input.fileinput({
                showPreview: false,
                showUpload: false,
                uploadAsync: true, // 异步上传，默认
                minFileCount: 1, // 最少上传文件数量
                //maxFileCount: 1,// 允许最大上传数，可以多个，当前设置单个
                maxFileSize: 0, // 允许文件上传的最大尺寸，0为无限制
                enctype: "multipart/form-data",
                elErrorContainer: "#upload-file-errors",
                uploadExtraData: function (previewId, index) {
                    //注意这里，传参是json格式,后台直接使用对象属性接收，传递多个参数时，不要忘记里面大括号{}后面的分号
                    //，这里可以直接return {a:b}; 或者{a:b}都可以，但必须要有大括号包裹
                    //var data = {
                    //    CoursewareId: $("#coursewareId").val(),
                    //    MediaType: $("#coursewareType").val()
                    //};
                    return inputfileExtraData(); // 文件上传附加参数
                },
                //allowedFileExtensions: Processist.FileInput.AllowedFileExtensions(type),
                //uploadUrl: "/Handler/FileInputHandler.ashx",
                slugCallback: function (text) {
                    var newtext = (!text || text == "") ? "" : String(text).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g, "_");
                    //去除空格
                    return newtext.replace(/(^\s+)|(\s+$)/g, "").replace(/\s/g, "");
                }
            }).on("fileuploaded", function (event, params, previewId, index) {
                console.log("file uploaded", event, params);
                //debugger;
                //inputfileMessage(params); // 文件上传完成后消息处理
            }).on("filebatchselected", function (event, files) {
                console.log("filebatchselected", event, files);
                //$inputfile.fileinput("upload"); // 选中文件后自动上传
            }).on("filebatchpreupload", function (event, data) {
                console.log("filebatchpreupload", event, data);
                //var n = data.files.length, files = n > 1 ? n + ' files' : 'one file';
                //if (!window.confirm("Are you sure you want to upload " + files + "?")) {
                //    return {
                //        message: "Upload aborted!", // upload error message
                //        data: {} // any other data to send that can be referred in `filecustomerror`
                //    };
                //}
            }).on("filebatchpreupload", function (event, data, id, index) {
                console.log("filebatchpreupload", event, data);
                //$('#kv-success-2').html('<h4>Upload Status</h4><ul></ul>').hide();
            }).on("filebatchuploadsuccess", function (event, data) {
                console.log("filebatchuploadsuccess", event, data);
                //var out = '';
                //$.each(data.files, function (key, file) {
                //    var fname = file.name;
                //    out = out + '<li>' + 'Uploaded file # ' + (key + 1) + ' - ' + fname + ' successfully.' + '</li>';
                //});
                //$('#kv-success-2 ul').append(out);
                //$('#kv-success-2').fadeIn('slow');

            });
        };



    </script>
</head>
<body>

<div class="container">
    <button type="button" id="btnValidator" class="btn btn-success" data-toggle="modal" data-target="#editModal">
        <span class="glyphicon glyphicon-paperclip" aria-hidden="true"></span> 数据验证测试
    </button>

</div>

<div class="modal fade" id="editModal" tabindex="-1" role="dialog" aria-labelledby="editModalLabel">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="editModalLabel">数据编辑</h4>
            </div>
            <div class="modal-body">

                <form class="form-horizontal" role="form" id="editModelForm">

                    <div class="form-group">
                        <label for="coursewareType" class="col-xs-6 col-sm-6 col-md-2 col-lg-2 control-label">课件类型<span class="required">&nbsp;*</span></label>
                        <div class="col-xs-18 col-sm-18 col-md-10 col-lg-10">
                            <select class="form-control" id="coursewareType">
                                <option value="0">通用课件</option>
                                <option value="2">视频</option>
                                <option value="3">音频</option>
                                <option value="1">图片</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="coursewareName" class="col-xs-6 col-sm-6 col-md-2 col-lg-2 control-label">课件名称<span class="required">&nbsp;*</span></label>
                        <div class="col-xs-18 col-sm-18 col-md-10 col-lg-10">
                            <input type="text" class="form-control" id="coursewareName" name="coursewareName" placeholder="课件名称..." required>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="coursewareTime" class="col-xs-6 col-sm-6 col-md-2 col-lg-2 control-label">课件学时<span class="required">&nbsp;*</span></label>
                        <div class="col-xs-18 col-sm-18 col-md-10 col-lg-10">
                            <input type="number" class="form-control" id="coursewareTime" name="coursewareTime" value="0" min="0" max="999">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="coursewareTime" class="col-xs-6 col-sm-6 col-md-2 col-lg-2 control-label">排序号码<span class="required">&nbsp;*</span></label>
                        <div class="col-xs-18 col-sm-18 col-md-10 col-lg-10">
                            <input type="text" class="form-control" id="txtIdx" name="txtIdx">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="col-xs-6 col-sm-6 col-md-2 col-lg-2 control-label" for="input_file">课件上传<span class="required">&nbsp;&nbsp;</span></label>
                        <div class="col-xs-18 col-sm-18 col-md-10 col-lg-10">
                            <div class="file-loading">
                                <input id="input_file" type="file">
                            </div>
                            <div id="upload-file-errors"></div>
                        </div>
                    </div>

                </form>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">
                    <span class="glyphicon glyphicon-floppy-remove" aria-hidden="true"></span> 关闭
                </button>
                <button type="button" id="btnSave" class="btn btn-primary">
                    <span class="glyphicon glyphicon-floppy-saved" aria-hidden="true"></span> 保存
                </button>
            </div>
        </div>
    </div>
</div>

</body>
</html>