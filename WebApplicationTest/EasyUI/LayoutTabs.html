<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>布局中Tabs测试</title>
    <link href="/Scripts/themes/default/easyui.css" rel="stylesheet"/>
    <link href="/Scripts/themes/icon.css" rel="stylesheet"/>
    <!--<link href="/Scripts/themes/mobile.css" rel="stylesheet"/>-->
    <!--<link href="/Styles/main.css" rel="stylesheet"/>-->

    <script src="/Scripts/jquery/jquery-1.12.4.min.js"></script>
    <script src="/Scripts/jquery/jquery-migrate-1.4.1.min.js"></script>
    <!--<script src="/Scripts/jquery-1.8.3.min.js"></script>-->
    <script src="/Scripts/jquery.easyui.min.js"></script>
    <!--<script src="/Scripts/jquery.easyui.mobile.js"></script>-->
    <script src="/Scripts/locale/easyui-lang-zh_CN.js"></script>

    <script src="/Scripts/Hsp.js"></script>
    <script src="/Scripts/Hsp.Common.js"></script>

    <style type="text/css">
        * { font-family: 微软雅黑; }
        html, body{ padding: 0px;margin: 0px;}
    </style>

    <script type="text/javascript">

        var height = 0, width = 0, tabId = 0, catalogId = 0;

        $(function() {
            height = HSP.Common.AvailHeight();
            width = HSP.Common.AvailWidth();

            if (HSP.Browser.IS_FF) {
                height -= 1;
            }

            if (HSP.Browser.IS_GC) {
                height += 80;
            }

            //<div id="layout" class="easyui-layout" fit="true" style="width:' + width + 'px;height:' + height + 'px;padding2px;">\
            //    <div region="west" split="true" collapsible="false" border="false" style="width: 200px;">\
            //        <div id="typeList"></div>\
            //    </div>\
            //    <div region="center" fit="true" plain="true" style="height: 525px;">\
            //        <div class="easyui-tabs" id="tabs">\
            //            <div title="待办任务" style="height: 510px; padding: 5px;">\
            //                <table id="todoTaskList"></table>\
            //            </div>\
            //            <div title="已办任务" style="height: 510px; padding: 5px;">\
            //                <table id="doneTaskList"></table>\
            //            </div>\
            //            <div title="抄送任务" style="height: 510px; padding: 5px;">\
            //                <div id="copyTaskLayout" region="north" split="false" border="false" style="height: 460px; margin: 0px; padding: 0px; width: 100%;">\
            //                    <iframe id="copyTask" src="" width="100%" height="460" frameborder="0" marginheight="0" marginwidth="0" border="0" scrolling="no"></iframe>\
            //                </div>\
            //            </div>\
            //        </div>\
            //    </div>\
            //</div>\

            var obj = $('\
                <div class="easyui-panel" title="我的任务" style="width:' + (width - 0) + 'px;height:' + (height - 0) + 'px;padding:2px;">\
                    <div id="layout" class="easyui-layout" style="width:' + (width - 6) + 'px;height:' + (height - 33) + 'px;">\
                        <div region="west" split="true" collapsible="false" border="false" style="width: 200px;">\
                            <div id="typeList"></div>\
                        </div>\
                        <div region="center" fit="true" plain="true" style="height: 525px;">\
                            <div class="easyui-tabs" id="tabs" style="width:' + (width - 208) + 'px;height:' + (height - 35) + 'px;overflow: hidden;">\
                                <div title="待办任务" style="height: 510px; padding: 5px;">\
                                    <table id="todoTaskList"></table>\
                                </div>\
                                <div title="已办任务" style="height: 510px; padding: 5px;">\
                                    <table id="doneTaskList"></table>\
                                </div>\
                                <div title="抄送任务" style="height: 510px; padding: 5px;">\
                                    <div id="copyTaskLayout" region="north" split="false" border="false" style="height: 460px; margin: 0px; padding: 0px; width: 100%;">\
                                        <iframe id="copyTask" src="" width="100%" height="460" frameborder="0" marginheight="0" marginwidth="0" border="0" scrolling="no"></iframe>\
                                    </div>\
                                </div>\
                            </div>\
                        </div>\
                    </div>\
                </div>\
            ');

            obj.appendTo($('body'));
            $.parser.parse();
            //$("#myTaskTabs").css("height", height);
            //$("#myTaskTabs").tabs({});




            //$("#titlePanel").panel({
            //    width: 'auto',
            //    height: height + 21,
            //    title: "我的任务"
            //});

            //$("#tabs").tabs({
            //    width: 'auto',
            //    height: (height - 6),
            //    onSelect: function(title, index) {
            //        tabId = index;
            //        //getTabContents(index);
            //    }
            //});

            showTypeList();

            // 首次加载Tab要预先调用
            showTaskMgmtList();


        });

        /// <summary>
        /// 显示选中Tab页
        /// </summary>
        /// <history> </history> 
        function getTabContents(index) {
            switch (index) {
                case 0:
                    // 我的待办任务 
                    //getTodoTaskList();
                    break;
                case 1:
                    // 我的已办任务
                    //getDoneTaskList();
                    break;
                case 2:
                    // 我的抄送任务
                    //$('#copyTask').attr('src', '../../../../ebsys/fceform/common/djframe.htm?djsn=wf_copytask_list&djtype=WF');
                    break;
                default:
            }
        }

        // 发起任务分类列表
        function showTypeList() {
            // 单击datagrid单元格事件
            var onClickRow = function (index, row) {
                catalogId = row.id;
                getTabContents(tabId);
            }

            $('#typeList').datagrid({
                fit: true,
                fitColumns: true,
                nowrap: false,
                striped: true,
                singleSelect: true,
                collapsible: true,

                pagination: false,
                rownumbers: true,
                //url: '/SystemMgmt/EWorkFlow/GetStartWorkflowList?rnd=' + (Math.random() * 16),
                onClickRow: onClickRow,
                columns: [
                    [
                        { field: 'id', title: '分类编号', width: 60, align: 'left', hidden: true },
                        {
                            field: 'name',
                            title: '分类名称',
                            width: 80,
                            align: 'left',
                            formatter: function (val, rowData, rowIndex) {
                                return '<a title=' + val + ' href="javascript:void(0);" style="text-decoration: none">' + val + '</a>';
                            }
                        }
                    ]
                ]
            });
        }

        // 增加用户控件显示方法，管正学, 2012/1/4
        function showTaskMgmtList() {

            $('#todoTaskList').datagrid({
                fit: true,
                fitColumns: true,
                nowrap: false,
                striped: true,
                singleSelect: true,
                collapsible: true,

                sortName: 'StatusTime',
                sortOrder: 'desc',
                pageSize: 15,
                pageList: [50, 30, 15],
                idField: '任务编号',
                pagination: true,
                rownumbers: true,
                frozenColumns: [
                    [
                        { field: 'wf_id', title: '编号', width: 45, align: 'center' },
                        {
                            field: 'activityname',
                            title: '流程名称',
                            width: 100,
                            align: 'center',
                            formatter: function (value, rec, index) {
                                return '<a title="' + value + '" >' + value + '</a>';
                            }
                        },
                        {
                            field: 'task_name',
                            title: '任务名称',
                            width: 200,
                            formatter: function (value, rec, index) {
                                var myVoid = "uf_doActionList('" + rec.wf_id + "','" + rec.step_id + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.wf_name + "','" + rec.wf_description + "','" + rec.wf_version + "','','','" + rec.task_id + "','formframe.htm')";
                                return '<a href="javascript:void(0);" title="' + value + '" onclick="' + myVoid + '" >' + value + '</a>';
                            }
                        }
                    ]
                ],
                columns: [
                    [
                        { field: 'task_type', title: '任务类型', width: 75, align: 'center', hidden: true },
                        { field: 'task_id', title: '任务ID', width: 75, align: 'center', hidden: true },
                        //{ field: 'task_status', title: '任务状态', width: 60, align: 'center' },
                        { field: 'create_date', title: '创建时间', width: 90, editor: 'datetimebox' },
                        { field: 'sponsor_name', title: '任务发起人', width: 60, align: 'center' },
                        { field: 'sponsor_dept_name', title: '发起部门', width: 90, align: 'left' },
                        { field: 'create_user', title: '最近办理人', width: 60, align: 'center' },
                        { field: 'finish_days', title: '办理时限', width: 45, align: 'center' },
                        {
                            field: 'lightvalue',
                            title: '状态',
                            width: 45,
                            align: 'center',
                            formatter: function (value, rec, index) {
                                if (value == 0) {
                                    return '<img src="/Content/images/Canvas/green.png" />';
                                } else if (value == 1) {
                                    return '<img src="/Content/images/Canvas/orange.png" />';
                                } else {
                                    return '<img src="/Content/images/Canvas/red.png" />';
                                }
                            }
                        },
                        {
                            field: 'instanceShow',
                            title: '查看',
                            width: 60,
                            align: 'center',
                            hidden: true,
                            formatter: function (value, rec, index) {
                                //var myVoid = "uf_showFlow('" + rec.wf_id + "')";
                                var myVoid = "MSD.Graph.showWorkflowTrack('" + rec.wf_name + "','" + rec.wf_id + "')";
                                return '<a title="任务轨迹" href="javascript:void(0);" onclick="' + myVoid + '" >任务轨迹</a>';
                            }
                        },
                        {
                            field: 'operate',
                            title: '操作',
                            width: 60,
                            align: 'center',
                            formatter: function (value, rec, index) {
                                var html = "";
                                var myVoid = "MSD.Graph.showWorkflowTrack('" + rec.wf_name + "','" + rec.wf_id + "')";
                                html += '<a title="任务轨迹" href="javascript:void(0);" onclick="' + myVoid + '" ><img alt="任务轨迹" src="/Content/images/viewtrack.png"></a>';
                                //myVoid = "uf_doActionList('" + rec.wf_id + "','" + rec.step_id + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.wf_name + "','" + rec.wf_description + "','" + rec.wf_version + "','','','" + rec.task_id + "','djframe.htm')";
                                //html += '&nbsp;<a title="老版执行任务" href="javascript:void(0);" onclick="' + myVoid + '"><img style="border:0px;" width="16" height="16" alt="执行任务" src="/Content/images/execute.png"></a>';
                                myVoid = "uf_doActionList('" + rec.wf_id + "','" + rec.step_id + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.wf_name + "','" + rec.wf_description + "','" + rec.wf_version + "','','','" + rec.task_id + "','formframe.htm')";
                                html += '&nbsp;<a title="新版执行任务" href="javascript:void(0);" onclick="' + myVoid + '"><img style="border:0px;" width="16" height="16" alt="执行任务" src="/Content/images/View_16x16.png"></a>';
                                if (rec.candelete == 1) {
                                    myVoid = "uf_delMyTask('" + rec.wf_id + "')";
                                    html += '&nbsp;<a title="删除任务" href="javascript:void(0);" onclick="' + myVoid + '"><img alt="删除任务" src="/Content/images/del-sc.png"></a>';
                                }
                                return html;
                            }
                        }
                    ]
                ],
                toolbar: []
            });

            // 已完任务列表
            $('#doneTaskList').datagrid({
                fit: true,
                fitColumns: true,
                nowrap: true,
                striped: true,
                singleSelect: true,
                collapsible: true,

                sortName: 'StatusTime',
                sortOrder: 'desc',
                pageSize: 15,
                pageList: [50, 30, 15],
                idField: '任务编号',
                pagination: true,
                rownumbers: true,
                frozenColumns: [
                    [
                        { field: 'wf_id', title: '编号', width: 45, align: 'center' },
                        {
                            field: 'task_name',
                            title: '任务名称',
                            width: 245,
                            formatter: function (value, rec, index) {
                                var myVoid;
                                if ($.browser.msie != true) {
                                    myVoid = "alert('对不起，查看任务表单目前只支持在IE浏览器上进行！')";
                                } else {
                                    myVoid = "uf_showdj('" + rec.wf_id + "','" + rec.step_id + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.wf_name + "','" + rec.wf_description + "','" + rec.wf_version + "','','','" + rec.trace_id + "','" + rec.task_id + "','formframe.htm')";
                                }
                                return '<a title="' + value + '" href="javascript:void(0);" onclick="' + myVoid + '" >' + value + '</a>';
                            }
                        }
                    ]
                ],
                columns: [
                    [
                        { field: 'task_type', title: '任务类型', width: 80, align: 'left', hidden: true },
                        { field: 'task_id', title: '任务ID', width: 75, align: 'center', hidden: true },
                        { field: 'task_status', title: '状态', width: 45, align: 'center' },
                        { field: 'create_date', title: '创建时间', width: 65, align: 'center', editor: 'datetimebox' },
                        { field: 'finish_date', title: '完成时间', width: 65, align: 'center', editor: 'datetimebox' },
                        { field: 'sponsor_name', title: '任务发起人', width: 65, align: 'center' },
                        { field: 'sponsor_dept_name', title: '发起部门', width: 65, align: 'left' },
                        { field: 'finish_days', title: '要求时限', width: 60, align: 'center' },
                        {
                            field: 'lightvalue',
                            title: '状态',
                            width: 45,
                            align: 'center',
                            formatter: function (value, rec, index) {
                                if (value == 0) {
                                    return '<img src="/Content/images/Canvas/green.png" />';
                                } else if (value == 1) {
                                    return '<img src="/Content/images/Canvas/orange.png" />';
                                } else {
                                    return '<img src="/Content/images/Canvas/red.png" />';
                                }
                            }
                        },
                        {
                            field: 'instanceShow',
                            title: '查看',
                            width: 60,
                            align: 'center',
                            hidden: true,
                            formatter: function (value, rec, index) {
                                //var myVoid = "uf_showFlow('" + rec.wf_id + "')";
                                var myVoid = "MSD.Graph.showWorkflowTrack('" + rec.wf_name + "','" + rec.wf_id + "')";
                                return '<a title="任务轨迹" href="javascript:void(0);" onclick="' + myVoid + '" >任务轨迹</a>';
                            }
                        },
                        {
                            field: 'operate',
                            title: '操作',
                            width: 45,
                            align: 'center',
                            formatter: function (value, rec, index) {
                                var html = "";
                                var myVoid = "MSD.Graph.showWorkflowTrack('" + rec.wf_name + "','" + rec.wf_id + "')";
                                html += '<a title="任务轨迹" href="javascript:void(0);" onclick="' + myVoid + '" ><img alt="任务轨迹" src="/Content/images/viewtrack.png"></a>';
                                //if (parent.Hitech.Common.CurrentUser.isSuperUser) {
                                myVoid = "doRevoke('" + rec.wf_id + "','" + rec.wf_name + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.trace_id + "')";
                                html += '&nbsp;<a title="撤回" href="javascript:void(0);" onclick="' + myVoid + '" ><img alt="撤回" src="/Content/images/revoke.png"></a>';

                                //myVoid = "uf_doRevokeStep('" + rec.wf_id + "','" + rec.wf_name + "','" + rec.action_id + "','" + rec.dynamic_instance_id + "','" + rec.wf_version + "')";
                                //html += '&nbsp;<a title="跳转到" href="javascript:void(0);" onclick="' + myVoid + '" ><img alt="跳转到" src="/Content/images/revoke.png"></a>';
                                //}
                                return html;
                            }
                        }
                    ]
                ],
                toolbar: []
            });
        }


    </script>
</head>
<body>


<!--    <div id="titlePanel" style="padding: 2px;">
        <div class="easyui-tabs" id="tabs">

            <div title="待办任务" style="height: 510px; padding: 5px;">

                <div id="layout" class="easyui-layout" fit="true">
                    <div region="west" split="true" collapsible="false" border="false" style="width: 200px;">
                        <div id="typeList"></div>
                    </div>
                    <div region="center" fit="true" plain="true" style="height: 525px;">
                        <table id="todoTaskList"></table>
                    </div>
                </div>

            </div>

            <div title="已办任务" style="height: 510px; padding: 5px;">
                <table id="doneTaskList"></table>
            </div>

            <div title="抄送任务" style="height: 510px; padding: 5px;">
                <div id="copyTaskLayout" region="north" split="false" border="false" style="height: 460px; margin: 0px; padding: 0px; width: 100%;">
                    <iframe id="copyTask" src="" width="100%" height="460" frameborder="0" marginheight="0" marginwidth="0" border="0" scrolling="no"></iframe>
                </div>
            </div>

        </div>
    </div>-->

</body>
</html>