<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>媒体测试</title>
    <link href="/Scripts/themes/default/easyui.css" rel="stylesheet" />
    <link href="/Scripts/themes/color.css" rel="stylesheet" />
    <link href="/Scripts/themes/icon.css" rel="stylesheet" />
    <link href="/Scripts/bootstrap/css/bootstrap.min.css" rel="stylesheet" />
    <link href="/Scripts/bootstrap/css/bootstrap-theme.min.css" rel="stylesheet" />
    <link href="/Scripts/bootstrap/css/font-awesome.css" rel="stylesheet" />
    <script src="/Scripts/jquery/jquery-1.12.4.min.js"></script>
    <script src="/Scripts/jquery/jquery-migrate-1.4.1.min.js"></script>

    <script src="/Scripts/jquery.easyui.min.js"></script>
    <script src="/Scripts/locale/easyui-lang-zh_CN.js"></script>
    <script src="/Scripts/bootstrap/js/bootstrap.min.js"></script>

    <script src="/Scripts/Hsp.js"></script>

    <style type="text/css">
        body {
            margin: 10px;
        }

        video {
            border: 1px solid #ccc;
            width: 100%;
        }
    </style>

    <script type="text/javascript">

        //播放大视频文件等待下载时间过长的缺陷，，本身就不是HTML5的问题，一是你服务器问题，2是你视频格式问题。
        //Flash插件播放fla的传统方式上：这个现在YOUKU基本上FLV格式。。。
        //建议你可以在服务器上装流媒体服务，然后用HTML5点播地址，不要直接HTML5读取视频地址，没人会这样做，除非只是非常小，非常短的的视频文件

        //- Media.currentSrc; //返回当前资源的URL
        //- Media.src = value; //返回或设置当前资源的URL
        //Media.controls;//是否有默认控制条
        //Media.currentTime = value; //当前播放的位置，赋值可改变位置
        //Media.duration; //当前资源长度 流返回无限
        //Media.ended; //是否结束
        //Media.poster：视频封面，没有播放时显示的图片

        //paused:true

        var $media = null, $track = null, controlbar = null, videoUrl = "";

        $(function () {

            $media = $('#media')[0], $track = $("track")[0];
            videoUrl = "华润电力宣传片2016最新.mp4";

            //alert(HSP.Browser.IS_IE || HSP.Browser.IS_IE11);

            // 快退，-30S
            $('#btnFastBack').bind('click', function () {
                $media.currentTime = $media.currentTime - 30.0;
                $media.play();
            });

            // 播放 / 暂停
            $('#btnPlay').bind('click', function () {
                if (!$media.currentSrc) $media.src = videoUrl;
                $media.play();

                if ($(this).attr("title") == "暂停") {
                    $(this).html('<i class="glyphicon glyphicon-play"></i>');
                    $(this).attr("title", "播放");
                    $media.pause();
                } else {
                    $(this).html('<i class="glyphicon glyphicon-pause"></i>');
                    $(this).attr("title", "暂停");
                    $media.play();
                }
            });

            // 暂停 / 播放
            $('#btnPause').bind('click', function () {

                //alert(this.value);

                $media.pause();

                //if ($media.pause()) {
                //    $media.play();
                //} else {
                //    $media.pause();
                //}
            });

            // 停止
            $('#btnStop').bind('click', function () {
                $media.pause();
                $media.currentTime = 0;

                var $play = $("#btnPlay");
                if ($play.attr("title") == "暂停") {
                    $play.html('<i class="glyphicon glyphicon-play"></i>');
                    $play.attr("title", "播放");
                }
            });

            // 快进，+30S
            $('#btnFastForward').bind('click', function () {
                $media.currentTime = $media.currentTime + 30.0;
                $media.play();
            });

            // 重新播放
            $('#btnReplay').unbind('click').bind("click", function () {
                $media.src = "华润电力宣传片2016最新.mp4";
                $media.controls = true; // 是否有默认控制条
                try {
                    $media.currentTime = 0.0;
                } catch (e) {

                }

                $media.play();
                //var h264Test = $media.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
                //play("MP4");
            });

            if (HSP.Browser.IS_IE || HSP.Browser.IS_IE11) {
                $('#btnResumePlay').attr("disabled", "disabled");
            } else {
                // 继续播放
                $('#btnResumePlay').unbind('click').bind("click", function () {

                    //debugger;

                    $media.src = "华润电力宣传片2016最新.mp4";
                    $media.controls = true; // 是否有默认控制条
                    $media.load(); //重新加载src指定的资源
                    $media.preload = "preload";

                    ////var readyState = $media.readyState();
                    ////$("#txtMediaMessage").val($("#txtMediaMessage").val() + "状态：" + readyState + "\n");

                    var value = $("#txtCurrentTime").val();
                    if (value.length == 0) value = "0";

                    //$media.attr("data-start", value);seek();

                    //$("#txtMediaMessage").val("开始：" + value + "\n"); data-start
                    try {
                        $media.currentTime = parseInt(value); //当前播放的位置，赋值可改变位置，IE浏览器不支持
                    } catch (e) {

                    }

                    if ($media.paused) $media.play();

                });
            }

            $('#mp4').unbind('click').bind("click", function () {

                $media.src = "华润电力宣传片2016最新.mp4";
                //$media.width = 1280, $media.height = 720;
                $media.controls = true; // 是否有默认控制条

                //if ($media.paused) {
                //    $media.play();
                //} else {
                //    $media.pause();
                //}

                var h264Test = $media.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');

                if (h264Test) {
                    play("MP4");
                } else {
                    alert("抱歉，媒体不支持！");
                }
            });

            $('#ogv').unbind('click').bind("click", function () {

                $media.src = "OgvTest.ogv";
                $media.width = 672, $media.height = 378;

                //检测是否可以播放ogg格式的视频
                var oggTest = $media.canPlayType('video/ogg; codecs="theora, vorbis"');

                if (oggTest) {
                    play("OGV");
                }
            });

            $('#webm').unbind('click').bind("click", function () {
                $media.pause();
                $media.src = "phfx_4KHD_VP9TestFootage.webm";
                $media.width = 672, $media.height = 378;

                //alert(!!$media.canPlayType);
                //play("WebM");

                //检测是否可以播放WebM格式的视频
                var webmTest = $media.canPlayType('video/webm; codecs="vp8.0, vorbis"');

                if (webmTest) {
                    play("WebM");
                }
            });

            if (HSP.Browser.IS_IE) {
                //使用事件监听方式捕捉事件
                //$media.attachEvent("ontimeupdate", function () {
                //    var timeDisplay = document.getElementById("time");
                //    //用秒数来显示当前播放进度
                //    timeDisplay.innerHTML = Math.floor($media.currentTime) + "／" + Math.floor($media.duration) + "（秒）";
                //}, false);

                $media.attachEvent("onerror", function () {
                    var error = $media.error;
                    switch (error.code) {
                        case 1:
                            alert('取回过程被用户中止。');
                            break;
                        case 2:
                            alert('当下载时发生错误。');
                            break;
                        case 3:
                            alert('当解码时发生错误。');
                            break;
                        case 4:
                            alert('媒体不可用或者不支持音频/视频。');
                            break;
                    }
                }, false);

                //$media.attachEvent('ended', function () {
                //    //  第一个视频播放结束
                //    //  如果要继续播放第二个视频，改变 <video> 标签的 (src="test2.mp4") 属性或者新建一个 video 标签播放视频都可以
                //}, false);

                $track.attachEvent('onload', function () {
                    var c = $media.textTracks[0].cues;
                    for (var i = 0; i < c.length; i++) {
                        var s = document.createElement("span");
                        s.innerHTML = c[i].text;
                        s.setAttribute('data-start', c[i].startTime);
                        s.addEventListener("click", seek);
                        controlbar.appendChild(s);
                    }
                });

                //controlbar.attachEvent('onmousemove', function(e) {
                //    // first we convert from mouse to time position ..
                //    var p = (e.pageX - controlbar.offsetLeft) * video.duration / 480;

                //    // ..then we find the matching cue..
                //    var c = $media.textTracks[0].cues;
                //    for (var i = 0; i < c.length; i++) {
                //        if (c[i].startTime <= p && c[i].endTime > p) {
                //            break;
                //        };
                //    }

                //    // ..next we unravel the JPG url and fragment query..
                //    var url = c[i].text.split('#')[0];
                //    var xywh = c[i].text.substr(c[i].text.indexOf("=") + 1).split(',');

                //    // ..and last we style the thumbnail overlay
                //    thumbnail.style.backgroundImage = 'url(' + c[i].text.split('#')[0] + ')';
                //    thumbnail.style.backgroundPosition = '-' + xywh[0] + 'px -' + xywh[1] + 'px';
                //    thumbnail.style.left = e.pageX - xywh[2] / 2 + 'px';
                //    thumbnail.style.top = controlbar.offsetTop - xywh[3] + 8 + 'px';
                //    thumbnail.style.width = xywh[2] + 'px';
                //    thumbnail.style.height = xywh[3] + 'px';
                //});
            } else {

                // 当浏览器可在不因缓冲而停顿的情况下进行播放时
                $media.addEventListener("canplaythrough", function (e) {
                    console.log((new Date()).getTime(), e);
                    //alert('视频文件已经准备好，随时待命');
                    //var duration = $audio.duration.toFixed(2);
                    //$("#txtDuration").val(duration);
                    //var msg = "音频时长：" + duration + "秒";
                    //$("#" + modalId + " .media-info").html(msg);

                    //$("#btnDurationSave").removeAttr("disabled");
                }, false);


                $media.addEventListener("loadedmetadata", function () {
                    var duration = $media.duration;//获取总时长

                    //var duration = $("#txtDuration").val();
                    //if (duration.length == 0) {}
                    $("#txtMediaMessage").val("时长：" + $media.duration + "\n");
                    $("#txtDuration").val($media.duration);

                    $("#txtSize").val($media.videoWidth + " * " + $media.videoHeight);
                });


                //使用事件监听方式捕捉事件
                $media.addEventListener("timeupdate", function (e) {
                    var timeDisplay = document.getElementById("time");
                    //用秒数来显示当前播放进度
                    timeDisplay.innerHTML = Math.floor($media.currentTime) + "／" + Math.floor($media.duration) + "（秒）";

                    $("#txtCurrentTime").val($media.currentTime);

                    //var duration = $("#txtDuration").val();
                    //if (duration.length == 0) {
                    //    $("#txtMediaMessage").val("时长：" + $media.duration + "\n");
                    //    $("#txtDuration").val($media.duration);
                    //}

                    //debugger;

                    //var size = $("#txtSize").val();
                    //if (size.length == 0) {
                    //    $("#txtSize").val($media.videoWidth + " * " + $media.videoHeight);
                    //}

                    //console.log((new Date()).getTime(), e);

                }, false);

                $media.addEventListener("error", function () {
                    var error = $media.error;
                    switch (error.code) {
                        case 1:
                            alert('取回过程被用户中止。');
                            break;
                        case 2:
                            alert('当下载时发生错误。');
                            break;
                        case 3:
                            alert('当解码时发生错误。');
                            break;
                        case 4:
                            alert('媒体不可用或者不支持音频/视频。');
                            break;
                    }
                }, false);

                $media.addEventListener('ended', function (e) {

                    console.log((new Date()).getTime(), e);

                    var msg = $("#txtMediaMessage").val();
                    $("#txtMediaMessage").val(msg + "视频结束");

                    //  第一个视频播放结束
                    //  如果要继续播放第二个视频，改变 <video> 标签的 (src="test2.mp4") 属性或者新建一个 video 标签播放视频都可以
                }, false);

                $track.addEventListener('load', function () {
                    var c = $media.textTracks[0].cues;
                    for (var i = 0; i < c.length; i++) {
                        var s = document.createElement("span");
                        s.innerHTML = c[i].text;
                        s.setAttribute('data-start', c[i].startTime);
                        s.addEventListener("click", seek);
                        controlbar.appendChild(s);
                    }
                });

                //controlbar.addEventListener('mousemove', function(e) {
                //    // first we convert from mouse to time position ..
                //    var p = (e.pageX - controlbar.offsetLeft) * video.duration / 480;

                //    // ..then we find the matching cue..
                //    var c = $media.textTracks[0].cues;
                //    for (var i = 0; i < c.length; i++) {
                //        if (c[i].startTime <= p && c[i].endTime > p) {
                //            break;
                //        };
                //    }

                //    // ..next we unravel the JPG url and fragment query..
                //    var url = c[i].text.split('#')[0];
                //    var xywh = c[i].text.substr(c[i].text.indexOf("=") + 1).split(',');

                //    // ..and last we style the thumbnail overlay
                //    thumbnail.style.backgroundImage = 'url(' + c[i].text.split('#')[0] + ')';
                //    thumbnail.style.backgroundPosition = '-' + xywh[0] + 'px -' + xywh[1] + 'px';
                //    thumbnail.style.left = e.pageX - xywh[2] / 2 + 'px';
                //    thumbnail.style.top = controlbar.offsetTop - xywh[3] + 8 + 'px';
                //    thumbnail.style.width = xywh[2] + 'px';
                //    thumbnail.style.height = xywh[3] + 'px';
                //});
            }

        });

        function play(type) {
            if ($media.paused) {
                //if(videoUrl != video.src)
                //{
                //    video.src = videoUrl;
                //    video.load();
                //}
                //else
                //{
                //    video.play();
                //}
                $media.play();
                //document.getElementById(type.toLowerCase()).innerHTML = type + "暂停";
                $('#' + type.toLowerCase()).text(type + "暂停");
                $.parser.parse('#' + type.toLowerCase());
                $('#' + type.toLowerCase()).linkbutton({ height: '26px' });
            } else {
                $media.pause();
                //document.getElementById(type.toLowerCase()).innerHTML = type + "播放";
                $('#' + type.toLowerCase()).text(type + "播放");
                $.parser.parse('#' + type.toLowerCase());
                $('#' + type.toLowerCase()).linkbutton({ height: '26px' });
            }
        }

        function seek() {
            $media.currentTime = this.getAttribute('data-start');
            if ($media.paused) {
                $media.play();
            }
        };

        function checkVideo() {
            if (!!document.createElement('video').canPlayType) {
                var vidTest = document.createElement("video");
                var oggTest = vidTest.canPlayType('video/ogg; codecs="theora, vorbis"');
                if (!oggTest) {
                    var h264Test = vidTest.canPlayType('video/mp4; codecs="avc1.42E01E, mp4a.40.2"');
                    if (!h264Test) {
                        document.getElementById("checkVideoResult").innerHTML = "Sorry. No video support.";
                    } else {
                        if (h264Test == "probably") {
                            document.getElementById("checkVideoResult").innerHTML = "Yes! Full support!";
                        } else {
                            document.getElementById("checkVideoResult").innerHTML = "Well. Some support.";
                        }
                    }
                } else {
                    if (oggTest == "probably") {
                        document.getElementById("checkVideoResult").innerHTML = "Yes! Full support!";
                    } else {
                        document.getElementById("checkVideoResult").innerHTML = "Well. Some support.";
                    }
                }
            } else {
                document.getElementById("checkVideoResult").innerHTML = "Sorry. No video support.";
            }
        }

    </script>
</head>
<body>

    <div style="text-align: center;">
        <button onclick="playPause()">播放/暂停</button>
        <button onclick="makeBig()">大</button>
        <button onclick="makeNormal()">中</button>
        <button onclick="makeSmall()">小</button>
        <br />
        <video id="media" style="margin-top: 15px;">
            <!--<source src="/example/html5/mov_bbb.mp4"/>-->
            <!--<source src="/example/html5/mov_bbb.ogg"/>-->
            <!--<video controls="controls"></video>width="420"-->
            <!--<source src="VideoTest.mp4" type="video/mp4"/>-->
            <!--<source src="OgvTest.ogv" type="video/ogg"/>-->
            <!--<source src="phfx_4KHD_VP9TestFootage.webm" type="video/webm"/>-->

            <source src="video/oceans.mp4" type="video/mp4" />
            <source src="video/oceans.webm" type="video/webm" />
            <source src="video/oceans.ogv" type="video/ogg" />
            <track src="video/oceans.vtt" srclang="zh-cn" label="简体中文" kind="caption" default>

            <!--<track kind="subtitles" label="简体中文" src="subschi.srt" srclang="zh" default>-->
            <!--<track src="cn_track.vtt" srclang="zh-cn" label="简体中文" kind="caption" default>-->
            Your browser does not support HTML5 video.
        </video>

        <div class="container-fluid">
            <div class="row">
                <button type="button" class="btn btn-primary" id="btnFastBack" title="快退，-30S">
                    <i class="glyphicon glyphicon-step-backward"></i>
                </button>
                <button type="button" class="btn btn-primary" id="btnPlay" title="播放">
                    <i class="glyphicon glyphicon-play"></i>
                </button>
                <button type="button" class="btn btn-primary" id="btnPause" title="暂停" style="display: none;">
                    <i class="glyphicon glyphicon-pause"></i>
                </button>
                <button type="button" class="btn btn-primary" id="btnStop" title="停止">
                    <i class="glyphicon glyphicon-stop"></i>
                </button>
                <button type="button" class="btn btn-primary" id="btnFastForward" title="快进，+30S">
                    <i class="glyphicon glyphicon-step-forward"></i>
                </button>

                <button type="button" class="btn btn-primary" id="btnResumePlay">
                    <i class="fa fa-play-circle"></i> 继续播放
                </button>

                <button type="button" class="btn btn-primary" id="btnReplay">
                    <i class="fa fa-play-circle-o"></i> 重新播放
                </button>
            </div>

            <div class="row" style="margin: 20px 5px">

                <a id="mp4" href="#" class="easyui-linkbutton c5" style="width: 150px">MP4视频播放</a>
                <a id="ogv" href="#" class="easyui-linkbutton c6" style="width: 150px">OGV视频播放</a>
                <a id="webm" href="#" class="easyui-linkbutton c7" style="width: 150px">WebM视频播放</a>
                <span id="time"></span>

            </div>
        </div>
        <div style="margin: 5px;">
            <textarea id="txtMediaMessage" cols="20" rows="5" style="width: 100%;"></textarea>
            当前时间：<input id="txtCurrentTime" type="text" />
            时长：<input id="txtDuration" type="text" />
            原始尺寸：<input id="txtSize" type="text" />
            是否结束：<input id="txtEnded" type="text" />

            <!--继续播放，重新播放；是否结束-->

        </div>

    </div>

    <script type="text/javascript">
        var myVideo = document.getElementById("media");

        function playPause() {
            if (myVideo.paused)
                myVideo.play();
            else
                myVideo.pause();
        }

        function makeBig() {
            myVideo.width = 560;
        }

        function makeSmall() {
            myVideo.width = 320;
        }

        function makeNormal() {
            myVideo.width = 420;
        }
    </script>

</body>
</html>