(function(n){if(typeof exports=="object"&&typeof module!="undefined")module.exports=n();else if(typeof define=="function"&&define.amd)define([],n);else{var t;t=typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:this;t.videojsContribHls=n()}})(function(){var n;return function t(n,i,r){function u(f,o){var h,c,s;if(!i[f]){if(!n[f]){if(h=typeof require=="function"&&require,!o&&h)return h(f,!0);if(e)return e(f,!0);c=new Error("Cannot find module '"+f+"'");throw c.code="MODULE_NOT_FOUND",c;}s=i[f]={exports:{}};n[f][0].call(s.exports,function(t){var i=n[f][1][t];return u(i?i:t)},s,s.exports,t,n,i,r)}return i[f].exports}for(var e=typeof require=="function"&&require,f=0;f<r.length;f++)u(r[f]);return u}({1:[function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}var r;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){var r=[],u=!0,f=!1,e=undefined,i,o;try{for(i=n[Symbol.iterator]();!(u=(o=i.next()).done);u=!0)if(r.push(o.value),t&&r.length===t)break}catch(s){f=!0;e=s}finally{try{!u&&i["return"]&&i["return"]()}finally{if(f)throw e;}}return r}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();var o=n("global/window"),u=e(o),f=function(n,t){for(var i,u=n.cues,r=0;r<u.length;r++)if(i=u[r],t>=i.adStartTime&&t<=i.adEndTime)return i;return null},s=function(n,t){var a=arguments.length<=2||arguments[2]===undefined?0:arguments[2],e,i,s,o;if(n.segments)for(e=a,i=undefined,s=0;s<n.segments.length;s++){if(o=n.segments[s],i||(i=f(t,e+o.duration/2)),i){if("cueIn"in o){i.endTime=e;i.adEndTime=e;e+=o.duration;i=null;continue}if(e<i.endTime){e+=o.duration;continue}i.endTime+=o.duration}else if("cueOut"in o&&(i=new u["default"].VTTCue(e,e+o.duration,o.cueOut),i.adStartTime=e,i.adEndTime=e+parseFloat(o.cueOut),t.addCue(i)),"cueOutCont"in o){var h=undefined,c=undefined,v=o.cueOutCont.split("/").map(parseFloat),l=r(v,2);h=l[0];c=l[1];i=new u["default"].VTTCue(e,e+o.duration,"");i.adStartTime=e-h;i.adEndTime=i.adStartTime+c;t.addCue(i)}e+=o.duration}};i["default"]={updateAdCues:s,findAdCue:f};t.exports=i["default"]},{"global/window":32}],2:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var u=function(n,t){return n.start(t)+"-"+n.end(t)},f=function(n,t){var i=n.toString(16);return"00".substring(0,2-i.length)+i+(t%2?" ":"")},e=function(n){return n>=32&&n<126?String.fromCharCode(n):"."},o=function(n){var t={};return Object.keys(n).forEach(function(i){var r=n[i];t[i]=ArrayBuffer.isView(r)?{bytes:r.buffer,byteOffset:r.byteOffset,byteLength:r.byteLength}:r}),t},s=function(n){var t=n.byterange||{length:Infinity,offset:0};return[t.length,t.offset,n.resolvedUri].join(",")},r={hexDump:function(n){for(var r=Array.prototype.slice.call(n),t=16,u="",o=undefined,s=undefined,i=0;i<r.length/t;i++)o=r.slice(i*t,i*t+t).map(f).join(""),s=r.slice(i*t,i*t+t).map(e).join(""),u+=o+" "+s+"\n";return u},tagDump:function(n){return r.hexDump(n.bytes)},textRanges:function(n){for(var i="",t=undefined,t=0;t<n.length;t++)i+=u(n,t)+" ";return i},createTransferableMessage:o,initSegmentId:s};i["default"]=r;t.exports=i["default"]},{}],3:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i["default"]={GOAL_BUFFER_LENGTH:30,MAX_GOAL_BUFFER_LENGTH:60,GOAL_BUFFER_LENGTH_RATE:1,BANDWIDTH_VARIANCE:1.2,BUFFER_LOW_WATER_LINE:0,MAX_BUFFER_LOW_WATER_LINE:30,BUFFER_LOW_WATER_LINE_RATE:1};t.exports=i["default"]},{}],4:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var u=n("global/window"),f=r(u),e=n("aes-decrypter"),o=n("./bin-utils"),s=function(n){n.onmessage=function(n){var t=n.data,i=new Uint8Array(t.encrypted.bytes,t.encrypted.byteOffset,t.encrypted.byteLength),r=new Uint32Array(t.key.bytes,t.key.byteOffset,t.key.byteLength/4),u=new Uint32Array(t.iv.bytes,t.iv.byteOffset,t.iv.byteLength/4);new e.Decrypter(i,r,u,function(n,i){f["default"].postMessage(o.createTransferableMessage({source:t.source,decrypted:i}),[i.buffer])})}};i["default"]=function(n){return new s(n)};t.exports=i["default"]},{"./bin-utils":2,"aes-decrypter":25,"global/window":32}],5:[function(n,t,i){(function(t){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function d(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function g(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var l,a,k;Object.defineProperty(i,"__esModule",{value:!0});l=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();a=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var nt=n("./playlist-loader"),tt=u(nt),s=n("./playlist.js"),it=n("./segment-loader"),v=u(it),rt=n("./vtt-segment-loader"),ut=u(rt),ft=n("./ranges"),o=u(ft),et=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,r=u(et),ot=n("./ad-cue-tags"),st=u(ot),ht=n("./sync-controller"),ct=u(ht),lt=n("videojs-contrib-media-sources/es5/codec-utils"),at=n("webwackify"),vt=u(at),yt=n("./decrypter-worker"),pt=u(yt),wt=n("./config"),e=u(wt),h=n("./util/codecs.js"),y=n("./media-groups"),bt=120,f=undefined,p={videoCodec:"avc1",videoObjectTypeIndicator:".4d400d",audioProfile:"2"},kt=["mediaRequests","mediaRequestsAborted","mediaRequestsTimedout","mediaRequestsErrored","mediaTransferDuration","mediaBytesTransferred"],dt=function(n){return this.audioSegmentLoader_[n]+this.mainSegmentLoader_[n]},gt=function(){var t=undefined;try{t=n.resolve("./decrypter-worker")}catch(i){}return t},w=function(n){return n.replace(/avc1\.(\d+)\.(\d+)/i,function(n){return lt.translateLegacyCodecs([n])[0]})};i.mapLegacyAvcCodecs_=w;var c=function(n,t,i){return n+"/"+t+'; codecs="'+i.filter(function(n){return!!n}).join(", ")+'"'},ni=function(n){return n.segments&&n.segments.length&&n.segments[0].map?"mp4":"mp2t"},ti=function(n){var t=n.attributes||{};return t.CODECS?h.parseCodecs(t.CODECS):p},b=function(n,t){var e=ni(t),u=ti(t),l=t.attributes||{},o=!0,s=!1,f,a,i;if(!t)return[];if(n.mediaGroups.AUDIO&&l.AUDIO&&(f=n.mediaGroups.AUDIO[l.AUDIO],f)){s=!0;o=!1;for(a in f)if(!f[a].uri){o=!0;break}}s&&!u.audioProfile&&(r["default"].log.warn("Multiple audio tracks present but no audio codec string is specified. Attempting to use the default audio codec (mp4a.40.2)"),u.audioProfile=p.audioProfile);i={};u.videoCodec&&(i.video=""+u.videoCodec+u.videoObjectTypeIndicator);u.audioProfile&&(i.audio="mp4a.40."+u.audioProfile);var h=c("audio",e,[i.audio]),y=c("video",e,[i.video]),v=c("video",e,[i.video,i.audio]);return s?!o&&i.video?[y,h]:[v,h]:i.video?[v]:[h]};i.mimeTypesForPlaylist_=b;k=function(n){function t(n){var i=this,u;d(this,t);a(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);var o=n.url,h=n.withCredentials,s=n.mode,e=n.tech,c=n.bandwidth,l=n.externHls,p=n.useCueTags,w=n.blacklistDuration,b=n.enableLowInitialPlaylist;if(!o)throw new Error("A non-empty playlist URL is required");f=l;this.withCredentials=h;this.tech_=e;this.hls_=e.hls;this.mode_=s;this.useCueTags_=p;this.blacklistDuration=w;this.enableLowInitialPlaylist=b;this.useCueTags_&&(this.cueTagsTrack_=this.tech_.addTextTrack("metadata","ad-cues"),this.cueTagsTrack_.inBandMetadataTrackDispatchType="");this.requestOptions_={withCredentials:this.withCredentials,timeout:null};this.mediaTypes_=y.createMediaTypes();this.mediaSource=new r["default"].MediaSource({mode:s});this.mediaSource.addEventListener("sourceopen",this.handleSourceOpen_.bind(this));this.seekable_=r["default"].createTimeRanges();this.hasPlayed_=function(){return!1};this.syncController_=new ct["default"](n);this.segmentMetadataTrack_=e.addRemoteTextTrack({kind:"metadata",label:"segment-metadata"},!1).track;this.decrypter_=vt["default"](pt["default"],gt());u={hls:this.hls_,mediaSource:this.mediaSource,currentTime:this.tech_.currentTime.bind(this.tech_),seekable:function(){return i.seekable()},seeking:function(){return i.tech_.seeking()},duration:function(){return i.mediaSource.duration},hasPlayed:function(){return i.hasPlayed_()},goalBufferLength:function(){return i.goalBufferLength()},bandwidth:c,syncController:this.syncController_,decrypter:this.decrypter_};this.masterPlaylistLoader_=new tt["default"](o,this.hls_,this.withCredentials);this.setupMasterPlaylistLoaderListeners_();this.mainSegmentLoader_=new v["default"](r["default"].mergeOptions(u,{segmentMetadataTrack:this.segmentMetadataTrack_,loaderType:"main"}),n);this.audioSegmentLoader_=new v["default"](r["default"].mergeOptions(u,{loaderType:"audio"}),n);this.subtitleSegmentLoader_=new ut["default"](r["default"].mergeOptions(u,{loaderType:"vtt"}),n);this.setupSegmentLoaderListeners_();kt.forEach(function(n){i[n+"_"]=dt.bind(i,n)});this.masterPlaylistLoader_.load()}return g(t,n),l(t,[{key:"setupMasterPlaylistLoaderListeners_",value:function(){var n=this;this.masterPlaylistLoader_.on("loadedmetadata",function(){var t=n.masterPlaylistLoader_.media(),i=n.masterPlaylistLoader_.targetDuration*1.5*1e3;n.requestOptions_.timeout=s.isLowestEnabledRendition(n.masterPlaylistLoader_.master,n.masterPlaylistLoader_.media())?0:i;t.endList&&n.tech_.preload()!=="none"&&(n.mainSegmentLoader_.playlist(t,n.requestOptions_),n.mainSegmentLoader_.load());y.setupMediaGroups({segmentLoaders:{AUDIO:n.audioSegmentLoader_,SUBTITLES:n.subtitleSegmentLoader_,main:n.mainSegmentLoader_},tech:n.tech_,requestOptions:n.requestOptions_,masterPlaylistLoader:n.masterPlaylistLoader_,mode:n.mode_,hls:n.hls_,master:n.master(),mediaTypes:n.mediaTypes_,blacklistCurrentPlaylist:n.blacklistCurrentPlaylist.bind(n)});n.triggerPresenceUsage_(n.master(),t);try{n.setupSourceBuffers_()}catch(u){return r["default"].log.warn("Failed to create SourceBuffers",u),n.mediaSource.endOfStream("decode")}n.setupFirstPlay();n.trigger("selectedinitialmedia")});this.masterPlaylistLoader_.on("loadedplaylist",function(){var i=n.masterPlaylistLoader_.media(),t;if(!i){t=undefined;n.enableLowInitialPlaylist&&(t=n.selectInitialPlaylist());t||(t=n.selectPlaylist());n.initialMedia_=t;n.masterPlaylistLoader_.media(n.initialMedia_);return}n.useCueTags_&&n.updateAdCues_(i);n.mainSegmentLoader_.playlist(i,n.requestOptions_);n.updateDuration();n.tech_.paused()||n.mainSegmentLoader_.load();i.endList||function(){var t=function(){var t=n.seekable();t.length!==0&&n.mediaSource.addSeekableRange_(t.start(0),t.end(0))};n.duration()!==Infinity?function(){var i=function i(){if(n.duration()===Infinity)t();else n.tech_.one("durationchange",i)};n.tech_.one("durationchange",i)}():t()}()});this.masterPlaylistLoader_.on("error",function(){n.blacklistCurrentPlaylist(n.masterPlaylistLoader_.error)});this.masterPlaylistLoader_.on("mediachanging",function(){n.mainSegmentLoader_.abort();n.mainSegmentLoader_.pause()});this.masterPlaylistLoader_.on("mediachange",function(){var t=n.masterPlaylistLoader_.media(),i=n.masterPlaylistLoader_.targetDuration*1.5*1e3;n.requestOptions_.timeout=s.isLowestEnabledRendition(n.masterPlaylistLoader_.master,n.masterPlaylistLoader_.media())?0:i;n.mainSegmentLoader_.playlist(t,n.requestOptions_);n.mainSegmentLoader_.load();n.tech_.trigger({type:"mediachange",bubbles:!0})});this.masterPlaylistLoader_.on("playlistunchanged",function(){var t=n.masterPlaylistLoader_.media(),i=n.stuckAtPlaylistEnd_(t);i&&(n.blacklistCurrentPlaylist({message:"Playlist no longer updating."}),n.tech_.trigger("playliststuck"))});this.masterPlaylistLoader_.on("renditiondisabled",function(){n.tech_.trigger({type:"usage",name:"hls-rendition-disabled"})});this.masterPlaylistLoader_.on("renditionenabled",function(){n.tech_.trigger({type:"usage",name:"hls-rendition-enabled"})})}},{key:"triggerPresenceUsage_",value:function(n,t){var i=n.mediaGroups||{},u=!0,e=Object.keys(i.AUDIO),r,o,s;for(r in i.AUDIO)for(o in i.AUDIO[r])s=i.AUDIO[r][o],s.uri||(u=!1);u&&this.tech_.trigger({type:"usage",name:"hls-demuxed"});Object.keys(i.SUBTITLES).length&&this.tech_.trigger({type:"usage",name:"hls-webvtt"});f.Playlist.isAes(t)&&this.tech_.trigger({type:"usage",name:"hls-aes"});f.Playlist.isFmp4(t)&&this.tech_.trigger({type:"usage",name:"hls-fmp4"});e.length&&Object.keys(i.AUDIO[e[0]]).length>1&&this.tech_.trigger({type:"usage",name:"hls-alternate-audio"});this.useCueTags_&&this.tech_.trigger({type:"usage",name:"hls-playlist-cue-tags"})}},{key:"setupSegmentLoaderListeners_",value:function(){var n=this;this.mainSegmentLoader_.on("bandwidthupdate",function(){var i=n.selectPlaylist(),r=n.masterPlaylistLoader_.media(),t=n.tech_.buffered(),u=t.length?t.end(t.length-1)-n.tech_.currentTime():0,f=n.bufferLowWaterLine();(!r.endList||n.duration()<e["default"].MAX_BUFFER_LOW_WATER_LINE||i.attributes.BANDWIDTH<r.attributes.BANDWIDTH||u>=f)&&n.masterPlaylistLoader_.media(i);n.tech_.trigger("bandwidthupdate")});this.mainSegmentLoader_.on("progress",function(){n.trigger("progress")});this.mainSegmentLoader_.on("error",function(){n.blacklistCurrentPlaylist(n.mainSegmentLoader_.error())});this.mainSegmentLoader_.on("syncinfoupdate",function(){n.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("timestampoffset",function(){n.tech_.trigger({type:"usage",name:"hls-timestamp-offset"})});this.audioSegmentLoader_.on("syncinfoupdate",function(){n.onSyncInfoUpdate_()});this.mainSegmentLoader_.on("ended",function(){n.onEndOfStream()});this.mainSegmentLoader_.on("earlyabort",function(){n.blacklistCurrentPlaylist({message:"Aborted early because there isn't enough bandwidth to complete the request without rebuffering."},bt)});this.mainSegmentLoader_.on("reseteverything",function(){n.tech_.trigger("hls-reset")});this.mainSegmentLoader_.on("segmenttimemapping",function(t){n.tech_.trigger({type:"hls-segment-time-mapping",mapping:t.mapping})});this.audioSegmentLoader_.on("ended",function(){n.onEndOfStream()})}},{key:"mediaSecondsLoaded_",value:function(){return Math.max(this.audioSegmentLoader_.mediaSecondsLoaded+this.mainSegmentLoader_.mediaSecondsLoaded)}},{key:"load",value:function(){this.mainSegmentLoader_.load();this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.load();this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.load()}},{key:"fastQualityChange_",value:function(){var n=this.selectPlaylist();n!==this.masterPlaylistLoader_.media()&&(this.masterPlaylistLoader_.media(n),this.mainSegmentLoader_.resetLoader())}},{key:"play",value:function(){if(!this.setupFirstPlay()){this.tech_.ended()&&this.tech_.setCurrentTime(0);this.hasPlayed_()&&this.load();var n=this.tech_.seekable();if(this.tech_.duration()===Infinity&&this.tech_.currentTime()<n.start(0))return this.tech_.setCurrentTime(n.end(n.length-1))}}},{key:"setupFirstPlay",value:function(){var n=this,i=this.masterPlaylistLoader_.media(),t;return!i||this.tech_.paused()||this.hasPlayed_()?!1:!i.endList&&(t=function(){var t=n.seekable();if(!t.length)return{v:!1};if(r["default"].browser.IE_VERSION&&n.mode_==="html5"&&n.tech_.readyState()===0){n.tech_.one("loadedmetadata",function(){n.trigger("firstplay");n.tech_.setCurrentTime(t.end(0));n.hasPlayed_=function(){return!0}});return{v:!1}}n.trigger("firstplay");n.tech_.setCurrentTime(t.end(0))}(),typeof t=="object")?t.v:(this.hasPlayed_=function(){return!0},this.load(),!0)}},{key:"handleSourceOpen_",value:function(){try{this.setupSourceBuffers_()}catch(t){return r["default"].log.warn("Failed to create Source Buffers",t),this.mediaSource.endOfStream("decode")}if(this.tech_.autoplay()){var n=this.tech_.play();typeof n!="undefined"&&typeof n.then=="function"&&n.then(null,function(){})}this.trigger("sourceopen")}},{key:"onEndOfStream",value:function(){var n=this.mainSegmentLoader_.ended_;this.mediaTypes_.AUDIO.activePlaylistLoader&&(n=n&&this.audioSegmentLoader_.ended_);n&&this.mediaSource.endOfStream()}},{key:"stuckAtPlaylistEnd_",value:function(n){var s=this.seekable(),t,r;if(!s.length||(t=this.syncController_.getExpiredTime(n,this.mediaSource.duration),t===null))return!1;var u=f.Playlist.playlistEnd(n,t),e=this.tech_.currentTime(),i=this.tech_.buffered();return i.length?(r=i.end(i.length-1),r-e<=o["default"].SAFE_TIME_DELTA&&u-r<=o["default"].SAFE_TIME_DELTA):u-e<=o["default"].SAFE_TIME_DELTA}},{key:"blacklistCurrentPlaylist",value:function(n,t){var i,u,f;if(n===undefined&&(n={}),i=undefined,u=undefined,i=n.playlist||this.masterPlaylistLoader_.media(),t=t||n.blacklistDuration||this.blacklistDuration,!i){this.error=n;try{return this.mediaSource.endOfStream("network")}catch(e){return this.trigger("error")}}return(f=this.masterPlaylistLoader_.master.playlists.filter(s.isEnabled).length===1,f)?(r["default"].log.warn("Problem encountered with the current HLS playlist. Trying again since it is the final playlist."),this.tech_.trigger("retryplaylist"),this.masterPlaylistLoader_.load(f)):(i.excludeUntil=Date.now()+t*1e3,this.tech_.trigger("blacklistplaylist"),this.tech_.trigger({type:"usage",name:"hls-rendition-blacklisted"}),u=this.selectPlaylist(),r["default"].log.warn("Problem encountered with the current HLS playlist."+(n.message?" "+n.message:"")+" Switching to another playlist."),this.masterPlaylistLoader_.media(u))}},{key:"pauseLoading",value:function(){this.mainSegmentLoader_.pause();this.mediaTypes_.AUDIO.activePlaylistLoader&&this.audioSegmentLoader_.pause();this.mediaTypes_.SUBTITLES.activePlaylistLoader&&this.subtitleSegmentLoader_.pause()}},{key:"setCurrentTime",value:function(n){var t=o["default"].findRange(this.tech_.buffered(),n);if(!(this.masterPlaylistLoader_&&this.masterPlaylistLoader_.media())||!this.masterPlaylistLoader_.media().segments)return 0;if(t&&t.length&&this.mode_!=="flash")return n;this.mainSegmentLoader_.resetEverything();this.mainSegmentLoader_.abort();this.mediaTypes_.AUDIO.activePlaylistLoader&&(this.audioSegmentLoader_.resetEverything(),this.audioSegmentLoader_.abort());this.mediaTypes_.SUBTITLES.activePlaylistLoader&&(this.subtitleSegmentLoader_.resetEverything(),this.subtitleSegmentLoader_.abort());this.load()}},{key:"duration",value:function(){return this.masterPlaylistLoader_?this.mediaSource?this.mediaSource.duration:f.Playlist.duration(this.masterPlaylistLoader_.media()):0}},{key:"seekable",value:function(){return this.seekable_}},{key:"onSyncInfoUpdate_",value:function(){var n=undefined,t=undefined,i,u;if(this.masterPlaylistLoader_&&(i=this.masterPlaylistLoader_.media(),i)&&(u=this.syncController_.getExpiredTime(i,this.mediaSource.duration),u!==null)&&(n=f.Playlist.seekable(i,u),n.length!==0)){if(this.mediaTypes_.AUDIO.activePlaylistLoader){if(i=this.mediaTypes_.AUDIO.activePlaylistLoader.media(),u=this.syncController_.getExpiredTime(i,this.mediaSource.duration),u===null)return;if(t=f.Playlist.seekable(i,u),t.length===0)return}this.seekable_=t?t.start(0)>n.end(0)||n.start(0)>t.end(0)?n:r["default"].createTimeRanges([[t.start(0)>n.start(0)?t.start(0):n.start(0),t.end(0)<n.end(0)?t.end(0):n.end(0)]]):n;this.tech_.trigger("seekablechanged")}}},{key:"updateDuration",value:function(){var t=this,u=this.mediaSource.duration,n=f.Playlist.duration(this.masterPlaylistLoader_.media()),i=this.tech_.buffered(),r=function r(){t.mediaSource.duration=n;t.tech_.trigger("durationchange");t.mediaSource.removeEventListener("sourceopen",r)};i.length>0&&(n=Math.max(n,i.end(i.length-1)));u!==n&&(this.mediaSource.readyState!=="open"?this.mediaSource.addEventListener("sourceopen",r):r())}},{key:"dispose",value:function(){var n=this;this.decrypter_.terminate();this.masterPlaylistLoader_.dispose();this.mainSegmentLoader_.dispose();["AUDIO","SUBTITLES"].forEach(function(t){var i=n.mediaTypes_[t].groups;for(var r in i)i[r].forEach(function(n){n.playlistLoader&&n.playlistLoader.dispose()})});this.audioSegmentLoader_.dispose();this.subtitleSegmentLoader_.dispose()}},{key:"master",value:function(){return this.masterPlaylistLoader_.master}},{key:"media",value:function(){return this.masterPlaylistLoader_.media()||this.initialMedia_}},{key:"setupSourceBuffers_",value:function(){var t=this.masterPlaylistLoader_.media(),n=undefined;if(t&&this.mediaSource.readyState==="open"){if(n=b(this.masterPlaylistLoader_.master,t),n.length<1)return this.error="No compatible SourceBuffer configuration for the variant stream:"+t.resolvedUri,this.mediaSource.endOfStream("decode");this.mainSegmentLoader_.mimeType(n[0]);n[1]&&this.audioSegmentLoader_.mimeType(n[1]);this.excludeIncompatibleVariants_(t)}}},{key:"excludeIncompatibleVariants_",value:function(n){var u=this.masterPlaylistLoader_.master,i=2,r=null,t=undefined;n.attributes.CODECS&&(t=h.parseCodecs(n.attributes.CODECS),r=t.videoCodec,i=t.codecCount);u.playlists.forEach(function(n){var t={codecCount:2,videoCodec:null},u;n.attributes.CODECS&&(u=n.attributes.CODECS,t=h.parseCodecs(u),window.MediaSource&&window.MediaSource.isTypeSupported&&!window.MediaSource.isTypeSupported('video/mp4; codecs="'+w(u)+'"')&&(n.excludeUntil=Infinity));t.codecCount!==i&&(n.excludeUntil=Infinity);t.videoCodec!==r&&(n.excludeUntil=Infinity)})}},{key:"updateAdCues_",value:function(n){var t=0,i=this.seekable();i.length&&(t=i.start(0));st["default"].updateAdCues(n,this.cueTagsTrack_,t)}},{key:"goalBufferLength",value:function(){var t=this.tech_.currentTime(),n=e["default"].GOAL_BUFFER_LENGTH,i=e["default"].GOAL_BUFFER_LENGTH_RATE,r=Math.max(n,e["default"].MAX_GOAL_BUFFER_LENGTH);return Math.min(n+t*i,r)}},{key:"bufferLowWaterLine",value:function(){var t=this.tech_.currentTime(),n=e["default"].BUFFER_LOW_WATER_LINE,i=e["default"].BUFFER_LOW_WATER_LINE_RATE,r=Math.max(n,e["default"].MAX_BUFFER_LOW_WATER_LINE);return Math.min(n+t*i,r)}}]),t}(r["default"].EventTarget);i.MasterPlaylistController=k}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./ad-cue-tags":1,"./config":3,"./decrypter-worker":4,"./media-groups":6,"./playlist-loader":9,"./playlist.js":11,"./ranges":12,"./segment-loader":16,"./sync-controller":18,"./util/codecs.js":19,"./vtt-segment-loader":20,"videojs-contrib-media-sources/es5/codec-utils":65,webwackify:76}],6:[function(n,t,i){(function(t){"use strict";function y(n){return n&&n.__esModule?n:{"default":n}}var e,h,c,u,s,l,a,v,w,b;Object.defineProperty(i,"__esModule",{value:!0});var k=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,r=y(k),d=n("./playlist-loader"),p=y(d),o=function(){},g=function(n){var t=n["default"]?"main":"alternative";return n.characteristics&&n.characteristics.indexOf("public.accessibility.describes-video")>=0&&(t="main-desc"),t},f=function(n,t){n.abort();n.pause();t&&t.activePlaylistLoader&&(t.activePlaylistLoader.pause(),t.activePlaylistLoader=null)};i.stopLoaders=f;e=function(n,t){t.activePlaylistLoader=n;n.load()};i.startLoaders=e;h=function(n,t){return function(){var u=t.segmentLoaders,o=u[n],s=u.main,i=t.mediaTypes[n],h=i.activeTrack(),r=i.activeGroup(h),c=i.activePlaylistLoader;if(f(o,i),r){if(!r.playlistLoader){c&&s.resetEverything();return}o.resyncLoader();e(r.playlistLoader,i)}}};i.onGroupChanged=h;c=function(n,t){return function(){var o=t.segmentLoaders,u=o[n],h=o.main,i=t.mediaTypes[n],s=i.activeTrack(),r=i.activeGroup(s),c=i.activePlaylistLoader;if(f(u,i),r){if(!r.playlistLoader){h.resetEverything();return}if(c===r.playlistLoader){e(r.playlistLoader,i);return}u.track&&u.track(s);u.resetEverything();e(r.playlistLoader,i)}}};i.onTrackChanged=c;u={AUDIO:function(n,t){return function(){var s=t.segmentLoaders[n],i=t.mediaTypes[n],h=t.blacklistCurrentPlaylist,u;f(s,i);var c=i.activeTrack(),e=i.activeGroup(),l=(e.filter(function(n){return n["default"]})[0]||e[0]).id,o=i.tracks[l];if(c===o){h({message:"Problem encountered loading the default audio track."});return}r["default"].log.warn("Problem encountered loading the alternate audio track.Switching back to default.");for(u in i.tracks)i.tracks[u].enabled=i.tracks[u]===o;i.onTrackChanged()}},SUBTITLES:function(n,t){return function(){var e=t.segmentLoaders[n],i=t.mediaTypes[n],u;r["default"].log.warn("Problem encountered loading the subtitle track.Disabling subtitle track.");f(e,i);u=i.activeTrack();u&&(u.mode="disabled");i.onTrackChanged()}}};i.onError=u;s={AUDIO:function(n,t,i){if(t){var f=i.tech,e=i.requestOptions,r=i.segmentLoaders[n];t.on("loadedmetadata",function(){var n=t.media();r.playlist(n,e);(!f.paused()||n.endList&&f.preload()!=="none")&&r.load()});t.on("loadedplaylist",function(){r.playlist(t.media(),e);f.paused()||r.load()});t.on("error",u[n](n,i))}},SUBTITLES:function(n,t,i){var f=i.tech,e=i.requestOptions,r=i.segmentLoaders[n],o=i.mediaTypes[n];t.on("loadedmetadata",function(){var n=t.media();r.playlist(n,e);r.track(o.activeTrack());(!f.paused()||n.endList&&f.preload()!=="none")&&r.load()});t.on("loadedplaylist",function(){r.playlist(t.media(),e);f.paused()||r.load()});t.on("error",u[n](n,i))}};i.setupListeners=s;l={AUDIO:function(n,t){var y=t.mode,w=t.hls,b=t.segmentLoaders[n],k=t.requestOptions.withCredentials,e=t.master.mediaGroups,l=t.mediaTypes[n],h=l.groups,a=l.tracks,o,f,i,c,v;e[n]&&Object.keys(e[n]).length!==0&&y==="html5"||(e[n]={main:{"default":{"default":!0}}});for(o in e[n]){h[o]||(h[o]=[]);for(f in e[n][o])i=e[n][o][f],c=undefined,c=i.resolvedUri?new p["default"](i.resolvedUri,w,k):null,i=r["default"].mergeOptions({id:f,playlistLoader:c},i),s[n](n,i.playlistLoader,t),h[o].push(i),typeof a[f]=="undefined"&&(v=new r["default"].AudioTrack({id:f,kind:g(i),enabled:!1,language:i.language,"default":i["default"],label:f}),a[f]=v)}b.on("error",u[n](n,t))},SUBTITLES:function(n,t){var v=t.tech,y=t.hls,w=t.segmentLoaders[n],b=t.requestOptions.withCredentials,o=t.master.mediaGroups,c=t.mediaTypes[n],h=c.groups,l=c.tracks,f,i,e,a;for(f in o[n]){h[f]||(h[f]=[]);for(i in o[n][f])o[n][f][i].forced||(e=o[n][f][i],e=r["default"].mergeOptions({id:i,playlistLoader:new p["default"](e.resolvedUri,y,b)},e),s[n](n,e.playlistLoader,t),h[f].push(e),typeof l[i]=="undefined"&&(a=v.addRemoteTextTrack({id:i,kind:"subtitles",enabled:!1,language:e.language,label:i},!1).track,l[i]=a))}w.on("error",u[n](n,t))},"CLOSED-CAPTIONS":function(n,t){var l=t.tech,e=t.master.mediaGroups,s=t.mediaTypes[n],o=s.groups,h=s.tracks,i,u,f,c;for(i in e[n]){o[i]||(o[i]=[]);for(u in e[n][i])(f=e[n][i][u],f.instreamId.match(/CC\d/))&&(o[i].push(r["default"].mergeOptions({id:u},f)),typeof h[u]=="undefined"&&(c=l.addRemoteTextTrack({id:f.instreamId,kind:"captions",enabled:!1,language:f.language,label:u},!1).track,h[u]=c))}}};i.initialize=l;a=function(n,t){return function(i){var e=t.masterPlaylistLoader,f=t.mediaTypes[n].groups,u=e.media(),r;return u?(r=null,u.attributes[n]&&(r=f[u.attributes[n]]),r=r||f.main,typeof i=="undefined")?r:i===null?null:r.filter(function(n){return n.id===i.id})[0]||null:null}};i.activeGroup=a;v={AUDIO:function(n,t){return function(){var i=t.mediaTypes[n].tracks;for(var r in i)if(i[r].enabled)return i[r];return null}},SUBTITLES:function(n,t){return function(){var i=t.mediaTypes[n].tracks;for(var r in i)if(i[r].mode==="showing")return i[r];return null}}};i.activeTrack=v;w=function(n){var r,f,u,e;["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){l[t](t,n)});var t=n.mediaTypes,o=n.masterPlaylistLoader,i=n.tech,s=n.hls;["AUDIO","SUBTITLES"].forEach(function(i){t[i].activeGroup=a(i,n);t[i].activeTrack=v[i](i,n);t[i].onGroupChanged=h(i,n);t[i].onTrackChanged=c(i,n)});r=t.AUDIO.activeGroup();f=(r.filter(function(n){return n["default"]})[0]||r[0]).id;t.AUDIO.tracks[f].enabled=!0;t.AUDIO.onTrackChanged();o.on("mediachange",function(){["AUDIO","SUBTITLES"].forEach(function(n){return t[n].onGroupChanged()})});u=function(){t.AUDIO.onTrackChanged();i.trigger({type:"usage",name:"hls-audio-change"})};i.audioTracks().addEventListener("change",u);i.remoteTextTracks().addEventListener("change",t.SUBTITLES.onTrackChanged);s.on("dispose",function(){i.audioTracks().removeEventListener("change",u);i.remoteTextTracks().removeEventListener("change",t.SUBTITLES.onTrackChanged)});i.clearTracks("audio");for(e in t.AUDIO.tracks)i.audioTracks().addTrack(t.AUDIO.tracks[e])};i.setupMediaGroups=w;b=function(){var n={};return["AUDIO","SUBTITLES","CLOSED-CAPTIONS"].forEach(function(t){n[t]={groups:{},tracks:{},activePlaylistLoader:null,activeGroup:o,activeTrack:o,onGroupChanged:o,onTrackChanged:o}}),n};i.createMediaTypes=b}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./playlist-loader":9}],7:[function(n,t,i){(function(t){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var h=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,u=s(h),c=n("./bin-utils"),r={FAILURE:2,TIMEOUT:-101,ABORTED:-102};i.REQUEST_ERRORS=r;var l=function(n){var t=undefined,i=undefined;return i=n.offset+n.length-1,t=n.offset,"bytes="+t+"-"+i},e=function(n){var t={};return n.byterange&&(t.Range=l(n.byterange)),t},o=function(n){n.forEach(function(n){n.abort()})},a=function(n){return{bandwidth:n.bandwidth,bytesReceived:n.bytesReceived||0,roundTripTime:n.roundTripTime||0}},v=function(n){var i=n.target,r=Date.now()-i.requestTime,t={bandwidth:Infinity,bytesReceived:0,roundTripTime:r||0};return t.bytesReceived=n.loaded,t.bandwidth=Math.floor(t.bytesReceived/t.roundTripTime*8e3),t},f=function(n,t){return t.timedout?{status:t.status,message:"HLS request timed-out at URL: "+t.uri,code:r.TIMEOUT,xhr:t}:t.aborted?{status:t.status,message:"HLS request aborted at URL: "+t.uri,code:r.ABORTED,xhr:t}:n?{status:t.status,message:"HLS request errored at URL: "+t.uri,code:r.FAILURE,xhr:t}:null},y=function(n,t){return function(i,u){var o=u.response,s=f(i,u),e;return s?t(s,n):o.byteLength!==16?t({status:u.status,message:"Invalid HLS key at URL: "+u.uri,code:r.FAILURE,xhr:u},n):(e=new DataView(o),n.key.bytes=new Uint32Array([e.getUint32(0),e.getUint32(4),e.getUint32(8),e.getUint32(12)]),t(null,n))}},p=function(n,t){return function(i,u){var o=u.response,e=f(i,u);return e?t(e,n):o.byteLength===0?t({status:u.status,message:"Empty HLS segment content at URL: "+u.uri,code:r.FAILURE,xhr:u},n):(n.map.bytes=new Uint8Array(u.response),t(null,n))}},w=function(n,t){return function(i,u){var o=u.response,e=f(i,u);return e?t(e,n):o.byteLength===0?t({status:u.status,message:"Empty HLS segment content at URL: "+u.uri,code:r.FAILURE,xhr:u},n):(n.stats=a(u),n.key?n.encryptedBytes=new Uint8Array(u.response):n.bytes=new Uint8Array(u.response),t(null,n))}},b=function(n,t,i){var r=function r(u){if(u.data.source===t.requestId){n.removeEventListener("message",r);var f=u.data.decrypted;return t.bytes=new Uint8Array(f.bytes,f.byteOffset,f.byteLength),i(null,t)}};n.addEventListener("message",r);n.postMessage(c.createTransferableMessage({source:t.requestId,encrypted:t.encryptedBytes,key:t.key.bytes,iv:t.key.iv}),[t.encryptedBytes.buffer,t.key.bytes.buffer])},k=function(n){return n.reduce(function(n,t){return t.code>n.code?t:n})},d=function(n,t,i){var r=[],u=0;return function(f,e){if(f&&(o(n),r.push(f)),u+=1,u===n.length){if(e.endOfAllRequests=Date.now(),r.length>0){var s=k(r);return i(s,e)}return e.encryptedBytes?b(t,e,i):i(null,e)}}},g=function(n,t){return function(i){return n.stats=u["default"].mergeOptions(n.stats,v(i)),!n.stats.firstBytesReceivedAt&&n.stats.bytesReceived&&(n.stats.firstBytesReceivedAt=Date.now()),t(i,n)}},nt=function(n,t,i,r,f,s){var h=[],c=d(h,i,s);if(r.key){var a=u["default"].mergeOptions(t,{uri:r.key.resolvedUri,responseType:"arraybuffer"}),v=y(r,c),b=n(a,v);h.push(b)}if(r.map&&!r.map.bytes){var k=u["default"].mergeOptions(t,{uri:r.map.resolvedUri,responseType:"arraybuffer",headers:e(r.map)}),nt=p(r,c),tt=n(k,nt);h.push(tt)}var it=u["default"].mergeOptions(t,{uri:r.resolvedUri,responseType:"arraybuffer",headers:e(r)}),rt=w(r,c),l=n(it,rt);return l.addEventListener("progress",g(r,f)),h.push(l),function(){return o(h)}};i.mediaSegmentRequest=nt}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./bin-utils":2}],8:[function(n,t,i){(function(r){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function c(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var o;Object.defineProperty(i,"__esModule",{value:!0});o=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var l=n("global/window"),e=f(l),a=n("./ranges"),u=f(a),v=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,s=f(v),h=["seeking","seeked","pause","playing","error"],y=function(){function n(t){var i=this;c(this,n);this.tech_=t.tech;this.seekable=t.seekable;this.consecutiveUpdates=0;this.lastRecordedTime=null;this.timer_=null;this.checkCurrentTimeTimeout_=null;t.debug&&(this.logger_=s["default"].log.bind(s["default"],"playback-watcher ->"));this.logger_("initialize");var r=function(){return i.monitorCurrentTime_()},u=function(){return i.techWaiting_()},f=function(){return i.cancelTimer_()},o=function(){return i.fixesBadSeeks_()};this.tech_.on("seekablechanged",o);this.tech_.on("waiting",u);this.tech_.on(h,f);this.tech_.on("canplay",r);this.dispose=function(){i.logger_("dispose");i.tech_.off("seekablechanged",o);i.tech_.off("waiting",u);i.tech_.off(h,f);i.tech_.off("canplay",r);i.checkCurrentTimeTimeout_&&e["default"].clearTimeout(i.checkCurrentTimeTimeout_);i.cancelTimer_()}}return o(n,[{key:"monitorCurrentTime_",value:function(){this.checkCurrentTime_();this.checkCurrentTimeTimeout_&&e["default"].clearTimeout(this.checkCurrentTimeTimeout_);this.checkCurrentTimeTimeout_=e["default"].setTimeout(this.monitorCurrentTime_.bind(this),250)}},{key:"checkCurrentTime_",value:function(){if(this.tech_.seeking()&&this.fixesBadSeeks_()){this.consecutiveUpdates=0;this.lastRecordedTime=this.tech_.currentTime();return}if(!this.tech_.paused()&&!this.tech_.seeking()){var n=this.tech_.currentTime(),t=this.tech_.buffered();if(this.lastRecordedTime===n&&(!t.length||n+u["default"].SAFE_TIME_DELTA>=t.end(t.length-1)))return this.techWaiting_();this.consecutiveUpdates>=5&&n===this.lastRecordedTime?(this.consecutiveUpdates++,this.waiting_()):n===this.lastRecordedTime?this.consecutiveUpdates++:(this.consecutiveUpdates=0,this.lastRecordedTime=n)}}},{key:"cancelTimer_",value:function(){this.consecutiveUpdates=0;this.timer_&&(this.logger_("cancelTimer_"),clearTimeout(this.timer_));this.timer_=null}},{key:"fixesBadSeeks_",value:function(){var r=this.tech_.seeking(),n=this.seekable(),i=this.tech_.currentTime(),t=undefined,f,e;return(r&&this.afterSeekableWindow_(n,i)&&(f=n.end(n.length-1),t=f),r&&this.beforeSeekableWindow_(n,i)&&(e=n.start(0),t=e+u["default"].SAFE_TIME_DELTA),typeof t!="undefined")?(this.logger_("Trying to seek outside of seekable at time "+i+" with "+("seekable range "+u["default"].printableRange(n)+". Seeking to ")+(t+".")),this.tech_.setCurrentTime(t),!0):!1}},{key:"waiting_",value:function(){if(!this.techWaiting_()){var n=this.tech_.currentTime(),i=this.tech_.buffered(),t=u["default"].findRange(i,n);if(t.length&&n+3<=t.end(0)){this.cancelTimer_();this.tech_.setCurrentTime(n);this.logger_("Stopped at "+n+" while inside a buffered region "+("["+t.start(0)+" -> "+t.end(0)+"]. Attempting to resume ")+"playback by seeking to the current time.");this.tech_.trigger({type:"usage",name:"hls-unknown-waiting"});return}}}},{key:"techWaiting_",value:function(){var i=this.seekable(),n=this.tech_.currentTime(),r,f,t,e;return this.tech_.seeking()&&this.fixesBadSeeks_()?!0:this.tech_.seeking()||this.timer_!==null?!0:this.beforeSeekableWindow_(i,n)?(r=i.end(i.length-1),this.logger_("Fell out of live window at time "+n+". Seeking to "+("live point (seekable end) "+r)),this.cancelTimer_(),this.tech_.setCurrentTime(r),this.tech_.trigger({type:"usage",name:"hls-live-resync"}),!0):(f=this.tech_.buffered(),t=u["default"].findNextRange(f,n),this.videoUnderflow_(t,f,n))?(this.cancelTimer_(),this.tech_.setCurrentTime(n),this.tech_.trigger({type:"usage",name:"hls-video-underflow"}),!0):t.length>0?(e=t.start(0)-n,this.logger_("Stopped at "+n+", setting timer for "+e+", seeking "+("to "+t.start(0))),this.timer_=setTimeout(this.skipTheGap_.bind(this),e*1e3,n),!0):!1}},{key:"afterSeekableWindow_",value:function(n,t){return n.length?t>n.end(n.length-1)+u["default"].SAFE_TIME_DELTA?!0:!1:!1}},{key:"beforeSeekableWindow_",value:function(n,t){return n.length&&n.start(0)>0&&t<n.start(0)-u["default"].SAFE_TIME_DELTA?!0:!1}},{key:"videoUnderflow_",value:function(n,t,i){if(n.length===0){var r=this.gapFromVideoUnderflow_(t,i);if(r)return this.logger_("Encountered a gap in video from "+r.start+" to "+r.end+". "+("Seeking to current time "+i)),!0}return!1}},{key:"skipTheGap_",value:function(n){var r=this.tech_.buffered(),t=this.tech_.currentTime(),i=u["default"].findNextRange(r,t);(this.cancelTimer_(),i.length!==0&&t===n)&&(this.logger_("skipTheGap_:","currentTime:",t,"scheduled currentTime:",n,"nextRange start:",i.start(0)),this.tech_.setCurrentTime(i.start(0)+u["default"].TIME_FUDGE_FACTOR),this.tech_.trigger({type:"usage",name:"hls-gap-skip"}))}},{key:"gapFromVideoUnderflow_",value:function(n,t){for(var r,e,f=u["default"].findGaps(n),i=0;i<f.length;i++)if(r=f.start(i),e=f.end(i),t-r<4&&t-r>2)return{start:r,end:e};return null}},{key:"logger_",value:function(){}}]),n}();i["default"]=y;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./ranges":12,"global/window":32}],9:[function(n,t,i){(function(t){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}function b(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function k(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var a,v,o,s,h,c,l,w;Object.defineProperty(i,"__esModule",{value:!0});a=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();v=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var d=n("./resolve-url"),r=e(d),f=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,g=n("m3u8-parser"),y=e(g),nt=n("global/window"),u=e(nt),p=function(n,t,i){var u=t.slice(),e,r;for(i=i||0,e=Math.min(n.length,t.length+i),r=i;r<e;r++)u[r-i]=f.mergeOptions(n[r],u[r-i]);return u};i.updateSegments=p;o=function(n,t){n.resolvedUri||(n.resolvedUri=r["default"](t,n.uri));n.key&&!n.key.resolvedUri&&(n.key.resolvedUri=r["default"](t,n.key.uri));n.map&&!n.map.resolvedUri&&(n.map.resolvedUri=r["default"](t,n.map.uri))};i.resolveSegmentUris=o;s=function(n,t){var r=f.mergeOptions(n,{}),i=r.playlists.filter(function(n){return n.uri===t.uri})[0],u,e;if(!i||i.segments&&t.segments&&i.segments.length===t.segments.length&&i.mediaSequence===t.mediaSequence)return null;for(u=f.mergeOptions(i,t),i.segments&&(u.segments=p(i.segments,t.segments,t.mediaSequence-i.mediaSequence)),u.segments.forEach(function(n){o(n,u.resolvedUri)}),e=0;e<r.playlists.length;e++)r.playlists[e].uri===t.uri&&(r.playlists[e]=u);return r.playlists[t.uri]=u,r};i.updateMaster=s;h=function(n){for(var i=n.playlists.length,t;i--;)t=n.playlists[i],n.playlists[t.uri]=t,t.resolvedUri=r["default"](n.uri,t.uri),t.attributes||(t.attributes={},f.log.warn("Invalid playlist STREAM-INF detected. Missing BANDWIDTH attribute."))};i.setupMediaPlaylists=h;c=function(n){["AUDIO","SUBTITLES"].forEach(function(t){var u,f,i;for(u in n.mediaGroups[t])for(f in n.mediaGroups[t][u])i=n.mediaGroups[t][u][f],i.uri&&(i.resolvedUri=r["default"](n.uri,i.uri))})};i.resolveMediaGroupUris=c;l=function(n,t){var i=n.segments[n.segments.length-1],r=undefined;return t&&i&&i.duration?i.duration*1e3:(n.targetDuration||10)*500};i.refreshDelay=l;w=function(n){function t(n,i,u){var f=this;if(b(this,t),v(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),this.srcUrl=n,this.hls_=i,this.withCredentials=u,!this.srcUrl)throw new Error("A non-empty playlist URL is required");this.state="HAVE_NOTHING";this.on("mediaupdatetimeout",function(){f.state==="HAVE_METADATA"&&(f.state="HAVE_CURRENT_METADATA",f.request=f.hls_.xhr({uri:r["default"](f.master.uri,f.media().uri),withCredentials:f.withCredentials},function(n){if(f.request){if(n)return f.playlistRequestError(f.request,f.media().uri,"HAVE_METADATA");f.haveMetadata(f.request,f.media().uri)}}))})}return k(t,n),a(t,[{key:"playlistRequestError",value:function(n,t,i){this.request=null;i&&(this.state=i);this.error={playlist:this.master.playlists[t],status:n.status,message:"HLS playlist request error at URL: "+t,responseText:n.responseText,code:n.status>=500?4:2};this.trigger("error")}},{key:"haveMetadata",value:function(n,t){var f=this,i,r;this.request=null;this.state="HAVE_METADATA";i=new y["default"].Parser;i.push(n.responseText);i.end();i.manifest.uri=t;i.manifest.attributes=i.manifest.attributes||{};r=s(this.master,i.manifest);this.targetDuration=i.manifest.targetDuration;r?(this.master=r,this.media_=this.master.playlists[i.manifest.uri]):this.trigger("playlistunchanged");this.media().endList||(u["default"].clearTimeout(this.mediaUpdateTimeout),this.mediaUpdateTimeout=u["default"].setTimeout(function(){f.trigger("mediaupdatetimeout")},l(this.media(),!!r)));this.trigger("loadedplaylist")}},{key:"dispose",value:function(){this.stopRequest();u["default"].clearTimeout(this.mediaUpdateTimeout)}},{key:"stopRequest",value:function(){if(this.request){var n=this.request;this.request=null;n.onreadystatechange=null;n.abort()}}},{key:"media",value:function(n){var t=this,i,u;if(!n)return this.media_;if(this.state==="HAVE_NOTHING")throw new Error("Cannot switch media playlist from "+this.state);if(i=this.state,typeof n=="string"){if(!this.master.playlists[n])throw new Error("Unknown playlist URI: "+n);n=this.master.playlists[n]}if(u=!this.media_||n.uri!==this.media_.uri,this.master.playlists[n.uri].endList){this.request&&(this.request.onreadystatechange=null,this.request.abort(),this.request=null);this.state="HAVE_METADATA";this.media_=n;u&&(this.trigger("mediachanging"),this.trigger("mediachange"));return}if(u){if(this.state="SWITCHING_MEDIA",this.request){if(r["default"](this.master.uri,n.uri)===this.request.url)return;this.request.onreadystatechange=null;this.request.abort();this.request=null}this.media_&&this.trigger("mediachanging");this.request=this.hls_.xhr({uri:r["default"](this.master.uri,n.uri),withCredentials:this.withCredentials},function(r,u){if(t.request){if(r)return t.playlistRequestError(t.request,n.uri,i);t.haveMetadata(u,n.uri);i==="HAVE_MASTER"?t.trigger("loadedmetadata"):t.trigger("mediachange")}})}}},{key:"pause",value:function(){this.stopRequest();u["default"].clearTimeout(this.mediaUpdateTimeout);this.state==="HAVE_NOTHING"&&(this.started=!1);this.state==="SWITCHING_MEDIA"?this.state=this.media_?"HAVE_METADATA":"HAVE_MASTER":this.state==="HAVE_CURRENT_METADATA"&&(this.state="HAVE_METADATA")}},{key:"load",value:function(n){var r=this,t,i;if(u["default"].clearTimeout(this.mediaUpdateTimeout),t=this.media(),n){i=t?t.targetDuration*500:5e3;this.mediaUpdateTimeout=u["default"].setTimeout(function(){return r.load()},i);return}if(!this.started){this.start();return}t&&!t.endList?this.trigger("mediaupdatetimeout"):this.trigger("loadedplaylist")}},{key:"start",value:function(){var n=this;this.started=!0;this.request=this.hls_.xhr({uri:this.srcUrl,withCredentials:this.withCredentials},function(t,i){if(n.request){if(n.request=null,t)return n.error={status:i.status,message:"HLS playlist request error at URL: "+n.srcUrl,responseText:i.responseText,code:2},n.state==="HAVE_NOTHING"&&(n.started=!1),n.trigger("error");var r=new y["default"].Parser;if(r.push(i.responseText),r.end(),n.state="HAVE_MASTER",r.manifest.uri=n.srcUrl,r.manifest.playlists){n.master=r.manifest;h(n.master);c(n.master);n.trigger("loadedplaylist");n.request||n.media(r.manifest.playlists[0]);return}return n.master={mediaGroups:{AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},uri:u["default"].location.href,playlists:[{uri:n.srcUrl}]},n.master.playlists[n.srcUrl]=n.master.playlists[0],n.master.playlists[0].resolvedUri=n.srcUrl,n.master.playlists[0].attributes=n.master.playlists[0].attributes||{},n.haveMetadata(i,n.srcUrl),n.trigger("loadedmetadata")}})}}]),t}(f.EventTarget);i["default"]=w}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./resolve-url":15,"global/window":32,"m3u8-parser":33}],10:[function(n,t,i){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}var h,e,c,l,a,v;Object.defineProperty(i,"__esModule",{value:!0});var y=n("./config"),p=s(y),w=n("./playlist"),r=s(w),b=n("./util/codecs.js"),f=function(n,t){var i=undefined;return n?(i=window.getComputedStyle(n),!i)?"":i[t]:""},u=function(n,t){var i=n.slice();n.sort(function(n,r){var u=t(n,r);return u===0?i.indexOf(n)-i.indexOf(r):u})},o=function(n,t){var i=undefined,r=undefined;return n.attributes.BANDWIDTH&&(i=n.attributes.BANDWIDTH),i=i||window.Number.MAX_VALUE,t.attributes.BANDWIDTH&&(r=t.attributes.BANDWIDTH),r=r||window.Number.MAX_VALUE,i-r};i.comparePlaylistBandwidth=o;h=function(n,t){var i=undefined,r=undefined;return(n.attributes.RESOLUTION&&n.attributes.RESOLUTION.width&&(i=n.attributes.RESOLUTION.width),i=i||window.Number.MAX_VALUE,t.attributes.RESOLUTION&&t.attributes.RESOLUTION.width&&(r=t.attributes.RESOLUTION.width),r=r||window.Number.MAX_VALUE,i===r&&n.attributes.BANDWIDTH&&t.attributes.BANDWIDTH)?n.attributes.BANDWIDTH-t.attributes.BANDWIDTH:i-r};i.comparePlaylistResolution=h;e=function(n,t,i,f){var e=n.playlists.map(function(n){var i=undefined,r=undefined,t=undefined;return i=n.attributes.RESOLUTION&&n.attributes.RESOLUTION.width,r=n.attributes.RESOLUTION&&n.attributes.RESOLUTION.height,t=n.attributes.BANDWIDTH,t=t||window.Number.MAX_VALUE,{bandwidth:t,width:i,height:r,playlist:n}}),o,c,y;u(e,function(n,t){return n.bandwidth-t.bandwidth});e=e.filter(function(n){return!r["default"].isIncompatible(n.playlist)});o=e.filter(function(n){return r["default"].isEnabled(n.playlist)});o.length||(o=e.filter(function(n){return!r["default"].isDisabled(n.playlist)}));var h=o.filter(function(n){return n.bandwidth*p["default"].BANDWIDTH_VARIANCE<t}),s=h[h.length-1],k=h.filter(function(n){return n.bandwidth===s.bandwidth})[0],v=h.filter(function(n){return n.width&&n.height});u(v,function(n,t){return n.width-t.width});c=v.filter(function(n){return n.width===i&&n.height===f});s=c[c.length-1];var w=c.filter(function(n){return n.bandwidth===s.bandwidth})[0],l=undefined,a=undefined,b=undefined;return w||(l=v.filter(function(n){return n.width>i||n.height>f}),a=l.filter(function(n){return n.width===l[0].width&&n.height===l[0].height}),s=a[a.length-1],b=a.filter(function(n){return n.bandwidth===s.bandwidth})[0]),y=b||w||k||o[0]||e[0],y?y.playlist:null};i.simpleSelector=e;c=function(){return e(this.playlists.master,this.systemBandwidth,parseInt(f(this.tech_.el(),"width"),10),parseInt(f(this.tech_.el(),"height"),10))};i.lastBandwidthSelector=c;l=function(n){var t=-1;if(n<0||n>1)throw new Error("Moving average bandwidth decay must be between 0 and 1.");return function(){return t<0&&(t=this.systemBandwidth),t=n*this.systemBandwidth+(1-n)*t,e(this.playlists.master,t,parseInt(f(this.tech_.el(),"width"),10),parseInt(f(this.tech_.el(),"height"),10))}};i.movingAverageBandwidthSelector=l;a=function(n){var s=n.master,h=n.currentTime,c=n.bandwidth,l=n.duration,a=n.segmentDuration,v=n.timeUntilRebuffer,y=n.currentTimeline,p=n.syncController,e=s.playlists.filter(function(n){return!r["default"].isIncompatible(n)}),t=e.filter(r["default"].isEnabled);t.length||(t=e.filter(function(n){return!r["default"].isDisabled(n)}));var w=t.filter(r["default"].hasAttribute.bind(null,"BANDWIDTH")),i=w.map(function(n){var t=p.getSyncPoint(n,l,y,h),i=t?1:2,u=r["default"].estimateSegmentRequestTime(a,c,n),f=u*i-v;return{playlist:n,rebufferingImpact:f}}),f=i.filter(function(n){return n.rebufferingImpact<=0});return(u(f,function(n,t){return o(t.playlist,n.playlist)}),f.length)?f[0]:(u(i,function(n,t){return n.rebufferingImpact-t.rebufferingImpact}),i[0]||null)};i.minRebufferMaxBandwidthSelector=a;v=function(){var n=this.playlists.master.playlists.filter(r["default"].isEnabled),t;return u(n,function(n,t){return o(n,t)}),t=n.filter(function(n){return b.parseCodecs(n.attributes.CODECS).videoCodec}),t[0]||null};i.lowestBitrateCompatibleVariantSelector=v},{"./config":3,"./playlist":11,"./util/codecs.js":19}],11:[function(n,t,i){(function(t){"use strict";function tt(n){return n&&n.__esModule?n:{"default":n}}var r,u,f,c,e,l,o,a,v,y,s,p,w;Object.defineProperty(i,"__esModule",{value:!0});var b=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,it=n("global/window"),rt=tt(it),ut=function(n,t){var r=0,u=t-n.mediaSequence,i=n.segments[u];if(i){if(typeof i.start!="undefined")return{result:i.start,precise:!0};if(typeof i.end!="undefined")return{result:i.end-i.duration,precise:!0}}while(u--){if(i=n.segments[u],typeof i.end!="undefined")return{result:r+i.end,precise:!0};if(r+=i.duration,typeof i.start!="undefined")return{result:r+i.start,precise:!0}}return{result:r,precise:!1}},ft=function(n,t){for(var r=0,i=undefined,u=t-n.mediaSequence;u<n.segments.length;u++){if(i=n.segments[u],typeof i.start!="undefined")return{result:i.start-r,precise:!0};if(r+=i.duration,typeof i.end!="undefined")return{result:i.end-r,precise:!0}}return{result:-1,precise:!1}},k=function(n,t,i){var r=undefined,u=undefined;return(typeof t=="undefined"&&(t=n.mediaSequence+n.segments.length),t<n.mediaSequence)?0:(r=ut(n,t),r.precise)?r.result:(u=ft(n,t),u.precise)?u.result:r.result+i},h=function(n,t,i){if(!n)return 0;if(typeof i!="number"&&(i=0),typeof t=="undefined"){if(n.totalDuration)return n.totalDuration;if(!n.endList)return rt["default"].Infinity}return k(n,t,i)};i.duration=h;r=function(n,t,i){var u=0,f,r;if(t>i&&(f=[i,t],t=f[0],i=f[1]),t<0){for(r=t;r<Math.min(0,i);r++)u+=n.targetDuration;t=0}for(r=t;r<i;r++)u+=n.segments[r].duration;return u};i.sumDurations=r;u=function(n){if(!n.segments.length)return 0;for(var t=n.segments.length-1,i=n.segments[t].duration||n.targetDuration,r=i+n.targetDuration*2;t--;)if(i+=n.segments[t].duration,i>=r)break;return Math.max(0,t)};i.safeLiveIndex=u;f=function(n,t,i){if(!n||!n.segments)return null;if(n.endList)return h(n);if(t===null)return null;t=t||0;var r=i?u(n):n.segments.length;return k(n,n.mediaSequence+r,t)};i.playlistEnd=f;c=function(n,t){var r=t||0,i=f(n,t,!0);return i===null?b.createTimeRange():b.createTimeRange(r,i)};i.seekable=c;var d=function(n){return n-Math.floor(n)==0},g=function(n,t){var r,i,u,f;if(d(t))return t+n*.1;for(r=t.toString().split(".")[1].length,i=1;i<=r;i++)if(u=Math.pow(10,i),f=t*u,d(f)||i===r)return(f+n)/u},et=g.bind(null,1),ot=g.bind(null,-1),nt=function(n,t,i,u){var f=undefined,o=undefined,s=n.segments.length,e=t-u;if(e<0){if(i>0)for(f=i-1;f>=0;f--)if(o=n.segments[f],e+=ot(o.duration),e>0)return{mediaIndex:f,startTime:u-r(n,i,f)};return{mediaIndex:0,startTime:t}}if(i<0){for(f=i;f<0;f++)if(e-=n.targetDuration,e<0)return{mediaIndex:0,startTime:t};i=0}for(f=i;f<s;f++)if(o=n.segments[f],e-=et(o.duration),e<0)return{mediaIndex:f,startTime:u+r(n,i,f)};return{mediaIndex:s-1,startTime:t}};i.getMediaInfoForTime=nt;e=function(n){return n.excludeUntil&&n.excludeUntil>Date.now()};i.isBlacklisted=e;l=function(n){return n.excludeUntil&&n.excludeUntil===Infinity};i.isIncompatible=l;o=function(n){var t=e(n);return!n.disabled&&!t};i.isEnabled=o;a=function(n){return n.disabled};i.isDisabled=a;v=function(n){for(var t=0;t<n.segments.length;t++)if(n.segments[t].key)return!0;return!1};i.isAes=v;y=function(n){for(var t=0;t<n.segments.length;t++)if(n.segments[t].map)return!0;return!1};i.isFmp4=y;s=function(n,t){return t.attributes&&t.attributes[n]};i.hasAttribute=s;p=function(n,t,i){var u=arguments.length<=3||arguments[3]===undefined?0:arguments[3],r;return s("BANDWIDTH",i)?(r=n*i.attributes.BANDWIDTH,(r-u*8)/t):NaN};i.estimateSegmentRequestTime=p;w=function(n,t){if(n.playlists.length===1)return!0;var i=t.attributes.BANDWIDTH||Number.MAX_VALUE;return n.playlists.filter(function(n){return o(n)?(n.attributes.BANDWIDTH||0)<i:!1}).length===0};i.isLowestEnabledRendition=w;i["default"]={duration:h,seekable:c,safeLiveIndex:u,getMediaInfoForTime:nt,isEnabled:o,isDisabled:a,isBlacklisted:e,isIncompatible:l,playlistEnd:f,isAes:v,isFmp4:y,hasAttribute:s,estimateSegmentRequestTime:p,isLowestEnabledRendition:w}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"global/window":32}],12:[function(n,t,i){(function(n){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}var f;Object.defineProperty(i,"__esModule",{value:!0});f=function(){function n(n,t){var r=[],u=!0,f=!1,e=undefined,i,o;try{for(i=n[Symbol.iterator]();!(u=(o=i.next()).done);u=!0)if(r.push(o.value),t&&r.length===t)break}catch(s){f=!0;e=s}finally{try{!u&&i["return"]&&i["return"]()}finally{if(f)throw e;}}return r}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance");}}();var h=typeof window!="undefined"?window.videojs:typeof n!="undefined"?n.videojs:null,r=s(h),u=1/30,c=u*3,l=function(n,t){var i=f(t,2),r=i[0],u=i[1];return Math.min(Math.max(r,n),u)},e=function(n,t){var u=[],i=undefined;if(n&&n.length)for(i=0;i<n.length;i++)t(n.start(i),n.end(i))&&u.push([n.start(i),n.end(i)]);return r["default"].createTimeRanges(u)},a=function(n,t){return e(n,function(n,i){return n-u<=t&&i+u>=t})},v=function(n,t){return e(n,function(n){return n-u>=t})},y=function(n){var i,t,u,f;if(n.length<2)return r["default"].createTimeRanges();for(i=[],t=1;t<n.length;t++)u=n.end(t-1),f=n.start(t),i.push([u,f]);return r["default"].createTimeRanges(i)},p=function(n,t){var i=undefined,u=undefined,r=undefined,f=[],e=[],o=function(n){return n[0]<=r&&n[1]>=r};if(n)for(i=0;i<n.length;i++)u=n.start(i),r=n.end(i),e.push([u,r]);if(t)for(i=0;i<t.length;i++)(u=t.start(i),r=t.end(i),e.some(o))||f.push(r);return f.length!==1?null:f[0]},o=function(n,t){var f=null,e=null,o=0,u=[],s=[],i;if(!n||!n.length||!t||!t.length)return r["default"].createTimeRange();for(i=n.length;i--;)u.push({time:n.start(i),type:"start"}),u.push({time:n.end(i),type:"end"});for(i=t.length;i--;)u.push({time:t.start(i),type:"start"}),u.push({time:t.end(i),type:"end"});for(u.sort(function(n,t){return n.time-t.time}),i=0;i<u.length;i++)u[i].type==="start"?(o++,o===2&&(f=u[i].time)):u[i].type==="end"&&(o--,o===1&&(e=u[i].time)),f!==null&&e!==null&&(s.push([f,e]),f=null,e=null);return r["default"].createTimeRanges(s)},w=function(n,t,i,r){for(var h=t.end(0)-t.start(0),l=n.end(0)-n.start(0),a=h-l,f=o(n,r),e=o(t,r),s=0,c=0,u=f.length;u--;)s+=f.end(u)-f.start(u),f.start(u)===i&&(s+=a);for(u=e.length;u--;)c+=e.end(u)-e.start(u);return Math.max(s,c)/h*100},b=function(n,t,i,u){var e=n+t,s=r["default"].createTimeRanges([[n,e]]),o=r["default"].createTimeRanges([[l(n,[i,e]),e]]),f;return o.start(0)===o.end(0)?0:(f=w(o,s,i,u),isNaN(f)||f===Infinity||f===-Infinity)?0:f},k=function(n){var i=[],t;if(!n||!n.length)return"";for(t=0;t<n.length;t++)i.push(n.start(t)+" => "+n.end(t));return i.join(", ")},d=function(n,t){var i=arguments.length<=2||arguments[2]===undefined?1:arguments[2],r=n.length?n.end(n.length-1):0;return(r-t)/i};i["default"]={findRange:a,findNextRange:v,findGaps:y,findSoleUncommonTimeRangesEnd:p,getSegmentBufferedPercent:b,TIME_FUDGE_FACTOR:u,SAFE_TIME_DELTA:c,printableRange:k,timeUntilRebuffer:d};t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],13:[function(n,t,i){(function(n){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var e=typeof window!="undefined"?window.videojs:typeof n!="undefined"?n.videojs:null,r=f(e),o={errorInterval:30,getSource:function(n){var t=this.tech({IWillNotUseThisInPlugins:!0}),i=t.currentSource_;return n(i)}},u=function u(n,t){var s=0,f=0,i=r["default"].mergeOptions(o,t);n.ready(function(){n.trigger({type:"usage",name:"hls-error-reload-initialized"})});var h=function(){f&&n.currentTime(f)},l=function(t){if(t!==null&&t!==undefined){f=n.duration()!==Infinity&&n.currentTime()||0;n.one("loadedmetadata",h);n.src(t);n.trigger({type:"usage",name:"hls-error-reload"});n.play()}},c=function(){if(Date.now()-s<i.errorInterval*1e3){n.trigger({type:"usage",name:"hls-error-reload-canceled"});return}if(!i.getSource||typeof i.getSource!="function"){r["default"].log.error("ERROR: reloadSourceOnError - The option getSource must be a function!");return}return s=Date.now(),i.getSource.call(n,l)},e=function e(){n.off("loadedmetadata",h);n.off("error",c);n.off("dispose",e)},a=function(t){e();u(n,t)};n.on("error",c);n.on("dispose",e);n.reloadSourceOnError=a},s=function(n){u(this,n)};i["default"]=s;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],14:[function(n,t,i){"use strict";function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}Object.defineProperty(i,"__esModule",{value:!0});var r=n("./playlist.js"),e=function(n,t,i){return function(u){var f=n.master.playlists[t],o=r.isIncompatible(f),e=r.isEnabled(f);return typeof u=="undefined"?e:(u?delete f.disabled:f.disabled=!0,u===e||o||(i(),u?n.trigger("renditionenabled"):n.trigger("renditiondisabled")),u)}},u=function u(n,t,i){var o,r;f(this,u);o=n.masterPlaylistController_.fastQualityChange_.bind(n.masterPlaylistController_);t.attributes.RESOLUTION&&(r=t.attributes.RESOLUTION,this.width=r.width,this.height=r.height);this.bandwidth=t.attributes.BANDWIDTH;this.id=i;this.enabled=e(n.playlists,t.uri,o)},o=function(n){var t=n.playlists;n.representations=function(){return t.master.playlists.filter(function(n){return!r.isIncompatible(n)}).map(function(t){return new u(n,t,t.uri)})}};i["default"]=o;t.exports=i["default"]},{"./playlist.js":11}],15:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var f=n("url-toolkit"),u=r(f),e=n("global/window"),o=r(e),s=function(n,t){return/^[a-z]+:/i.test(t)?t:(/\/\//i.test(n)||(n=u["default"].buildAbsoluteURL(o["default"].location.href,n)),u["default"].buildAbsoluteURL(n,t))};i["default"]=s;t.exports=i["default"]},{"global/window":32,"url-toolkit":63}],16:[function(n,t,i){(function(t){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function k(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function d(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var h,c,s,b;Object.defineProperty(i,"__esModule",{value:!0});h=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();c=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var g=n("./playlist"),e=u(g),nt=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,f=u(nt),tt=n("./source-updater"),it=u(tt),rt=n("./config"),ut=u(rt),ft=n("global/window"),r=u(ft),et=n("videojs-contrib-media-sources/es5/remove-cues-from-track.js"),l=u(et),a=n("./bin-utils"),o=n("./media-segment-request"),v=n("./ranges"),ot=n("./playlist-selectors"),st=500,y=function(n,t,i){if(!n||!t)return!1;var r=n.segments,u=i===r.length;return n.endList&&t.readyState==="open"&&u},p=function(n){return typeof n=="number"&&isFinite(n)},w=function(n,t,i){return n!=="main"||!t||!i?null:!i.containsAudio&&!i.containsVideo?"Neither audio nor video found in segment.":t.containsVideo&&!i.containsVideo?"Only audio found in segment when we expected video. We can't switch to audio only from a stream that had video. To get rid of this message, please add codec information to the manifest.":!t.containsVideo&&i.containsVideo?"Video found in segment when we expected only audio. We can't switch to a stream with video from an audio only stream. To get rid of this message, please add codec information to the manifest.":null};i.illegalMediaSwitch=w;s=function(n,t,i){var r=undefined;return r=n.length&&n.start(0)>0&&n.start(0)<t?n.start(0):t-30,Math.min(r,t-i)};i.safeBackBufferTrimTime=s;b=function(n){function t(n){var i=this,r=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];if(k(this,t),c(Object.getPrototypeOf(t.prototype),"constructor",this).call(this),!n)throw new TypeError("Initialization settings are required");if(typeof n.currentTime!="function")throw new TypeError("No currentTime getter specified");if(!n.mediaSource)throw new TypeError("No MediaSource specified");this.state="INIT";this.bandwidth=n.bandwidth;this.throughput={rate:0,count:0};this.roundTrip=NaN;this.resetStats_();this.mediaIndex=null;this.hasPlayed_=n.hasPlayed;this.currentTime_=n.currentTime;this.seekable_=n.seekable;this.seeking_=n.seeking;this.duration_=n.duration;this.mediaSource_=n.mediaSource;this.hls_=n.hls;this.loaderType_=n.loaderType;this.startingMedia_=void 0;this.segmentMetadataTrack_=n.segmentMetadataTrack;this.goalBufferLength_=n.goalBufferLength;this.checkBufferTimeout_=null;this.error_=void 0;this.currentTimeline_=-1;this.pendingSegment_=null;this.mimeType_=null;this.sourceUpdater_=null;this.xhrOptions_=null;this.activeInitSegmentId_=null;this.initSegments_={};this.decrypter_=n.decrypter;this.syncController_=n.syncController;this.syncPoint_={segmentIndex:0,time:0};this.syncController_.on("syncinfoupdate",function(){return i.trigger("syncinfoupdate")});this.mediaSource_.addEventListener("sourceopen",function(){return i.ended_=!1});this.fetchAtBuffer_=!1;r.debug&&(this.logger_=f["default"].log.bind(f["default"],"segment-loader",this.loaderType_,"->"))}return d(t,n),h(t,[{key:"resetStats_",value:function(){this.mediaBytesTransferred=0;this.mediaRequests=0;this.mediaRequestsAborted=0;this.mediaRequestsTimedout=0;this.mediaRequestsErrored=0;this.mediaTransferDuration=0;this.mediaSecondsLoaded=0}},{key:"dispose",value:function(){this.state="DISPOSED";this.pause();this.abort_();this.sourceUpdater_&&this.sourceUpdater_.dispose();this.resetStats_()}},{key:"abort",value:function(){if(this.state!=="WAITING"){this.pendingSegment_&&(this.pendingSegment_=null);return}this.abort_();this.state="READY";this.paused()||this.monitorBuffer_()}},{key:"abort_",value:function(){this.pendingSegment_&&this.pendingSegment_.abortRequests();this.pendingSegment_=null}},{key:"error",value:function(n){return typeof n!="undefined"&&(this.error_=n),this.pendingSegment_=null,this.error_}},{key:"endOfStream",value:function(){this.ended_=!0;this.pause();this.trigger("ended")}},{key:"buffered_",value:function(){return this.sourceUpdater_?this.sourceUpdater_.buffered():f["default"].createTimeRanges()}},{key:"initSegment",value:function(n){var r=arguments.length<=1||arguments[1]===undefined?!1:arguments[1],i,t;return n?(i=a.initSegmentId(n),t=this.initSegments_[i],r&&!t&&n.bytes&&(this.initSegments_[i]=t={resolvedUri:n.resolvedUri,byterange:n.byterange,bytes:n.bytes}),t||n):null}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&(this.sourceUpdater_||this.mimeType_&&this.state==="INIT")&&!this.paused()}},{key:"load",value:function(){if(this.monitorBuffer_(),this.playlist_){if(this.syncController_.setDateTimeMapping(this.playlist_),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();this.couldBeginLoading_()&&(this.state==="READY"||this.state==="INIT")&&(this.state="READY")}}},{key:"init_",value:function(){return this.state="READY",this.sourceUpdater_=new it["default"](this.mediaSource_,this.mimeType_),this.resetEverything(),this.monitorBuffer_()}},{key:"playlist",value:function(n){var u=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],i,t,r;if(n){if(i=this.playlist_,t=this.pendingSegment_,this.playlist_=n,this.xhrOptions_=u,this.hasPlayed_()||(n.syncInfo={mediaSequence:n.mediaSequence,time:0}),this.trigger("syncinfoupdate"),this.state==="INIT"&&this.couldBeginLoading_())return this.init_();if(!i||i.uri!==n.uri){this.mediaIndex!==null&&this.resyncLoader();return}r=n.mediaSequence-i.mediaSequence;this.logger_("mediaSequenceDiff",r);this.mediaIndex!==null&&(this.mediaIndex-=r);t&&(t.mediaIndex-=r,t.mediaIndex>=0&&(t.segment=n.segments[t.mediaIndex]));this.syncController_.saveExpiredSegmentInfo(i,n)}}},{key:"pause",value:function(){this.checkBufferTimeout_&&(r["default"].clearTimeout(this.checkBufferTimeout_),this.checkBufferTimeout_=null)}},{key:"paused",value:function(){return this.checkBufferTimeout_===null}},{key:"mimeType",value:function(n){this.mimeType_||(this.mimeType_=n,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_())}},{key:"resetEverything",value:function(){this.ended_=!1;this.resetLoader();this.remove(0,this.duration_());this.trigger("reseteverything")}},{key:"resetLoader",value:function(){this.fetchAtBuffer_=!1;this.resyncLoader()}},{key:"resyncLoader",value:function(){this.mediaIndex=null;this.syncPoint_=null;this.abort()}},{key:"remove",value:function(n,t){this.sourceUpdater_&&this.sourceUpdater_.remove(n,t);l["default"](n,t,this.segmentMetadataTrack_)}},{key:"monitorBuffer_",value:function(){this.checkBufferTimeout_&&r["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=r["default"].setTimeout(this.monitorBufferTick_.bind(this),1)}},{key:"monitorBufferTick_",value:function(){this.state==="READY"&&this.fillBuffer_();this.checkBufferTimeout_&&r["default"].clearTimeout(this.checkBufferTimeout_);this.checkBufferTimeout_=r["default"].setTimeout(this.monitorBufferTick_.bind(this),st)}},{key:"fillBuffer_",value:function(){var n,t;if(!this.sourceUpdater_.updating()&&(this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())),n=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_),n)){if(t=y(this.playlist_,this.mediaSource_,n.mediaIndex),t){this.endOfStream();return}(n.mediaIndex!==this.playlist_.segments.length-1||this.mediaSource_.readyState!=="ended"||this.seeking_())&&((n.timeline!==this.currentTimeline_||n.startOfSegment!==null&&n.startOfSegment<this.sourceUpdater_.timestampOffset())&&(this.syncController_.reset(),n.timestampOffset=n.startOfSegment),this.loadSegment_(n))}}},{key:"checkBuffer_",value:function(n,t,i,r,u,f){var h=0,o=undefined,c,l,s;return(n.length&&(h=n.end(n.length-1)),c=Math.max(0,h-u),!t.segments.length)?null:c>=this.goalBufferLength_()?null:!r&&c>=1?null:(this.logger_("checkBuffer_","mediaIndex:",i,"hasPlayed:",r,"currentTime:",u,"syncPoint:",f,"fetchAtBuffer:",this.fetchAtBuffer_,"bufferedTime:",c),f===null)?(i=this.getSyncSegmentCandidate_(t),this.logger_("getSync","mediaIndex:",i),this.generateSegmentInfo_(t,i,null,!0)):i!==null?(this.logger_("walkForward","mediaIndex:",i+1),l=t.segments[i],o=l&&l.end?l.end:h,this.generateSegmentInfo_(t,i+1,o,!1)):(this.fetchAtBuffer_?(s=e["default"].getMediaInfoForTime(t,h,f.segmentIndex,f.time),i=s.mediaIndex,o=s.startTime):(s=e["default"].getMediaInfoForTime(t,u,f.segmentIndex,f.time),i=s.mediaIndex,o=s.startTime),this.logger_("getMediaIndexForTime","mediaIndex:",i,"startOfSegment:",o),this.generateSegmentInfo_(t,i,o,!1))}},{key:"getSyncSegmentCandidate_",value:function(n){var i=this,t;return this.currentTimeline_===-1?0:(t=n.segments.map(function(n,t){return{timeline:n.timeline,segmentIndex:t}}).filter(function(n){return n.timeline===i.currentTimeline_}),t.length)?t[Math.min(t.length-1,1)].segmentIndex:Math.max(n.segments.length-1,0)}},{key:"generateSegmentInfo_",value:function(n,t,i,r){if(t<0||t>=n.segments.length)return null;var u=n.segments[t];return{requestId:"segment-loader-"+Math.random(),uri:u.resolvedUri,mediaIndex:t,isSyncRequest:r,startOfSegment:i,playlist:n,bytes:null,encryptedBytes:null,timestampOffset:null,timeline:u.timeline,duration:u.duration,segment:u}}},{key:"abortRequestEarly_",value:function(n){var t;if(this.hls_.tech_.paused()||!this.xhrOptions_.timeout||!this.playlist_.attributes.BANDWIDTH||Date.now()-(n.firstBytesReceivedAt||Date.now())<1e3)return!1;var r=this.currentTime_(),u=n.bandwidth,f=this.pendingSegment_.duration,o=e["default"].estimateSegmentRequestTime(f,u,this.playlist_,n.bytesReceived),i=v.timeUntilRebuffer(this.buffered_(),r,this.hls_.tech_.playbackRate())-1;if(o<=i)return!1;if(t=ot.minRebufferMaxBandwidthSelector({master:this.hls_.playlists.master,currentTime:r,bandwidth:u,duration:this.duration_(),segmentDuration:f,timeUntilRebuffer:i,currentTimeline:this.currentTimeline_,syncController:this.syncController_}),t){var h=o-i,c=h-t.rebufferingImpact,s=.5;return(i<=v.TIME_FUDGE_FACTOR&&(s=1),!t.playlist||t.playlist.uri===this.playlist_.uri||c<s)?!1:(this.bandwidth=t.playlist.attributes.BANDWIDTH*ut["default"].BANDWIDTH_VARIANCE+1,this.abort(),this.trigger("earlyabort"),!0)}}},{key:"handleProgress_",value:function(n,t){this.pendingSegment_&&t.requestId===this.pendingSegment_.requestId&&!this.abortRequestEarly_(t.stats)&&this.trigger("progress")}},{key:"loadSegment_",value:function(n){this.state="WAITING";this.pendingSegment_=n;this.trimBackBuffer_(n);n.abortRequests=o.mediaSegmentRequest(this.hls_.xhr,this.xhrOptions_,this.decrypter_,this.createSimplifiedSegmentObj_(n),this.handleProgress_.bind(this),this.segmentRequestFinished_.bind(this))}},{key:"trimBackBuffer_",value:function(){var n=s(this.seekable_(),this.currentTime_(),this.playlist_.targetDuration||10);n>0&&this.remove(0,n)}},{key:"createSimplifiedSegmentObj_",value:function(n){var t=n.segment,i={resolvedUri:t.resolvedUri,byterange:t.byterange,requestId:n.requestId},r;return t.key&&(r=t.key.iv||new Uint32Array([0,0,0,n.mediaIndex+n.playlist.mediaSequence]),i.key={resolvedUri:t.key.resolvedUri,iv:r}),t.map&&(i.map=this.initSegment(t.map)),i}},{key:"segmentRequestFinished_",value:function(n,t){if(this.mediaRequests+=1,t.stats&&(this.mediaBytesTransferred+=t.stats.bytesReceived,this.mediaTransferDuration+=t.stats.roundTripTime),!this.pendingSegment_){this.mediaRequestsAborted+=1;return}if(t.requestId===this.pendingSegment_.requestId){if(n){if(this.pendingSegment_=null,this.state="READY",n.code===o.REQUEST_ERRORS.ABORTED){this.mediaRequestsAborted+=1;return}if(this.pause(),n.code===o.REQUEST_ERRORS.TIMEOUT){this.mediaRequestsTimedout+=1;this.bandwidth=1;this.roundTrip=NaN;this.trigger("bandwidthupdate");return}this.mediaRequestsErrored+=1;this.error(n);this.trigger("error");return}this.bandwidth=t.stats.bandwidth;this.roundTrip=t.stats.roundTripTime;t.map&&(t.map=this.initSegment(t.map,!0));this.processSegmentResponse_(t)}}},{key:"processSegmentResponse_",value:function(n){var t=this.pendingSegment_;t.bytes=n.bytes;n.map&&(t.segment.map.bytes=n.map.bytes);t.endOfAllRequests=n.endOfAllRequests;this.handleSegment_()}},{key:"handleSegment_",value:function(){var r=this,u,f;if(!this.pendingSegment_){this.state="READY";return}var n=this.pendingSegment_,t=n.segment,i=this.syncController_.probeSegmentInfo(n);if(typeof this.startingMedia_=="undefined"&&i&&(i.containsAudio||i.containsVideo)&&(this.startingMedia_={containsAudio:i.containsAudio,containsVideo:i.containsVideo}),u=w(this.loaderType_,this.startingMedia_,i),u){this.error({message:u,blacklistDuration:Infinity});this.trigger("error");return}if(n.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}n.timestampOffset!==null&&n.timestampOffset!==this.sourceUpdater_.timestampOffset()&&(this.sourceUpdater_.timestampOffset(n.timestampOffset),this.trigger("timestampoffset"));f=this.syncController_.mappingForTimeline(n.timeline);f!==null&&this.trigger({type:"segmenttimemapping",mapping:f});this.state="APPENDING";t.map&&function(){var n=a.initSegmentId(t.map),i;r.activeInitSegmentId_&&r.activeInitSegmentId_===n||(i=r.initSegment(t.map),r.sourceUpdater_.appendBuffer(i.bytes,function(){r.activeInitSegmentId_=n}))}();n.byteLength=n.bytes.byteLength;this.mediaSecondsLoaded+=typeof t.start=="number"&&typeof t.end=="number"?t.end-t.start:t.duration;this.sourceUpdater_.appendBuffer(n.bytes,this.handleUpdateEnd_.bind(this))}},{key:"handleUpdateEnd_",value:function(){var i;if(this.logger_("handleUpdateEnd_","segmentInfo:",this.pendingSegment_),!this.pendingSegment_){this.state="READY";this.paused()||this.monitorBuffer_();return}var n=this.pendingSegment_,t=n.segment,r=this.mediaIndex!==null;if(this.pendingSegment_=null,this.recordThroughput_(n),this.addSegmentMetadataCue_(n),this.state="READY",this.mediaIndex=n.mediaIndex,this.fetchAtBuffer_=!0,this.currentTimeline_=n.timeline,this.trigger("syncinfoupdate"),t.end&&this.currentTime_()-t.end>n.playlist.targetDuration*3){this.resetEverything();return}r&&this.trigger("bandwidthupdate");this.trigger("progress");i=y(n.playlist,this.mediaSource_,n.mediaIndex+1);i&&this.endOfStream();this.paused()||this.monitorBuffer_()}},{key:"recordThroughput_",value:function(n){var t=this.throughput.rate,i=Date.now()-n.endOfAllRequests+1,r=Math.floor(n.byteLength/i*8e3);this.throughput.rate+=(r-t)/++this.throughput.count}},{key:"logger_",value:function(){}},{key:"addSegmentMetadataCue_",value:function(n){if(this.segmentMetadataTrack_){var u=n.segment,t=u.start,i=u.end;if(p(t)&&p(i)){l["default"](t,i,this.segmentMetadataTrack_);var o=r["default"].WebKitDataCue||r["default"].VTTCue,f={bandwidth:n.playlist.attributes.BANDWIDTH,resolution:n.playlist.attributes.RESOLUTION,codecs:n.playlist.attributes.CODECS,byteLength:n.byteLength,uri:n.uri,timeline:n.timeline,playlist:n.playlist.uri,start:t,end:i},s=JSON.stringify(f),e=new o(t,i,s);e.value=f;this.segmentMetadataTrack_.addCue(e)}}}}]),t}(f["default"].EventTarget);i["default"]=b}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./media-segment-request":7,"./playlist":11,"./playlist-selectors":10,"./ranges":12,"./source-updater":17,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],17:[function(n,t,i){(function(n){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var r;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var e=typeof window!="undefined"?window.videojs:typeof n!="undefined"?n.videojs:null,o=u(e),s=function(){},h=function(){function n(t,i){var r=this,u;f(this,n);u=function(){r.sourceBuffer_=t.addSourceBuffer(i);r.onUpdateendCallback_=function(){var n=r.pendingCallback_;r.pendingCallback_=null;n&&n();r.runCallback_()};r.sourceBuffer_.addEventListener("updateend",r.onUpdateendCallback_);r.runCallback_()};this.callbacks_=[];this.pendingCallback_=null;this.timestampOffset_=0;this.mediaSource=t;this.processedAppend_=!1;t.readyState==="closed"?t.addEventListener("sourceopen",u):u()}return r(n,[{key:"abort",value:function(n){var t=this;this.processedAppend_&&this.queueCallback_(function(){t.sourceBuffer_.abort()},n)}},{key:"appendBuffer",value:function(n,t){var i=this;this.processedAppend_=!0;this.queueCallback_(function(){i.sourceBuffer_.appendBuffer(n)},t)}},{key:"buffered",value:function(){return this.sourceBuffer_?this.sourceBuffer_.buffered:o["default"].createTimeRanges()}},{key:"remove",value:function(n,t){var i=this;this.processedAppend_&&this.queueCallback_(function(){i.sourceBuffer_.remove(n,t)},s)}},{key:"updating",value:function(){return!this.sourceBuffer_||this.sourceBuffer_.updating||this.pendingCallback_}},{key:"timestampOffset",value:function(n){var t=this;return typeof n!="undefined"&&(this.queueCallback_(function(){t.sourceBuffer_.timestampOffset=n}),this.timestampOffset_=n),this.timestampOffset_}},{key:"queueCallback_",value:function(n,t){this.callbacks_.push([n.bind(this),t]);this.runCallback_()}},{key:"runCallback_",value:function(){var n=undefined;!this.updating()&&this.callbacks_.length&&(n=this.callbacks_.shift(),this.pendingCallback_=n[1],n[0]())}},{key:"dispose",value:function(){this.sourceBuffer_.removeEventListener("updateend",this.onUpdateendCallback_);this.sourceBuffer_&&this.mediaSource.readyState==="open"&&this.sourceBuffer_.abort()}}]),n}();i["default"]=h;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],18:[function(n,t,i){(function(t){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function a(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var e,o,c;Object.defineProperty(i,"__esModule",{value:!0});e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();o=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var v=n("mux.js/lib/mp4/probe"),h=s(v),y=n("mux.js/lib/tools/ts-inspector.js"),r=n("./playlist"),p=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,u=s(p),f=[{name:"VOD",run:function(n,t,i){return i!==Infinity?{time:0,segmentIndex:0}:null}},{name:"ProgramDateTime",run:function(n,t){if(n.datetimeToDisplayTime&&t.dateTimeObject){var i=t.dateTimeObject.getTime()/1e3,r=i+n.datetimeToDisplayTime;return{time:r,segmentIndex:0}}return null}},{name:"Segment",run:function(n,t,i,r,u){var c=t.segments||[],h=null,f=null,e,o,s;for(u=u||0,e=0;e<c.length;e++)if(o=c[e],o.timeline===r&&typeof o.start!="undefined"){if(s=Math.abs(u-o.start),f!==null&&f<s)break;(!h||f===null||f>=s)&&(f=s,h={time:o.start,segmentIndex:e})}return h}},{name:"Discontinuity",run:function(n,t,i,r,u){var s=null,f,e,o;if(u=u||0,t.discontinuityStarts&&t.discontinuityStarts.length)for(f=null,e=0;e<t.discontinuityStarts.length;e++){var c=t.discontinuityStarts[e],l=t.discontinuitySequence+e+1,h=n.discontinuities[l];if(h){if(o=Math.abs(u-h.time),f!==null&&f<o)break;(!s||f===null||f>=o)&&(f=o,s={time:h.time,segmentIndex:c})}}return s}},{name:"Playlist",run:function(n,t){return t.syncInfo?{time:t.syncInfo.time,segmentIndex:t.syncInfo.mediaSequence-t.mediaSequence}:null}}];i.syncPointStrategies=f;c=function(n){function t(){var n=arguments.length<=0||arguments[0]===undefined?{}:arguments[0];l(this,t);o(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.inspectCache_=undefined;this.timelines=[];this.discontinuities=[];this.datetimeToDisplayTime=null;n.debug&&(this.logger_=u["default"].log.bind(u["default"],"sync-controller ->"))}return a(t,n),e(t,[{key:"getSyncPoint",value:function(n,t,i,r){var u=this.runStrategies_(n,t,i,r);return u.length?this.selectSyncPoint_(u,{key:"time",value:r}):null}},{key:"getExpiredTime",value:function(n,t){var u,i;return!n||!n.segments?null:(u=this.runStrategies_(n,t,n.discontinuitySequence,0),!u.length)?null:(i=this.selectSyncPoint_(u,{key:"segmentIndex",value:0}),i.segmentIndex>0&&(i.time*=-1),Math.abs(i.time+r.sumDurations(n,i.segmentIndex,0)))}},{key:"runStrategies_",value:function(n,t,i,r){for(var u,e,s=[],o=0;o<f.length;o++)u=f[o],e=u.run(this,n,t,i,r),e&&(e.strategy=u.name,s.push({strategy:u.name,syncPoint:e}),this.logger_("syncPoint found via <"+u.name+">:",e));return s}},{key:"selectSyncPoint_",value:function(n,t){for(var u,r=n[0].syncPoint,f=Math.abs(n[0].syncPoint[t.key]-t.value),e=n[0].strategy,i=1;i<n.length;i++)u=Math.abs(n[i].syncPoint[t.key]-t.value),u<f&&(f=u,r=n[i].syncPoint,e=n[i].strategy);return this.logger_("syncPoint with strategy <"+e+"> chosen: ",r),r}},{key:"saveExpiredSegmentInfo",value:function(n,t){for(var r,u=t.mediaSequence-n.mediaSequence,i=u-1;i>=0;i--)if(r=n.segments[i],r&&typeof r.start!="undefined"){t.syncInfo={mediaSequence:n.mediaSequence+i,time:r.start};this.logger_("playlist sync:",t.syncInfo);this.trigger("syncinfoupdate");break}}},{key:"setDateTimeMapping",value:function(n){if(!this.datetimeToDisplayTime&&n.dateTimeObject){var t=n.dateTimeObject.getTime()/1e3;this.datetimeToDisplayTime=-t}}},{key:"reset",value:function(){this.inspectCache_=undefined}},{key:"probeSegmentInfo",value:function(n){var r=n.segment,i=n.playlist,t=undefined;return t=r.map?this.probeMp4Segment_(n):this.probeTsSegment_(n),t&&this.calculateSegmentTimeMapping_(n,t)&&(this.saveDiscontinuitySyncInfo_(n),i.syncInfo||(i.syncInfo={mediaSequence:i.mediaSequence+n.mediaIndex,time:r.start})),t}},{key:"probeMp4Segment_",value:function(n){var i=n.segment,r=h["default"].timescale(i.map.bytes),t=h["default"].startTime(r,n.bytes);return n.timestampOffset!==null&&(n.timestampOffset-=t),{start:t,end:t+i.duration}}},{key:"probeTsSegment_",value:function(n){var t=y.inspect(n.bytes,this.inspectCache_),i=undefined,r=undefined;return t?(t.video&&t.video.length===2?(this.inspectCache_=t.video[1].dts,i=t.video[0].dtsTime,r=t.video[1].dtsTime):t.audio&&t.audio.length===2&&(this.inspectCache_=t.audio[1].dts,i=t.audio[0].dtsTime,r=t.audio[1].dtsTime),{start:i,end:r,containsVideo:t.video&&t.video.length===2,containsAudio:t.audio&&t.audio.length===2}):null}},{key:"timestampOffsetForTimeline",value:function(n){return typeof this.timelines[n]=="undefined"?null:this.timelines[n].time}},{key:"mappingForTimeline",value:function(n){return typeof this.timelines[n]=="undefined"?null:this.timelines[n].mapping}},{key:"calculateSegmentTimeMapping_",value:function(n,t){var r=n.segment,i=this.timelines[n.timeline];if(n.timestampOffset!==null)this.logger_("tsO:",n.timestampOffset),i={time:n.startOfSegment,mapping:n.startOfSegment-t.start},this.timelines[n.timeline]=i,this.trigger("timestampoffset"),r.start=n.startOfSegment,r.end=t.end+i.mapping;else if(i)r.start=t.start+i.mapping,r.end=t.end+i.mapping;else return!1;return!0}},{key:"saveDiscontinuitySyncInfo_",value:function(n){var t=n.playlist,i=n.segment,u,o;if(i.discontinuity)this.discontinuities[i.timeline]={time:i.start,accuracy:0};else if(t.discontinuityStarts.length)for(u=0;u<t.discontinuityStarts.length;u++){var f=t.discontinuityStarts[u],e=t.discontinuitySequence+u+1,s=f-n.mediaIndex,h=Math.abs(s);(!this.discontinuities[e]||this.discontinuities[e].accuracy>h)&&(o=undefined,o=s<0?i.start-r.sumDurations(t,n.mediaIndex,f):i.end+r.sumDurations(t,n.mediaIndex+1,f),this.discontinuities[e]={time:o,accuracy:h})}}},{key:"logger_",value:function(){}}]),t}(u["default"].EventTarget);i["default"]=c}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./playlist":11,"mux.js/lib/mp4/probe":57,"mux.js/lib/tools/ts-inspector.js":59}],19:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(){var i=arguments.length<=0||arguments[0]===undefined?"":arguments[0],n={codecCount:0},t=undefined;return n.codecCount=i.split(",").length,n.codecCount=n.codecCount||2,t=/(^|\s|,)+(avc1)([^ ,]*)/i.exec(i),t&&(n.videoCodec=t[2],n.videoObjectTypeIndicator=t[3]),n.audioProfile=/(^|\s|,)+mp4a.[0-9A-Fa-f]+\.([0-9A-Fa-f]+)/i.exec(i),n.audioProfile=n.audioProfile&&n.audioProfile[2],n};i.parseCodecs=r},{}],20:[function(n,t,i){(function(r){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function a(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var o,s;Object.defineProperty(i,"__esModule",{value:!0});o=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();s=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var v=n("./segment-loader"),y=f(v),p=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,e=f(p),w=n("global/window"),u=f(w),b=n("videojs-contrib-media-sources/es5/remove-cues-from-track.js"),k=f(b),d=n("./bin-utils"),h=new Uint8Array("\n\n".split("").map(function(n){return n.charCodeAt(0)})),c=function(n){return String.fromCharCode.apply(null,n)},g=function(n){function t(n){var i=arguments.length<=1||arguments[1]===undefined?{}:arguments[1];l(this,t);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,n,i);this.mediaSource_=null;this.subtitlesTrack_=null}return a(t,n),o(t,[{key:"buffered_",value:function(){if(!this.subtitlesTrack_||!this.subtitlesTrack_.cues.length)return e["default"].createTimeRanges();var n=this.subtitlesTrack_.cues,t=n[0].startTime,i=n[n.length-1].startTime;return e["default"].createTimeRanges([[t,i]])}},{key:"initSegment",value:function(n){var f=arguments.length<=1||arguments[1]===undefined?!1:arguments[1],r,t,u,i;return n?(r=d.initSegmentId(n),t=this.initSegments_[r],f&&!t&&n.bytes&&(u=h.byteLength+n.bytes.byteLength,i=new Uint8Array(u),i.set(n.bytes),i.set(h,n.bytes.byteLength),this.initSegments_[r]=t={resolvedUri:n.resolvedUri,byterange:n.byterange,bytes:i}),t||n):null}},{key:"couldBeginLoading_",value:function(){return this.playlist_&&this.subtitlesTrack_&&!this.paused()}},{key:"init_",value:function(){return this.state="READY",this.resetEverything(),this.monitorBuffer_()}},{key:"track",value:function(n){return typeof n=="undefined"?this.subtitlesTrack_:(this.subtitlesTrack_=n,this.state==="INIT"&&this.couldBeginLoading_()&&this.init_(),this.subtitlesTrack_)}},{key:"remove",value:function(n,t){k["default"](n,t,this.subtitlesTrack_)}},{key:"fillBuffer_",value:function(){var t=this,n,i;if(this.syncPoint_||(this.syncPoint_=this.syncController_.getSyncPoint(this.playlist_,this.duration_(),this.currentTimeline_,this.currentTime_())),n=this.checkBuffer_(this.buffered_(),this.playlist_,this.mediaIndex,this.hasPlayed_(),this.currentTime_(),this.syncPoint_),n=this.skipEmptySegments_(n),n){if(this.syncController_.timestampOffsetForTimeline(n.timeline)===null){i=function(){t.state="READY";t.paused()||t.monitorBuffer_()};this.syncController_.one("timestampoffset",i);this.state="WAITING_ON_TIMELINE";return}this.loadSegment_(n)}}},{key:"skipEmptySegments_",value:function(n){while(n&&n.segment.empty)n=this.generateSegmentInfo_(n.playlist,n.mediaIndex+1,n.startOfSegment+n.duration,n.isSyncRequest);return n}},{key:"handleSegment_",value:function(){var t=this,n,i,r;if(!this.pendingSegment_||!this.subtitlesTrack_){this.state="READY";return}if(this.state="APPENDING",n=this.pendingSegment_,i=n.segment,typeof u["default"].WebVTT!="function"&&this.subtitlesTrack_&&this.subtitlesTrack_.tech_&&(r=function(){var n=function(){t.handleSegment_()};t.state="WAITING_ON_VTTJS";t.subtitlesTrack_.tech_.one("vttjsloaded",n);t.subtitlesTrack_.tech_.one("vttjserror",function(){t.subtitlesTrack_.tech_.off("vttjsloaded",n);t.error({message:"Error loading vtt.js"});t.state="READY";t.pause();t.trigger("error")});return{v:undefined}}(),typeof r=="object"))return r.v;i.requested=!0;try{this.parseVTTCues_(n)}catch(f){return this.error({message:f.message}),this.state="READY",this.pause(),this.trigger("error")}if(this.updateTimeMapping_(n,this.syncController_.timelines[n.timeline],this.playlist_),n.isSyncRequest){this.trigger("syncinfoupdate");this.pendingSegment_=null;this.state="READY";return}n.byteLength=n.bytes.byteLength;this.mediaSecondsLoaded+=i.duration;n.cues.length&&this.remove(n.cues[0].endTime,n.cues[n.cues.length-1].endTime);n.cues.forEach(function(n){t.subtitlesTrack_.addCue(n)});this.handleUpdateEnd_()}},{key:"parseVTTCues_",value:function(n){var f=undefined,o=!1,t,i,r;typeof u["default"].TextDecoder=="function"?f=new u["default"].TextDecoder("utf8"):(f=u["default"].WebVTT.StringDecoder(),o=!0);t=new u["default"].WebVTT.Parser(u["default"],u["default"].vttjs,f);n.cues=[];n.timestampmap={MPEGTS:0,LOCAL:0};t.oncue=n.cues.push.bind(n.cues);t.ontimestampmap=function(t){return n.timestampmap=t};t.onparsingerror=function(n){e["default"].log.warn("Error encountered when parsing cues: "+n.message)};n.segment.map&&(i=n.segment.map.bytes,o&&(i=c(i)),t.parse(i));r=n.bytes;o&&(r=c(r));t.parse(r);t.flush()}},{key:"updateTimeMapping_",value:function(n,t,i){var f=n.segment,r,u,e,o;if(t){if(!n.cues.length){f.empty=!0;return}r=n.timestampmap;u=r.MPEGTS/9e4-r.LOCAL+t.mapping;n.cues.forEach(function(n){n.startTime+=u;n.endTime+=u});i.syncInfo||(e=n.cues[0].startTime,o=n.cues[n.cues.length-1].startTime,i.syncInfo={mediaSequence:i.mediaSequence+n.mediaIndex,time:Math.min(e,o-f.duration)})}}}]),t}(y["default"]);i["default"]=g;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./bin-utils":2,"./segment-loader":16,"global/window":32,"videojs-contrib-media-sources/es5/remove-cues-from-track.js":72}],21:[function(n,t,i){(function(n){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var r=typeof window!="undefined"?window.videojs:typeof n!="undefined"?n.videojs:null,f=u(r),e=function(){return function n(t,i){var e,o,u,s;return t=r.mergeOptions({timeout:45e3},t),e=n.beforeRequest||f["default"].Hls.xhr.beforeRequest,e&&typeof e=="function"&&(o=e(t),o&&(t=o)),u=r.xhr(t,function(n,t){var r=u.response;!n&&r&&(u.responseTime=Date.now(),u.roundTripTime=u.responseTime-u.requestTime,u.bytesReceived=r.byteLength||r.length,u.bandwidth||(u.bandwidth=Math.floor(u.bytesReceived/u.roundTripTime*8e3)));n&&n.code==="ETIMEDOUT"&&(u.timedout=!0);n||u.aborted||t.statusCode===200||t.statusCode===206||t.statusCode===0||(n=new Error("XHR Failed with a response of: "+(u&&(r||u.responseText))));i(n,u)}),s=u.abort,u.abort=function(){return u.aborted=!0,s.apply(u,arguments)},u.uri=t.uri,u.requestTime=Date.now(),u}};i["default"]=e;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],22:[function(n,t,i){"use strict";function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var u;Object.defineProperty(i,"__esModule",{value:!0});u=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var e=function(){for(var h=[[[],[],[],[],[]],[[],[],[],[],[]]],f=h[0],e=h[1],l=f[4],p=e[4],n=undefined,i=undefined,r=undefined,u=[],a=[],c=undefined,v=undefined,y=undefined,t=undefined,o=undefined,s=undefined,n=0;n<256;n++)a[(u[n]=n<<1^(n>>7)*283)^n]=n;for(i=r=0;!l[i];i^=c||1,r=a[r]||1)for(t=r^r<<1^r<<2^r<<3^r<<4,t=t>>8^t&255^99,l[i]=t,p[t]=i,y=u[v=u[c=u[i]]],s=y*16843009^v*65537^c*257^i*16843008,o=u[t]*257^t*16843008,n=0;n<4;n++)f[n][i]=o=o<<24^o>>>8,e[n][t]=s=s<<24^s>>>8;for(n=0;n<5;n++)f[n]=f[n].slice(0),e[n]=e[n].slice(0);return h},r=null,o=function(){function n(t){f(this,n);r||(r=e());this._tables=[[r[0][0].slice(),r[0][1].slice(),r[0][2].slice(),r[0][3].slice(),r[0][4].slice()],[r[1][0].slice(),r[1][1].slice(),r[1][2].slice(),r[1][3].slice(),r[1][4].slice()]];var u=undefined,c=undefined,i=undefined,h=undefined,v=undefined,s=this._tables[0][4],l=this._tables[1],o=t.length,a=1;if(o!==4&&o!==6&&o!==8)throw new Error("Invalid aes key size");for(h=t.slice(0),v=[],this._key=[h,v],u=o;u<4*o+28;u++)i=h[u-1],(u%o==0||o===8&&u%o==4)&&(i=s[i>>>24]<<24^s[i>>16&255]<<16^s[i>>8&255]<<8^s[i&255],u%o==0&&(i=i<<8^i>>>24^a<<24,a=a<<1^(a>>7)*283)),h[u]=h[u-o]^i;for(c=0;u;c++,u--)i=h[c&3?u:u-4],v[c]=u<=4||c<4?i:l[0][s[i>>>24]]^l[1][s[i>>16&255]]^l[2][s[i>>8&255]]^l[3][s[i&255]]}return u(n,[{key:"decrypt",value:function(n,t,i,r,u,f){for(var e=this._key[1],o=n^e[0],s=r^e[1],h=i^e[2],c=t^e[3],y=undefined,g=undefined,nt=undefined,tt=e.length/4-2,l=undefined,a=4,v=this._tables[1],p=v[0],w=v[1],b=v[2],k=v[3],d=v[4],l=0;l<tt;l++)y=p[o>>>24]^w[s>>16&255]^b[h>>8&255]^k[c&255]^e[a],g=p[s>>>24]^w[h>>16&255]^b[c>>8&255]^k[o&255]^e[a+1],nt=p[h>>>24]^w[c>>16&255]^b[o>>8&255]^k[s&255]^e[a+2],c=p[c>>>24]^w[o>>16&255]^b[s>>8&255]^k[h&255]^e[a+3],a+=4,o=y,s=g,h=nt;for(l=0;l<4;l++)u[(3&-l)+f]=d[o>>>24]<<24^d[s>>16&255]<<16^d[h>>8&255]<<8^d[c&255]^e[a++],y=o,o=s,s=h,h=c,c=y}}]),n}();i["default"]=o;t.exports=i["default"]},{}],23:[function(n,t,i){"use strict";function e(n){return n&&n.__esModule?n:{"default":n}}function o(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function s(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var r,u;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();u=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var h=n("./stream"),f=e(h),c=function(n){function t(){o(this,t);u(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,f["default"]);this.jobs=[];this.delay=1;this.timeout_=null}return s(t,n),r(t,[{key:"processJob_",value:function(){this.jobs.shift()();this.timeout_=this.jobs.length?setTimeout(this.processJob_.bind(this),this.delay):null}},{key:"push",value:function(n){this.jobs.push(n);this.timeout_||(this.timeout_=setTimeout(this.processJob_.bind(this),this.delay))}}]),t}(f["default"]);i["default"]=c;t.exports=i["default"]},{"./stream":26}],24:[function(n,t,i){"use strict";function o(n){return n&&n.__esModule?n:{"default":n}}function s(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var e,f;Object.defineProperty(i,"__esModule",{value:!0});e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var h=n("./aes"),c=o(h),l=n("./async-stream"),a=o(l),v=n("pkcs7"),r=function(n){return n<<24|(n&65280)<<8|(n&16711680)>>8|n>>>24},u=function(n,t,i){var e=new Int32Array(n.buffer,n.byteOffset,n.byteLength>>2),b=new c["default"](Array.prototype.slice.call(t)),w=new Uint8Array(n.byteLength),f=new Int32Array(w.buffer),o=undefined,s=undefined,h=undefined,l=undefined,a=undefined,v=undefined,y=undefined,p=undefined,u=undefined;for(o=i[0],s=i[1],h=i[2],l=i[3],u=0;u<e.length;u+=4)a=r(e[u]),v=r(e[u+1]),y=r(e[u+2]),p=r(e[u+3]),b.decrypt(a,v,y,p,f,u),f[u]=r(f[u]^o),f[u+1]=r(f[u+1]^s),f[u+2]=r(f[u+2]^h),f[u+3]=r(f[u+3]^l),o=a,s=v,h=y,l=p;return w};i.decrypt=u;f=function(){function n(t,i,u,f){s(this,n);var h=n.STEP,o=new Int32Array(t.buffer),c=new Uint8Array(t.byteLength),e=0;for(this.asyncStream_=new a["default"],this.asyncStream_.push(this.decryptChunk_(o.subarray(e,e+h),i,u,c)),e=h;e<o.length;e+=h)u=new Uint32Array([r(o[e-4]),r(o[e-3]),r(o[e-2]),r(o[e-1])]),this.asyncStream_.push(this.decryptChunk_(o.subarray(e,e+h),i,u,c));this.asyncStream_.push(function(){f(null,v.unpad(c))})}return e(n,[{key:"decryptChunk_",value:function(n,t,i,r){return function(){var f=u(n,t,i);r.set(f,n.byteOffset)}}}],[{key:"STEP",get:function(){return 32e3}}]),n}();i.Decrypter=f;i["default"]={Decrypter:f,decrypt:u}},{"./aes":22,"./async-stream":23,pkcs7:28}],25:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var r=n("./decrypter"),f=n("./async-stream"),e=u(f);i["default"]={decrypt:r.decrypt,Decrypter:r.Decrypter,AsyncStream:e["default"]};t.exports=i["default"]},{"./async-stream":23,"./decrypter":24}],26:[function(n,t,i){"use strict";function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var r,u;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();u=function(){function n(){f(this,n);this.listeners={}}return r(n,[{key:"on",value:function(n,t){this.listeners[n]||(this.listeners[n]=[]);this.listeners[n].push(t)}},{key:"off",value:function(n,t){var i=undefined;return this.listeners[n]?(i=this.listeners[n].indexOf(t),this.listeners[n].splice(i,1),i>-1):!1}},{key:"trigger",value:function(n){var i=undefined,t=undefined,r=undefined,u=undefined;if(i=this.listeners[n],i)if(arguments.length===2)for(r=i.length,t=0;t<r;++t)i[t].call(this,arguments[1]);else for(u=Array.prototype.slice.call(arguments,1),r=i.length,t=0;t<r;++t)i[t].apply(this,u)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(n){this.on("data",function(t){n.push(t)})}}]),n}();i["default"]=u;t.exports=i["default"]},{}],27:[function(n,t){"use strict";var i;t.exports=function(n){var r=i[n.byteLength%16||0],t=new Uint8Array(n.byteLength+r.length);return t.set(n),t.set(r,n.byteLength),t};i=[[16,16,16,16,16,16,16,16,16,16,16,16,16,16,16,16],[15,15,15,15,15,15,15,15,15,15,15,15,15,15,15],[14,14,14,14,14,14,14,14,14,14,14,14,14,14],[13,13,13,13,13,13,13,13,13,13,13,13,13],[12,12,12,12,12,12,12,12,12,12,12,12],[11,11,11,11,11,11,11,11,11,11,11],[10,10,10,10,10,10,10,10,10,10],[9,9,9,9,9,9,9,9,9],[8,8,8,8,8,8,8,8],[7,7,7,7,7,7,7],[6,6,6,6,6,6],[5,5,5,5,5],[4,4,4,4],[3,3,3],[2,2],[1]]},{}],28:[function(n,t,i){"use strict";i.pad=n("./pad.js");i.unpad=n("./unpad.js")},{"./pad.js":27,"./unpad.js":29}],29:[function(n,t){"use strict";t.exports=function(n){return n.subarray(0,n.byteLength-n[n.byteLength-1])}},{}],30:[function(){},{}],31:[function(n,t){(function(i){var u=typeof i!="undefined"?i:typeof window!="undefined"?window:{},f=n("min-document"),r;typeof document!="undefined"?r=document:(r=u["__GLOBAL_DOCUMENT_CACHE@4"],r||(r=u["__GLOBAL_DOCUMENT_CACHE@4"]=f));t.exports=r}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"min-document":30}],32:[function(n,t){(function(n){var i;i=typeof window!="undefined"?window:typeof n!="undefined"?n:typeof self!="undefined"?self:{};t.exports=i}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{}],33:[function(n,t){"use strict";function i(n){return n&&n.__esModule?n:{"default":n}}var r=n("./line-stream"),u=i(r),f=n("./parse-stream"),e=i(f),o=n("./parser"),s=i(o);t.exports={LineStream:u["default"],ParseStream:e["default"],Parser:s["default"]}},{"./line-stream":34,"./parse-stream":35,"./parser":36}],34:[function(n,t,i){"use strict";function o(n){return n&&n.__esModule?n:{"default":n}}function s(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function h(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n}function c(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var r;Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),f=n("./stream"),e=o(f);r=function(n){function t(){s(this,t);var n=h(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return n.buffer="",n}return c(t,n),u(t,[{key:"push",value:function(n){var t=void 0;for(this.buffer+=n,t=this.buffer.indexOf("\n");t>-1;t=this.buffer.indexOf("\n"))this.trigger("data",this.buffer.substring(0,t)),this.buffer=this.buffer.substring(t+1)}}]),t}(e["default"]);i["default"]=r},{"./stream":37}],35:[function(n,t,i){"use strict";function s(n){return n&&n.__esModule?n:{"default":n}}function h(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function c(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n}function l(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}Object.defineProperty(i,"__esModule",{value:!0});var u=function(){function n(n,t){var r=[],u=!0,f=!1,e=undefined,i,o;try{for(i=n[Symbol.iterator]();!(u=(o=i.next()).done);u=!0)if(r.push(o.value),t&&r.length===t)break}catch(s){f=!0;e=s}finally{try{!u&&i["return"]&&i["return"]()}finally{if(f)throw e;}}return r}return function(t,i){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return n(t,i);throw new TypeError("Invalid attempt to destructure non-iterable instance");}}(),f=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),e=n("./stream"),o=s(e);var a=function(){return new RegExp('(?:^|,)((?:[^=]*)=(?:"[^"]*"|[^,]*))')},r=function(n){for(var i=n.split(a()),u={},r=i.length,t=void 0;r--;)i[r]!==""&&(t=/([^=]*)=(.*)/.exec(i[r]).slice(1),t[0]=t[0].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^\s+|\s+$/g,""),t[1]=t[1].replace(/^['"](.*)['"]$/g,"$1"),u[t[0]]=t[1]);return u},v=function(n){function t(){return h(this,t),c(this,(t.__proto__||Object.getPrototypeOf(t)).call(this))}return l(t,n),f(t,[{key:"push",value:function(n){var i=void 0,t=void 0,f,e,o;if(n=n.replace(/^[\u0000\s]+|[\u0000\s]+$/g,""),n.length!==0){if(n[0]!=="#"){this.trigger("data",{type:"uri",uri:n});return}if(n.indexOf("#EXT")!==0){this.trigger("data",{type:"comment",text:n.slice(1)});return}if(n=n.replace("\r",""),i=/^#EXTM3U/.exec(n),i){this.trigger("data",{type:"tag",tagType:"m3u"});return}if(i=/^#EXTINF:?([0-9\.]*)?,?(.*)?$/.exec(n),i){t={type:"tag",tagType:"inf"};i[1]&&(t.duration=parseFloat(i[1]));i[2]&&(t.title=i[2]);this.trigger("data",t);return}if(i=/^#EXT-X-TARGETDURATION:?([0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"targetduration"};i[1]&&(t.duration=parseInt(i[1],10));this.trigger("data",t);return}if(i=/^#ZEN-TOTAL-DURATION:?([0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"totalduration"};i[1]&&(t.duration=parseInt(i[1],10));this.trigger("data",t);return}if(i=/^#EXT-X-VERSION:?([0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"version"};i[1]&&(t.version=parseInt(i[1],10));this.trigger("data",t);return}if(i=/^#EXT-X-MEDIA-SEQUENCE:?(\-?[0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"media-sequence"};i[1]&&(t.number=parseInt(i[1],10));this.trigger("data",t);return}if(i=/^#EXT-X-DISCONTINUITY-SEQUENCE:?(\-?[0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"discontinuity-sequence"};i[1]&&(t.number=parseInt(i[1],10));this.trigger("data",t);return}if(i=/^#EXT-X-PLAYLIST-TYPE:?(.*)?$/.exec(n),i){t={type:"tag",tagType:"playlist-type"};i[1]&&(t.playlistType=i[1]);this.trigger("data",t);return}if(i=/^#EXT-X-BYTERANGE:?([0-9.]*)?@?([0-9.]*)?/.exec(n),i){t={type:"tag",tagType:"byterange"};i[1]&&(t.length=parseInt(i[1],10));i[2]&&(t.offset=parseInt(i[2],10));this.trigger("data",t);return}if(i=/^#EXT-X-ALLOW-CACHE:?(YES|NO)?/.exec(n),i){t={type:"tag",tagType:"allow-cache"};i[1]&&(t.allowed=!/NO/.test(i[1]));this.trigger("data",t);return}if(i=/^#EXT-X-MAP:?(.*)$/.exec(n),i){if(t={type:"tag",tagType:"map"},i[1]&&(f=r(i[1]),f.URI&&(t.uri=f.URI),f.BYTERANGE)){var l=f.BYTERANGE.split("@"),s=u(l,2),h=s[0],c=s[1];t.byterange={};h&&(t.byterange.length=parseInt(h,10));c&&(t.byterange.offset=parseInt(c,10))}this.trigger("data",t);return}if(i=/^#EXT-X-STREAM-INF:?(.*)$/.exec(n),i){t={type:"tag",tagType:"stream-inf"};i[1]&&(t.attributes=r(i[1]),t.attributes.RESOLUTION&&(e=t.attributes.RESOLUTION.split("x"),o={},e[0]&&(o.width=parseInt(e[0],10)),e[1]&&(o.height=parseInt(e[1],10)),t.attributes.RESOLUTION=o),t.attributes.BANDWIDTH&&(t.attributes.BANDWIDTH=parseInt(t.attributes.BANDWIDTH,10)),t.attributes["PROGRAM-ID"]&&(t.attributes["PROGRAM-ID"]=parseInt(t.attributes["PROGRAM-ID"],10)));this.trigger("data",t);return}if(i=/^#EXT-X-MEDIA:?(.*)$/.exec(n),i){t={type:"tag",tagType:"media"};i[1]&&(t.attributes=r(i[1]));this.trigger("data",t);return}if(i=/^#EXT-X-ENDLIST/.exec(n),i){this.trigger("data",{type:"tag",tagType:"endlist"});return}if(i=/^#EXT-X-DISCONTINUITY/.exec(n),i){this.trigger("data",{type:"tag",tagType:"discontinuity"});return}if(i=/^#EXT-X-PROGRAM-DATE-TIME:?(.*)$/.exec(n),i){t={type:"tag",tagType:"program-date-time"};i[1]&&(t.dateTimeString=i[1],t.dateTimeObject=new Date(i[1]));this.trigger("data",t);return}if(i=/^#EXT-X-KEY:?(.*)$/.exec(n),i){t={type:"tag",tagType:"key"};i[1]&&(t.attributes=r(i[1]),t.attributes.IV&&(t.attributes.IV.substring(0,2).toLowerCase()==="0x"&&(t.attributes.IV=t.attributes.IV.substring(2)),t.attributes.IV=t.attributes.IV.match(/.{8}/g),t.attributes.IV[0]=parseInt(t.attributes.IV[0],16),t.attributes.IV[1]=parseInt(t.attributes.IV[1],16),t.attributes.IV[2]=parseInt(t.attributes.IV[2],16),t.attributes.IV[3]=parseInt(t.attributes.IV[3],16),t.attributes.IV=new Uint32Array(t.attributes.IV)));this.trigger("data",t);return}if(i=/^#EXT-X-CUE-OUT-CONT:?(.*)?$/.exec(n),i){t={type:"tag",tagType:"cue-out-cont"};t.data=i[1]?i[1]:"";this.trigger("data",t);return}if(i=/^#EXT-X-CUE-OUT:?(.*)?$/.exec(n),i){t={type:"tag",tagType:"cue-out"};t.data=i[1]?i[1]:"";this.trigger("data",t);return}if(i=/^#EXT-X-CUE-IN:?(.*)?$/.exec(n),i){t={type:"tag",tagType:"cue-in"};t.data=i[1]?i[1]:"";this.trigger("data",t);return}this.trigger("data",{type:"tag",data:n.slice(4)})}}}]),t}(o["default"]);i["default"]=v},{"./stream":37}],36:[function(n,t,i){"use strict";function r(n){return n&&n.__esModule?n:{"default":n}}function v(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function y(n,t){if(!n)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t&&(typeof t=="object"||typeof t=="function")?t:n}function p(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var u;Object.defineProperty(i,"__esModule",{value:!0});var f=Object.assign||function(n){for(var i,r,t=1;t<arguments.length;t++){i=arguments[t];for(r in i)Object.prototype.hasOwnProperty.call(i,r)&&(n[r]=i[r])}return n},e=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),o=n("./stream"),s=r(o),h=n("./line-stream"),c=r(h),l=n("./parse-stream"),a=r(l);u=function(n){function t(){var i;v(this,t);i=y(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));i.lineStream=new c["default"];i.parseStream=new a["default"];i.lineStream.pipe(i.parseStream);var s=i,e=[],n={},r=void 0,u=void 0,l=function(){},h={AUDIO:{},VIDEO:{},"CLOSED-CAPTIONS":{},SUBTITLES:{}},o=0;i.manifest={allowCache:!0,discontinuityStarts:[],segments:[]};i.parseStream.on("data",function(t){var c=void 0,i=void 0;({tag:function(){({"allow-cache":function(){this.manifest.allowCache=t.allowed;"allowed"in t||(this.trigger("info",{message:"defaulting allowCache to YES"}),this.manifest.allowCache=!0)},byterange:function(){var i={};"length"in t&&(n.byterange=i,i.length=t.length,"offset"in t||(this.trigger("info",{message:"defaulting offset to zero"}),t.offset=0));"offset"in t&&(n.byterange=i,i.offset=t.offset)},endlist:function(){this.manifest.endList=!0},inf:function(){"mediaSequence"in this.manifest||(this.manifest.mediaSequence=0,this.trigger("info",{message:"defaulting media sequence to zero"}));"discontinuitySequence"in this.manifest||(this.manifest.discontinuitySequence=0,this.trigger("info",{message:"defaulting discontinuity sequence to zero"}));t.duration>0&&(n.duration=t.duration);t.duration===0&&(n.duration=.01,this.trigger("info",{message:"updating zero segment duration to a small value"}));this.manifest.segments=e},key:function(){if(!t.attributes){this.trigger("warn",{message:"ignoring key declaration without attribute list"});return}if(t.attributes.METHOD==="NONE"){u=null;return}if(!t.attributes.URI){this.trigger("warn",{message:"ignoring key declaration without URI"});return}t.attributes.METHOD||this.trigger("warn",{message:"defaulting key method to AES-128"});u={method:t.attributes.METHOD||"AES-128",uri:t.attributes.URI};typeof t.attributes.IV!="undefined"&&(u.iv=t.attributes.IV)},"media-sequence":function(){if(!isFinite(t.number)){this.trigger("warn",{message:"ignoring invalid media sequence: "+t.number});return}this.manifest.mediaSequence=t.number},"discontinuity-sequence":function(){if(!isFinite(t.number)){this.trigger("warn",{message:"ignoring invalid discontinuity sequence: "+t.number});return}this.manifest.discontinuitySequence=t.number;o=t.number},"playlist-type":function(){if(!/VOD|EVENT/.test(t.playlistType)){this.trigger("warn",{message:"ignoring unknown playlist type: "+t.playlist});return}this.manifest.playlistType=t.playlistType},map:function(){r={};t.uri&&(r.uri=t.uri);t.byterange&&(r.byterange=t.byterange)},"stream-inf":function(){if(this.manifest.playlists=e,this.manifest.mediaGroups=this.manifest.mediaGroups||h,!t.attributes){this.trigger("warn",{message:"ignoring empty stream-inf attributes"});return}n.attributes||(n.attributes={});f(n.attributes,t.attributes)},media:function(){if(this.manifest.mediaGroups=this.manifest.mediaGroups||h,!(t.attributes&&t.attributes.TYPE&&t.attributes["GROUP-ID"]&&t.attributes.NAME)){this.trigger("warn",{message:"ignoring incomplete or missing media group"});return}var n=this.manifest.mediaGroups[t.attributes.TYPE];n[t.attributes["GROUP-ID"]]=n[t.attributes["GROUP-ID"]]||{};c=n[t.attributes["GROUP-ID"]];i={"default":/yes/i.test(t.attributes.DEFAULT)};i.autoselect=i["default"]?!0:/yes/i.test(t.attributes.AUTOSELECT);t.attributes.LANGUAGE&&(i.language=t.attributes.LANGUAGE);t.attributes.URI&&(i.uri=t.attributes.URI);t.attributes["INSTREAM-ID"]&&(i.instreamId=t.attributes["INSTREAM-ID"]);t.attributes.CHARACTERISTICS&&(i.characteristics=t.attributes.CHARACTERISTICS);t.attributes.FORCED&&(i.forced=/yes/i.test(t.attributes.FORCED));c[t.attributes.NAME]=i},discontinuity:function(){o+=1;n.discontinuity=!0;this.manifest.discontinuityStarts.push(e.length)},"program-date-time":function(){this.manifest.dateTimeString=t.dateTimeString;this.manifest.dateTimeObject=t.dateTimeObject},targetduration:function(){if(!isFinite(t.duration)||t.duration<0){this.trigger("warn",{message:"ignoring invalid target duration: "+t.duration});return}this.manifest.targetDuration=t.duration},totalduration:function(){if(!isFinite(t.duration)||t.duration<0){this.trigger("warn",{message:"ignoring invalid total duration: "+t.duration});return}this.manifest.totalDuration=t.duration},"cue-out":function(){n.cueOut=t.data},"cue-out-cont":function(){n.cueOutCont=t.data},"cue-in":function(){n.cueIn=t.data}}[t.tagType]||l).call(s)},uri:function(){n.uri=t.uri;e.push(n);!this.manifest.targetDuration||"duration"in n||(this.trigger("warn",{message:"defaulting segment duration to the target duration"}),n.duration=this.manifest.targetDuration);u&&(n.key=u);n.timeline=o;r&&(n.map=r);n={}},comment:function(){}})[t.type].call(s)});return i}return p(t,n),e(t,[{key:"push",value:function(n){this.lineStream.push(n)}},{key:"end",value:function(){this.lineStream.push("\n")}}]),t}(s["default"]);i["default"]=u},{"./line-stream":34,"./parse-stream":35,"./stream":37}],37:[function(n,t,i){"use strict";function f(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var r,u;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();u=function(){function n(){f(this,n);this.listeners={}}return r(n,[{key:"on",value:function(n,t){this.listeners[n]||(this.listeners[n]=[]);this.listeners[n].push(t)}},{key:"off",value:function(n,t){if(!this.listeners[n])return!1;var i=this.listeners[n].indexOf(t);return this.listeners[n].splice(i,1),i>-1}},{key:"trigger",value:function(n){var i=this.listeners[n],t=void 0,r=void 0,u=void 0;if(i)if(arguments.length===2)for(r=i.length,t=0;t<r;++t)i[t].call(this,arguments[1]);else for(u=Array.prototype.slice.call(arguments,1),r=i.length,t=0;t<r;++t)i[t].apply(this,u)}},{key:"dispose",value:function(){this.listeners={}}},{key:"pipe",value:function(n){this.on("data",function(t){n.push(t)})}}]),n}();i["default"]=u},{}],38:[function(n,t){"use strict";var r=n("../utils/stream.js"),i;i=function(){var n=new Uint8Array,t=0;i.prototype.init.call(this);this.setTimestamp=function(n){t=n};this.parseId3TagSize=function(n,t){var i=n[t+6]<<21|n[t+7]<<14|n[t+8]<<7|n[t+9],r=n[t+5],u=(r&16)>>4;return u?i+20:i+10};this.parseAdtsSize=function(n,t){var i=(n[t+5]&224)>>5,r=n[t+4]<<3,u=n[t+3]&6144;return u|r|i};this.push=function(i){var u=0,r=0,e,o,s,f;for(n.length?(f=n.length,n=new Uint8Array(i.byteLength+f),n.set(n.subarray(0,f)),n.set(i,f)):n=i;n.length-r>=3;){if(n[r]==="I".charCodeAt(0)&&n[r+1]==="D".charCodeAt(0)&&n[r+2]==="3".charCodeAt(0)){if(n.length-r<10)break;if(u=this.parseId3TagSize(n,r),u>n.length)break;o={type:"timed-metadata",data:n.subarray(r,r+u)};this.trigger("data",o);r+=u;continue}else if(n[r]&!0&&(n[r+1]&240)==240){if(n.length-r<7)break;if(u=this.parseAdtsSize(n,r),u>n.length)break;s={type:"audio",data:n.subarray(r,r+u),pts:t,dts:t};this.trigger("data",s);r+=u;continue}r++}e=n.length-r;n=e>0?n.subarray(r):new Uint8Array}};i.prototype=new r;t.exports=i},{"../utils/stream.js":62}],39:[function(n,t){"use strict";var r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],i=function(n){return n[0]<<21|n[1]<<14|n[2]<<7|n[3]},u=function(n,t,i){for(var u="",r=t;r<i;r++)u+="%"+("00"+n[r].toString(16)).slice(-2);return u},f=function(n,t,i){return unescape(u(n,t,i))},e=function(n,t){var i=n[t+6]<<21|n[t+7]<<14|n[t+8]<<7|n[t+9],r=n[t+5],u=(r&16)>>4;return u?i+20:i+10},o=function(n,t){var i=(n[t+5]&224)>>5,r=n[t+4]<<3,u=n[t+3]&6144;return u|r|i},s=function(n,t){return n[t]==="I".charCodeAt(0)&&n[t+1]==="D".charCodeAt(0)&&n[t+2]==="3".charCodeAt(0)?"timed-metadata":n[t]&!0&&(n[t+1]&240)==240?"audio":null},h=function(n){for(var t=0;t+5<n.length;){if(n[t]!==255||(n[t+1]&246)!=240){t++;continue}return r[(n[t+2]&60)>>>2]}return null},c=function(n){var t,o,e,h,u,c,r,s;t=10;n[5]&64&&(t+=4,t+=i(n.subarray(10,14)));do{if(o=i(n.subarray(t+4,t+8)),o<1)return null;if(h=String.fromCharCode(n[t],n[t+1],n[t+2],n[t+3]),h==="PRIV")for(e=n.subarray(t+10,t+o+10),u=0;u<e.byteLength;u++)if(e[u]===0){if(c=f(e,0,u),c==="com.apple.streaming.transportStreamTimestamp")return r=e.subarray(u+1),s=(r[3]&1)<<30|r[4]<<22|r[5]<<14|r[6]<<6|r[7]>>>2,s*=4,s+(r[7]&3);break}t+=10;t+=o}while(t<n.byteLength);return null};t.exports={parseId3TagSize:e,parseAdtsSize:o,parseType:s,parseSampleRate:h,parseAacTimestamp:c}},{}],40:[function(n,t){"use strict";var u=n("../utils/stream.js"),i,r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];i=function(){var n;i.prototype.init.call(this);this.push=function(t){var i=0,e=0,h,c,u,f,o,s;if(t.type==="audio")for(n?(f=n,n=new Uint8Array(f.byteLength+t.data.byteLength),n.set(f),n.set(t.data,f.byteLength)):n=t.data;i+5<n.length;){if(n[i]!==255||(n[i+1]&246)!=240){i++;continue}if(c=(~n[i+1]&1)*2,h=(n[i+3]&3)<<11|n[i+4]<<3|(n[i+5]&224)>>5,o=((n[i+6]&3)+1)*1024,s=o*9e4/r[(n[i+2]&60)>>>2],u=i+h,n.byteLength<u)return;if(this.trigger("data",{pts:t.pts+e*s,dts:t.dts+e*s,sampleCount:o,audioobjecttype:(n[i+2]>>>6&3)+1,channelcount:(n[i+2]&1)<<2|(n[i+3]&192)>>>6,samplerate:r[(n[i+2]&60)>>>2],samplingfrequencyindex:(n[i+2]&60)>>>2,samplesize:16,data:n.subarray(i+7+c,u)}),n.byteLength===u){n=undefined;return}e++;n=n.subarray(u)}};this.flush=function(){this.trigger("done")}};i.prototype=new u;t.exports=i},{"../utils/stream.js":62}],41:[function(n,t){"use strict";var u=n("../utils/stream.js"),e=n("../utils/exp-golomb.js"),r,i,f;i=function(){var r=0,t,n;i.prototype.init.call(this);this.push=function(i){var u;for(n?(u=new Uint8Array(n.byteLength+i.data.byteLength),u.set(n),u.set(i.data,n.byteLength),n=u):n=i.data;r<n.byteLength-3;r++)if(n[r+2]===1){t=r+5;break}while(t<n.byteLength)switch(n[t]){case 0:if(n[t-1]!==0){t+=2;break}else if(n[t-2]!==0){t++;break}r+3!==t-2&&this.trigger("data",n.subarray(r+3,t-2));do t++;while(n[t]!==1&&t<n.length);r=t-2;t+=3;break;case 1:if(n[t-1]!==0||n[t-2]!==0){t+=3;break}this.trigger("data",n.subarray(r+3,t-2));r=t-2;t+=3;break;default:t+=3}n=n.subarray(r);t-=r;r=0};this.flush=function(){n&&n.byteLength>3&&this.trigger("data",n.subarray(r+3));n=null;r=0;this.trigger("done")}};i.prototype=new u;f={100:!0,110:!0,122:!0,244:!0,44:!0,83:!0,86:!0,118:!0,128:!0,138:!0,139:!0,134:!0};r=function(){var n=new i,t,s,h,c,u,l,o;r.prototype.init.call(this);t=this;this.push=function(t){t.type==="video"&&(s=t.trackId,h=t.pts,c=t.dts,n.push(t))};n.on("data",function(n){var i={trackId:s,pts:h,dts:c,data:n};switch(n[0]&31){case 5:i.nalUnitType="slice_layer_without_partitioning_rbsp_idr";break;case 6:i.nalUnitType="sei_rbsp";i.escapedRBSP=u(n.subarray(1));break;case 7:i.nalUnitType="seq_parameter_set_rbsp";i.escapedRBSP=u(n.subarray(1));i.config=l(i.escapedRBSP);break;case 8:i.nalUnitType="pic_parameter_set_rbsp";break;case 9:i.nalUnitType="access_unit_delimiter_rbsp"}t.trigger("data",i)});n.on("done",function(){t.trigger("done")});this.flush=function(){n.flush()};o=function(n,t){for(var r=8,i=8,f,u=0;u<n;u++)i!==0&&(f=t.readExpGolomb(),i=(r+f+256)%256),r=i===0?r:i};u=function(n){for(var e=n.byteLength,i=[],t=1,u,f,r;t<e-2;)n[t]===0&&n[t+1]===0&&n[t+2]===3?(i.push(t+2),t+=2):t++;if(i.length===0)return n;for(u=e-i.length,f=new Uint8Array(u),r=0,t=0;t<u;r++,t++)r===i[0]&&(r++,i.shift()),f[t]=n[r];return f};l=function(n){var l=0,a=0,v=0,y=0,p=1,t,u,w,b,s,h,k,d,g,c,nt,i,tt,r;if(t=new e(n),u=t.readUnsignedByte(),b=t.readUnsignedByte(),w=t.readUnsignedByte(),t.skipUnsignedExpGolomb(),f[u]&&(s=t.readUnsignedExpGolomb(),s===3&&t.skipBits(1),t.skipUnsignedExpGolomb(),t.skipUnsignedExpGolomb(),t.skipBits(1),t.readBoolean()))for(nt=s!==3?8:12,r=0;r<nt;r++)t.readBoolean()&&(r<6?o(16,t):o(64,t));if(t.skipUnsignedExpGolomb(),h=t.readUnsignedExpGolomb(),h===0)t.readUnsignedExpGolomb();else if(h===1)for(t.skipBits(1),t.skipExpGolomb(),t.skipExpGolomb(),k=t.readUnsignedExpGolomb(),r=0;r<k;r++)t.skipExpGolomb();if(t.skipUnsignedExpGolomb(),t.skipBits(1),d=t.readUnsignedExpGolomb(),g=t.readUnsignedExpGolomb(),c=t.readBits(1),c===0&&t.skipBits(1),t.skipBits(1),t.readBoolean()&&(l=t.readUnsignedExpGolomb(),a=t.readUnsignedExpGolomb(),v=t.readUnsignedExpGolomb(),y=t.readUnsignedExpGolomb()),t.readBoolean()&&t.readBoolean()){tt=t.readUnsignedByte();switch(tt){case 1:i=[1,1];break;case 2:i=[12,11];break;case 3:i=[10,11];break;case 4:i=[16,11];break;case 5:i=[40,33];break;case 6:i=[24,11];break;case 7:i=[20,11];break;case 8:i=[32,11];break;case 9:i=[80,33];break;case 10:i=[18,11];break;case 11:i=[15,11];break;case 12:i=[64,33];break;case 13:i=[160,99];break;case 14:i=[4,3];break;case 15:i=[3,2];break;case 16:i=[2,1];break;case 255:i=[t.readUnsignedByte()<<8|t.readUnsignedByte(),t.readUnsignedByte()<<8|t.readUnsignedByte()]}i&&(p=i[0]/i[1])}return{profileIdc:u,levelIdc:w,profileCompatibility:b,width:Math.ceil(((d+1)*16-l*2-a*2)*p),height:(2-c)*(g+1)*16-v*2-y*2}}};r.prototype=new u;t.exports={H264Stream:r,NalByteStream:i}},{"../utils/exp-golomb.js":61,"../utils/stream.js":62}],42:[function(n,t){var r=[33,16,5,32,164,27],u=[33,65,108,84,1,2,4,8,168,2,4,8,17,191,252],i=function(n){for(var t=[];n--;)t.push(0);return t},f=function(n){return Object.keys(n).reduce(function(t,i){return t[i]=new Uint8Array(n[i].reduce(function(n,t){return n.concat(t)},[])),t},{})},e={96e3:[r,[227,64],i(154),[56]],88200:[r,[231],i(170),[56]],64e3:[r,[248,192],i(240),[56]],48e3:[r,[255,192],i(268),[55,148,128],i(54),[112]],44100:[r,[255,192],i(268),[55,163,128],i(84),[112]],32e3:[r,[255,192],i(268),[55,234],i(226),[112]],24e3:[r,[255,192],i(268),[55,255,128],i(268),[111,112],i(126),[224]],16e3:[r,[255,192],i(268),[55,255,128],i(268),[111,255],i(269),[223,108],i(195),[1,192]],12e3:[u,i(268),[3,127,248],i(268),[6,255,240],i(268),[13,255,224],i(268),[27,253,128],i(259),[56]],11025:[u,i(268),[3,127,248],i(268),[6,255,240],i(268),[13,255,224],i(268),[27,255,192],i(268),[55,175,128],i(108),[112]],8e3:[u,i(268),[3,121,16],i(47),[7]]};t.exports=f(e)},{}],43:[function(n,t){"use strict";var r=n("../utils/stream.js"),i=function(n){this.numberOfTracks=0;this.metadataStream=n.metadataStream;this.videoTags=[];this.audioTags=[];this.videoTrack=null;this.audioTrack=null;this.pendingCaptions=[];this.pendingMetadata=[];this.pendingTracks=0;this.processedTracks=0;i.prototype.init.call(this);this.push=function(n){if(n.text)return this.pendingCaptions.push(n);if(n.frames)return this.pendingMetadata.push(n);n.track.type==="video"&&(this.videoTrack=n.track,this.videoTags=n.tags,this.pendingTracks++);n.track.type==="audio"&&(this.audioTrack=n.track,this.audioTags=n.tags,this.pendingTracks++)}};i.prototype=new r;i.prototype.flush=function(n){var u,t,i,f,r={tags:{},captions:[],captionStreams:{},metadata:[]};if(this.pendingTracks<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.pendingTracks===0&&(this.processedTracks++,this.processedTracks<this.numberOfTracks))return}if(this.processedTracks+=this.pendingTracks,this.pendingTracks=0,!(this.processedTracks<this.numberOfTracks)){for(this.videoTrack?f=this.videoTrack.timelineStartInfo.pts:this.audioTrack&&(f=this.audioTrack.timelineStartInfo.pts),r.tags.videoTags=this.videoTags,r.tags.audioTags=this.audioTags,i=0;i<this.pendingCaptions.length;i++)t=this.pendingCaptions[i],t.startTime=t.startPts-f,t.startTime/=9e4,t.endTime=t.endPts-f,t.endTime/=9e4,r.captionStreams[t.stream]=!0,r.captions.push(t);for(i=0;i<this.pendingMetadata.length;i++)u=this.pendingMetadata[i],u.cueTime=u.pts-f,u.cueTime/=9e4,r.metadata.push(u);r.metadata.dispatchType=this.metadataStream.dispatchType;this.videoTrack=null;this.audioTrack=null;this.videoTags=[];this.audioTags=[];this.pendingCaptions.length=0;this.pendingMetadata.length=0;this.pendingTracks=0;this.processedTracks=0;this.trigger("data",r);this.trigger("done")}};t.exports=i},{"../utils/stream.js":62}],44:[function(n,t){"use strict";var i=n("./flv-tag.js"),r=function(n,t,r){var f=new Uint8Array(9),e=new DataView(f.buffer),o,u,s;return(n=n||0,t=t===undefined?!0:t,r=r===undefined?!0:r,e.setUint8(0,70),e.setUint8(1,76),e.setUint8(2,86),e.setUint8(3,1),e.setUint8(4,(t?4:0)|(r?1:0)),e.setUint32(5,f.byteLength),n<=0)?(u=new Uint8Array(f.byteLength+4),u.set(f),u.set([0,0,0,0],f.byteLength),u):(o=new i(i.METADATA_TAG),o.pts=o.dts=0,o.writeMetaDataDouble("duration",n),s=o.finalize().length,u=new Uint8Array(f.byteLength+s),u.set(f),u.set(e.byteLength,s),u)};t.exports=r},{"./flv-tag.js":45}],45:[function(n,t){"use strict";var i;i=function(n,t){var u=0,h=16384,f=function(n,t){var i,r=n.position+t;r<n.bytes.byteLength||(i=new Uint8Array(r*2),i.set(n.bytes.subarray(0,n.position),0),n.bytes=i,n.view=new DataView(n.bytes.buffer))},e=i.widthBytes||new Uint8Array(5),o=i.heightBytes||new Uint8Array(6),s=i.videocodecidBytes||new Uint8Array(12),r;if(!i.widthBytes){for(r=0;r<5;r++)e[r]="width".charCodeAt(r);for(r=0;r<6;r++)o[r]="height".charCodeAt(r);for(r=0;r<12;r++)s[r]="videocodecid".charCodeAt(r);i.widthBytes=e;i.heightBytes=o;i.videocodecidBytes=s}this.keyFrame=!1;switch(n){case i.VIDEO_TAG:this.length=16;h*=6;break;case i.AUDIO_TAG:this.length=13;this.keyFrame=!0;break;case i.METADATA_TAG:this.length=29;this.keyFrame=!0;break;default:throw new Error("Unknown FLV tag type");}this.bytes=new Uint8Array(h);this.view=new DataView(this.bytes.buffer);this.bytes[0]=n;this.position=this.length;this.keyFrame=t;this.pts=0;this.dts=0;this.writeBytes=function(n,t,i){var r=t||0,u;i=i||n.byteLength;u=r+i;f(this,i);this.bytes.set(n.subarray(r,u),this.position);this.position+=i;this.length=Math.max(this.length,this.position)};this.writeByte=function(n){f(this,1);this.bytes[this.position]=n;this.position++;this.length=Math.max(this.length,this.position)};this.writeShort=function(n){f(this,2);this.view.setUint16(this.position,n);this.position+=2;this.length=Math.max(this.length,this.position)};this.negIndex=function(n){return this.bytes[this.length-n]};this.nalUnitSize=function(){return u===0?0:this.length-(u+4)};this.startNalUnit=function(){if(u>0)throw new Error("Attempted to create new NAL wihout closing the old one");u=this.length;this.length+=4;this.position=this.length};this.endNalUnit=function(n){var t,i;this.length===u+4?this.length-=4:u>0&&(t=u+4,i=this.length-t,this.position=u,this.view.setUint32(this.position,i),this.position=this.length,n&&n.push(this.bytes.subarray(t,t+i)));u=0};this.writeMetaDataDouble=function(n,t){var i;if(f(this,2+n.length+9),this.view.setUint16(this.position,n.length),this.position+=2,n==="width")this.bytes.set(e,this.position),this.position+=5;else if(n==="height")this.bytes.set(o,this.position),this.position+=6;else if(n==="videocodecid")this.bytes.set(s,this.position),this.position+=12;else for(i=0;i<n.length;i++)this.bytes[this.position]=n.charCodeAt(i),this.position++;this.position++;this.view.setFloat64(this.position,t);this.position+=8;this.length=Math.max(this.length,this.position);++u};this.writeMetaDataBoolean=function(n,t){var i;for(f(this,2),this.view.setUint16(this.position,n.length),this.position+=2,i=0;i<n.length;i++)f(this,1),this.bytes[this.position]=n.charCodeAt(i),this.position++;f(this,2);this.view.setUint8(this.position,1);this.position++;this.view.setUint8(this.position,t?1:0);this.position++;this.length=Math.max(this.length,this.position);++u};this.finalize=function(){var n,r;switch(this.bytes[0]){case i.VIDEO_TAG:this.bytes[11]=(this.keyFrame||t?16:32)|7;this.bytes[12]=t?0:1;n=this.pts-this.dts;this.bytes[13]=(n&16711680)>>>16;this.bytes[14]=(n&65280)>>>8;this.bytes[15]=(n&255)>>>0;break;case i.AUDIO_TAG:this.bytes[11]=175;this.bytes[12]=t?0:1;break;case i.METADATA_TAG:this.position=11;this.view.setUint8(this.position,2);this.position++;this.view.setUint16(this.position,10);this.position+=2;this.bytes.set([111,110,77,101,116,97,68,97,116,97],this.position);this.position+=10;this.bytes[this.position]=8;this.position++;this.view.setUint32(this.position,u);this.position=this.length;this.bytes.set([0,0,9],this.position);this.position+=3;this.length=this.position}return r=this.length-11,this.bytes[1]=(r&16711680)>>>16,this.bytes[2]=(r&65280)>>>8,this.bytes[3]=(r&255)>>>0,this.bytes[4]=(this.dts&16711680)>>>16,this.bytes[5]=(this.dts&65280)>>>8,this.bytes[6]=(this.dts&255)>>>0,this.bytes[7]=(this.dts&4278190080)>>>24,this.bytes[8]=0,this.bytes[9]=0,this.bytes[10]=0,f(this,4),this.view.setUint32(this.length,this.length),this.length+=4,this.position+=4,this.bytes=this.bytes.subarray(0,this.length),this.frameTime=i.frameTime(this.bytes),this}};i.AUDIO_TAG=8;i.VIDEO_TAG=9;i.METADATA_TAG=18;i.isAudioFrame=function(n){return i.AUDIO_TAG===n[0]};i.isVideoFrame=function(n){return i.VIDEO_TAG===n[0]};i.isMetaData=function(n){return i.METADATA_TAG===n[0]};i.isKeyFrame=function(n){return i.isVideoFrame(n)?n[11]===23:i.isAudioFrame(n)?!0:i.isMetaData(n)?!0:!1};i.frameTime=function(n){var t=n[4]<<16;return t|=n[5]<<8,t|=n[6]<<0,t|n[7]<<24};t.exports=i},{}],46:[function(n,t){t.exports={tag:n("./flv-tag"),Transmuxer:n("./transmuxer"),getFlvHeader:n("./flv-header")}},{"./flv-header":44,"./flv-tag":45,"./transmuxer":48}],47:[function(n,t){"use strict";var i=function(){var n=this;this.list=[];this.push=function(n){this.list.push({bytes:n.bytes,dts:n.dts,pts:n.pts,keyFrame:n.keyFrame,metaDataTag:n.metaDataTag})};Object.defineProperty(this,"length",{get:function(){return n.list.length}})};t.exports=i},{}],48:[function(n,t){"use strict";var o=n("../utils/stream.js"),i=n("./flv-tag.js"),r=n("../m2ts/m2ts.js"),a=n("../codecs/adts.js"),v=n("../codecs/h264").H264Stream,y=n("./coalesce-stream.js"),h=n("./tag-list.js"),u,f,e,s,c,l;s=function(n,t){typeof t.pts=="number"&&(n.timelineStartInfo.pts=n.timelineStartInfo.pts===undefined?t.pts:Math.min(n.timelineStartInfo.pts,t.pts));typeof t.dts=="number"&&(n.timelineStartInfo.dts=n.timelineStartInfo.dts===undefined?t.dts:Math.min(n.timelineStartInfo.dts,t.dts))};c=function(n,t){var r=new i(i.METADATA_TAG);return r.dts=t,r.pts=t,r.writeMetaDataDouble("videocodecid",7),r.writeMetaDataDouble("width",n.width),r.writeMetaDataDouble("height",n.height),r};l=function(n,t){var u,r=new i(i.VIDEO_TAG,!0);for(r.dts=t,r.pts=t,r.writeByte(1),r.writeByte(n.profileIdc),r.writeByte(n.profileCompatibility),r.writeByte(n.levelIdc),r.writeByte(255),r.writeByte(225),r.writeShort(n.sps[0].length),r.writeBytes(n.sps[0]),r.writeByte(n.pps.length),u=0;u<n.pps.length;++u)r.writeShort(n.pps[u].length),r.writeBytes(n.pps[u]);return r};e=function(n){var r=[],t=[],u;e.prototype.init.call(this);this.push=function(t){s(n,t);n&&(n.audioobjecttype=t.audioobjecttype,n.channelcount=t.channelcount,n.samplerate=t.samplerate,n.samplingfrequencyindex=t.samplingfrequencyindex,n.samplesize=t.samplesize,n.extraData=n.audioobjecttype<<11|n.samplingfrequencyindex<<7|n.channelcount<<3);t.pts=Math.round(t.pts/90);t.dts=Math.round(t.dts/90);r.push(t)};this.flush=function(){var f,e,o,s=new h;if(r.length===0){this.trigger("done","AudioSegmentStream");return}for(o=-Infinity;r.length;)f=r.shift(),t.length&&f.pts>=t[0]&&(o=t.shift(),this.writeMetaDataTags(s,o)),(n.extraData!==u||f.pts-o>=1e3)&&(this.writeMetaDataTags(s,f.pts),u=n.extraData,o=f.pts),e=new i(i.AUDIO_TAG),e.pts=f.pts,e.dts=f.dts,e.writeBytes(f.data),s.push(e.finalize());t.length=0;u=null;this.trigger("data",{track:n,tags:s.list});this.trigger("done","AudioSegmentStream")};this.writeMetaDataTags=function(t,r){var u;u=new i(i.METADATA_TAG);u.pts=r;u.dts=r;u.writeMetaDataDouble("audiocodecid",10);u.writeMetaDataBoolean("stereo",n.channelcount===2);u.writeMetaDataDouble("audiosamplerate",n.samplerate);u.writeMetaDataDouble("audiosamplesize",16);t.push(u.finalize());u=new i(i.AUDIO_TAG,!0);u.pts=r;u.dts=r;u.view.setUint16(u.position,n.extraData);u.position+=2;u.length=Math.max(u.length,u.position);t.push(u.finalize())};this.onVideoKeyFrame=function(n){t.push(n)}};e.prototype=new o;f=function(n){var u=[],r,t;f.prototype.init.call(this);this.finishFrame=function(i,u){if(u){if(r&&n&&n.newMetadata&&(u.keyFrame||i.length===0)){var f=c(r,u.dts).finalize(),e=l(n,u.dts).finalize();f.metaDataTag=e.metaDataTag=!0;i.push(f);i.push(e);n.newMetadata=!1;this.trigger("keyframe",u.dts)}u.endNalUnit();i.push(u.finalize());t=null}};this.push=function(t){s(n,t);t.pts=Math.round(t.pts/90);t.dts=Math.round(t.dts/90);u.push(t)};this.flush=function(){for(var f,e=new h;u.length;){if(u[0].nalUnitType==="access_unit_delimiter_rbsp")break;u.shift()}if(u.length===0){this.trigger("done","VideoSegmentStream");return}while(u.length)f=u.shift(),f.nalUnitType==="seq_parameter_set_rbsp"?(n.newMetadata=!0,r=f.config,n.width=r.width,n.height=r.height,n.sps=[f.data],n.profileIdc=r.profileIdc,n.levelIdc=r.levelIdc,n.profileCompatibility=r.profileCompatibility,t.endNalUnit()):f.nalUnitType==="pic_parameter_set_rbsp"?(n.newMetadata=!0,n.pps=[f.data],t.endNalUnit()):f.nalUnitType==="access_unit_delimiter_rbsp"?(t&&this.finishFrame(e,t),t=new i(i.VIDEO_TAG),t.pts=f.pts,t.dts=f.dts):(f.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(t.keyFrame=!0),t.endNalUnit()),t.startNalUnit(),t.writeBytes(f.data);t&&this.finishFrame(e,t);this.trigger("data",{track:n,tags:e.list});this.trigger("done","VideoSegmentStream")}};f.prototype=new o;u=function(n){var w=this,s,b,i,k,d,g,l,h,o,c,p,t;u.prototype.init.call(this);n=n||{};this.metadataStream=new r.MetadataStream;n.metadataStream=this.metadataStream;s=new r.TransportPacketStream;b=new r.TransportParseStream;i=new r.ElementaryStream;k=new r.TimestampRolloverStream("video");d=new r.TimestampRolloverStream("audio");g=new r.TimestampRolloverStream("timed-metadata");l=new a;h=new v;t=new y(n);s.pipe(b).pipe(i);i.pipe(k).pipe(h);i.pipe(d).pipe(l);i.pipe(g).pipe(this.metadataStream).pipe(t);p=new r.CaptionStream;h.pipe(p).pipe(t);i.on("data",function(n){var i,r,u;if(n.type==="metadata"){for(i=n.tracks.length;i--;)n.tracks[i].type==="video"?r=n.tracks[i]:n.tracks[i].type==="audio"&&(u=n.tracks[i]);if(r&&!o&&(t.numberOfTracks++,o=new f(r),h.pipe(o).pipe(t)),u&&!c&&(t.numberOfTracks++,c=new e(u),l.pipe(c).pipe(t),o))o.on("keyframe",c.onVideoKeyFrame)}});this.push=function(n){s.push(n)};this.flush=function(){s.flush()};this.resetCaptions=function(){p.reset()};t.on("data",function(n){w.trigger("data",n)});t.on("done",function(){w.trigger("done")})};u.prototype=new o;t.exports=u},{"../codecs/adts.js":40,"../codecs/h264":41,"../m2ts/m2ts.js":50,"../utils/stream.js":62,"./coalesce-stream.js":43,"./flv-tag.js":45,"./tag-list.js":47}],49:[function(n,t){"use strict";var o=4,h=128,s=n("../utils/stream"),c=function(n){for(var t=0,r={payloadType:-1,payloadSize:0},u=0,i=0;t<n.byteLength;){if(n[t]===h)break;while(n[t]===255)u+=255,t++;for(u+=n[t++];n[t]===255;)i+=255,t++;if(i+=n[t++],!r.payload&&u===o){r.payloadType=u;r.payloadSize=i;r.payload=n.subarray(t,t+i);break}t+=i;u=0;i=0}return r},l=function(n){return n.payload[0]!==181?null:(n.payload[1]<<8|n.payload[2])!=49?null:String.fromCharCode(n.payload[3],n.payload[4],n.payload[5],n.payload[6])!=="GA94"?null:n.payload[7]!==3?null:n.payload.subarray(8,n.payload.length-1)},a=function(n,t){var u=[],r,e,i,f;if(!(t[0]&64))return u;for(e=t[0]&31,r=0;r<e;r++)i=r*3,f={type:t[i+2]&3,pts:n},t[i+2]&4&&(f.ccData=t[i+3]<<8|t[i+4],u.push(f));return u},u=function(){u.prototype.init.call(this);this.captionPackets_=[];this.ccStreams_=[new i(0,0),new i(0,1),new i(1,0),new i(1,1)];this.reset();this.ccStreams_.forEach(function(n){n.on("data",this.trigger.bind(this,"data"));n.on("done",this.trigger.bind(this,"done"))},this)};u.prototype=new s;u.prototype.push=function(n){var t,i;if(n.nalUnitType==="sei_rbsp"&&(t=c(n.escapedRBSP),t.payloadType===o)&&(i=l(t),i)){if(n.dts<this.latestDts_){this.ignoreNextEqualDts_=!0;return}if(n.dts===this.latestDts_&&this.ignoreNextEqualDts_){this.ignoreNextEqualDts_=!1;return}this.captionPackets_=this.captionPackets_.concat(a(n.pts,i));this.latestDts_=n.dts}};u.prototype.flush=function(){if(!this.captionPackets_.length){this.ccStreams_.forEach(function(n){n.flush()},this);return}this.captionPackets_.forEach(function(n,t){n.presortIndex=t});this.captionPackets_.sort(function(n,t){return n.pts===t.pts?n.presortIndex-t.presortIndex:n.pts-t.pts});this.captionPackets_.forEach(function(n){n.type<2&&this.dispatchCea608Packet(n)},this);this.captionPackets_.length=0;this.ccStreams_.forEach(function(n){n.flush()},this);return};u.prototype.reset=function(){this.latestDts_=null;this.ignoreNextEqualDts_=!1;this.activeCea608Channel_=[null,null];this.ccStreams_.forEach(function(n){n.reset()})};u.prototype.dispatchCea608Packet=function(n){(this.setsChannel1Active(n)?this.activeCea608Channel_[n.type]=0:this.setsChannel2Active(n)&&(this.activeCea608Channel_[n.type]=1),this.activeCea608Channel_[n.type]!==null)&&this.ccStreams_[(n.type<<1)+this.activeCea608Channel_[n.type]].push(n)};u.prototype.setsChannel1Active=function(n){return(n.ccData&30720)==4096};u.prototype.setsChannel2Active=function(n){return(n.ccData&30720)==6144};var v={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,304:174,305:176,306:189,307:191,308:8482,309:162,310:163,311:9834,312:224,313:160,314:232,315:226,316:234,317:238,318:244,319:251,544:193,545:201,546:211,547:218,548:220,549:252,550:8216,551:161,552:42,553:39,554:8212,555:169,556:8480,557:8226,558:8220,559:8221,560:192,561:194,562:199,563:200,564:202,565:203,566:235,567:206,568:207,569:239,570:212,571:217,572:249,573:219,574:171,575:187,800:195,801:227,802:205,803:204,804:236,805:210,806:242,807:213,808:245,809:123,810:125,811:92,812:94,813:95,814:124,815:126,816:196,817:228,818:214,819:246,820:223,821:165,822:164,823:9474,824:197,825:229,826:216,827:248,828:9484,829:9488,830:9492,831:9496},f=function(n){return n===null?"":(n=v[n]||n,String.fromCharCode(n))},r=14,y=[4352,4384,4608,4640,5376,5408,5632,5664,5888,5920,4096,4864,4896,5120,5152],e=function(){for(var n=[],t=r+1;t--;)n.push("");return n},i=function(n,t){i.prototype.init.call(this);this.field_=n||0;this.dataChannel_=t||0;this.name_="CC"+((this.field_<<1|this.dataChannel_)+1);this.setConstants();this.reset();this.push=function(n){var t,h,u,i,o,s;if(t=n.ccData&32639,t===this.lastControlCode_){this.lastControlCode_=null;return}((t&61440)==4096?this.lastControlCode_=t:t!==this.PADDING_&&(this.lastControlCode_=null),u=t>>>8,i=t&255,t!==this.PADDING_)&&(t===this.RESUME_CAPTION_LOADING_?this.mode_="popOn":t===this.END_OF_CAPTION_?(this.clearFormatting(n.pts),this.flushDisplayed(n.pts),h=this.displayed_,this.displayed_=this.nonDisplayed_,this.nonDisplayed_=h,this.startPts_=n.pts):t===this.ROLL_UP_2_ROWS_?(this.topRow_=r-1,this.mode_="rollUp"):t===this.ROLL_UP_3_ROWS_?(this.topRow_=r-2,this.mode_="rollUp"):t===this.ROLL_UP_4_ROWS_?(this.topRow_=r-3,this.mode_="rollUp"):t===this.CARRIAGE_RETURN_?(this.clearFormatting(n.pts),this.flushDisplayed(n.pts),this.shiftRowsUp_(),this.startPts_=n.pts):t===this.BACKSPACE_?this.mode_==="popOn"?this.nonDisplayed_[r]=this.nonDisplayed_[r].slice(0,-1):this.displayed_[r]=this.displayed_[r].slice(0,-1):t===this.ERASE_DISPLAYED_MEMORY_?(this.flushDisplayed(n.pts),this.displayed_=e()):t===this.ERASE_NON_DISPLAYED_MEMORY_?this.nonDisplayed_=e():t===this.RESUME_DIRECT_CAPTIONING_?this.mode_="paintOn":this.isSpecialCharacter(u,i)?(u=(u&3)<<8,o=f(u|i),this[this.mode_](n.pts,o),this.column_++):this.isExtCharacter(u,i)?(this.mode_==="popOn"?this.nonDisplayed_[this.row_]=this.nonDisplayed_[this.row_].slice(0,-1):this.displayed_[r]=this.displayed_[r].slice(0,-1),u=(u&3)<<8,o=f(u|i),this[this.mode_](n.pts,o),this.column_++):this.isMidRowCode(u,i)?(this.clearFormatting(n.pts),this[this.mode_](n.pts," "),this.column_++,(i&14)==14&&this.addFormatting(n.pts,["i"]),(i&1)==1&&this.addFormatting(n.pts,["u"])):this.isOffsetControlCode(u,i)?this.column_+=i&3:this.isPAC(u,i)?(s=y.indexOf(t&7968),s!==this.row_&&(this.clearFormatting(n.pts),this.row_=s),i&1&&this.formatting_.indexOf("u")===-1&&this.addFormatting(n.pts,["u"]),(t&16)==16&&(this.column_=((t&14)>>1)*4),this.isColorPAC(i)&&(i&14)==14&&this.addFormatting(n.pts,["i"])):this.isNormalChar(u)&&(i===0&&(i=null),o=f(u),o+=f(i),this[this.mode_](n.pts,o),this.column_+=o.length))}};i.prototype=new s;i.prototype.flushDisplayed=function(n){var t=this.displayed_.map(function(n){return n.trim()}).join("\n").replace(/^\n+|\n+$/g,"");t.length&&this.trigger("data",{startPts:this.startPts_,endPts:n,text:t,stream:this.name_})};i.prototype.reset=function(){this.mode_="popOn";this.topRow_=0;this.startPts_=0;this.displayed_=e();this.nonDisplayed_=e();this.lastControlCode_=null;this.column_=0;this.row_=r;this.formatting_=[]};i.prototype.setConstants=function(){this.dataChannel_===0?(this.BASE_=16,this.EXT_=17,this.CONTROL_=(20|this.field_)<<8,this.OFFSET_=23):this.dataChannel_===1&&(this.BASE_=24,this.EXT_=25,this.CONTROL_=(28|this.field_)<<8,this.OFFSET_=31);this.PADDING_=0;this.RESUME_CAPTION_LOADING_=this.CONTROL_|32;this.END_OF_CAPTION_=this.CONTROL_|47;this.ROLL_UP_2_ROWS_=this.CONTROL_|37;this.ROLL_UP_3_ROWS_=this.CONTROL_|38;this.ROLL_UP_4_ROWS_=this.CONTROL_|39;this.CARRIAGE_RETURN_=this.CONTROL_|45;this.RESUME_DIRECT_CAPTIONING_=this.CONTROL_|41;this.BACKSPACE_=this.CONTROL_|33;this.ERASE_DISPLAYED_MEMORY_=this.CONTROL_|44;this.ERASE_NON_DISPLAYED_MEMORY_=this.CONTROL_|46};i.prototype.isSpecialCharacter=function(n,t){return n===this.EXT_&&t>=48&&t<=63};i.prototype.isExtCharacter=function(n,t){return(n===this.EXT_+1||n===this.EXT_+2)&&t>=32&&t<=63};i.prototype.isMidRowCode=function(n,t){return n===this.EXT_&&t>=32&&t<=47};i.prototype.isOffsetControlCode=function(n,t){return n===this.OFFSET_&&t>=33&&t<=35};i.prototype.isPAC=function(n,t){return n>=this.BASE_&&n<this.BASE_+8&&t>=64&&t<=127};i.prototype.isColorPAC=function(n){return n>=64&&n<=79||n>=96&&n<=127};i.prototype.isNormalChar=function(n){return n>=32&&n<=127};i.prototype.addFormatting=function(n,t){this.formatting_=this.formatting_.concat(t);var i=t.reduce(function(n,t){return n+"<"+t+">"},"");this[this.mode_](n,i)};i.prototype.clearFormatting=function(n){if(this.formatting_.length){var t=this.formatting_.reverse().reduce(function(n,t){return n+"<\/"+t+">"},"");this.formatting_=[];this[this.mode_](n,t)}};i.prototype.popOn=function(n,t){var i=this.nonDisplayed_[this.row_];i+=t;this.nonDisplayed_[this.row_]=i};i.prototype.rollUp=function(n,t){var i=this.displayed_[r];i+=t;this.displayed_[r]=i};i.prototype.shiftRowsUp_=function(){for(var n=0;n<this.topRow_;n++)this.displayed_[n]="";for(n=this.topRow_;n<r;n++)this.displayed_[n]=this.displayed_[n+1];this.displayed_[r]=""};i.prototype.paintOn=function(){};t.exports={CaptionStream:u,Cea608Stream:i}},{"../utils/stream":62}],50:[function(n,t){"use strict";var s=n("../utils/stream.js"),l=n("./caption-stream"),i=n("./stream-types"),a=n("./timestamp-rollover-stream").TimestampRolloverStream,v=n("./stream-types.js"),f,u,e,r=188,h=71,c,o;f=function(){var t=new Uint8Array(r),n=0;f.prototype.init.call(this);this.push=function(i){var f=0,e=r,u;for(n?(u=new Uint8Array(i.byteLength+n),u.set(t.subarray(0,n)),u.set(i,n),n=0):u=i;e<u.byteLength;){if(u[f]===h&&u[e]===h){this.trigger("data",u.subarray(f,e));f+=r;e+=r;continue}f++;e++}f<u.byteLength&&(t.set(u.subarray(f),0),n=u.byteLength-f)};this.flush=function(){n===r&&t[0]===h&&(this.trigger("data",t),n=0);this.trigger("done")}};f.prototype=new s;u=function(){var t,r,f,n;u.prototype.init.call(this);n=this;this.packetsWaitingForPmt=[];this.programMapTable=undefined;t=function(n,t){var i=0;t.payloadUnitStartIndicator&&(i+=n[i]+1);t.type==="pat"?r(n.subarray(i),t):f(n.subarray(i),t)};r=function(t,i){i.section_number=t[7];i.last_section_number=t[8];n.pmtPid=(t[10]&31)<<8|t[11];i.pmtPid=n.pmtPid};f=function(t,r){var o,s,h,u,f,e;if(t[5]&1){for(n.programMapTable={video:null,audio:null,"timed-metadata":{}},o=(t[1]&15)<<8|t[2],s=3+o-4,h=(t[10]&15)<<8|t[11],u=12+h;u<s;)f=t[u],e=(t[u+1]&31)<<8|t[u+2],f===i.H264_STREAM_TYPE&&n.programMapTable.video===null?n.programMapTable.video=e:f===i.ADTS_STREAM_TYPE&&n.programMapTable.audio===null?n.programMapTable.audio=e:f===i.METADATA_STREAM_TYPE&&(n.programMapTable["timed-metadata"][e]=f),u+=((t[u+3]&15)<<8|t[u+4])+5;r.programMapTable=n.programMapTable}};this.push=function(n){var i={},r=4;if(i.payloadUnitStartIndicator=!!(n[1]&64),i.pid=n[1]&31,i.pid<<=8,i.pid|=n[2],(n[3]&48)>>>4>1&&(r+=n[r]+1),i.pid===0)i.type="pat",t(n.subarray(r),i),this.trigger("data",i);else if(i.pid===this.pmtPid)for(i.type="pmt",t(n.subarray(r),i),this.trigger("data",i);this.packetsWaitingForPmt.length;)this.processPes_.apply(this,this.packetsWaitingForPmt.shift());else this.programMapTable===undefined?this.packetsWaitingForPmt.push([n,r,i]):this.processPes_(n,r,i)};this.processPes_=function(n,t,r){r.streamType=r.pid===this.programMapTable.video?i.H264_STREAM_TYPE:r.pid===this.programMapTable.audio?i.ADTS_STREAM_TYPE:this.programMapTable["timed-metadata"][r.pid];r.type="pes";r.data=n.subarray(t);this.trigger("data",r)}};u.prototype=new s;u.STREAM_TYPES={h264:27,adts:15};e=function(){var t=this,r={data:[],size:0},u={data:[],size:0},f={data:[],size:0},o=function(n,t){var i;t.packetLength=6+(n[4]<<8|n[5]);t.dataAlignmentIndicator=(n[6]&4)!=0;i=n[7];i&192&&(t.pts=(n[9]&14)<<27|(n[10]&255)<<20|(n[11]&254)<<12|(n[12]&255)<<5|(n[13]&254)>>>3,t.pts*=4,t.pts+=(n[13]&6)>>>1,t.dts=t.pts,i&64&&(t.dts=(n[14]&14)<<27|(n[15]&255)<<20|(n[16]&254)<<12|(n[17]&255)<<5|(n[18]&254)>>>3,t.dts*=4,t.dts+=(n[18]&6)>>>1));t.data=n.subarray(9+n[8])},n=function(n,i,r){var h=new Uint8Array(n.size),u={type:i},f=0,c=0,e=!1,s;if(n.data.length&&!(n.size<9)){for(u.trackId=n.data[0].pid,f=0;f<n.data.length;f++)s=n.data[f],h.set(s.data,c),c+=s.data.byteLength;o(h,u);e=i==="video"||u.packetLength<=n.size;(r||e)&&(n.size=0,n.data.length=0);e&&t.trigger("data",u)}};e.prototype.init.call(this);this.push=function(e){({pat:function(){},pes:function(){var t,o;switch(e.streamType){case i.H264_STREAM_TYPE:case v.H264_STREAM_TYPE:t=r;o="video";break;case i.ADTS_STREAM_TYPE:t=u;o="audio";break;case i.METADATA_STREAM_TYPE:t=f;o="timed-metadata";break;default:return}e.payloadUnitStartIndicator&&n(t,o,!0);t.data.push(e);t.size+=e.data.byteLength},pmt:function(){var i={type:"metadata",tracks:[]},n=e.programMapTable;n.video!==null&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.video,codec:"avc",type:"video"});n.audio!==null&&i.tracks.push({timelineStartInfo:{baseMediaDecodeTime:0},id:+n.audio,codec:"adts",type:"audio"});t.trigger("data",i)}})[e.type]()};this.flush=function(){n(r,"video");n(u,"audio");n(f,"timed-metadata");this.trigger("done")}};e.prototype=new s;c={PAT_PID:0,MP2T_PACKET_LENGTH:r,TransportPacketStream:f,TransportParseStream:u,ElementaryStream:e,TimestampRolloverStream:a,CaptionStream:l.CaptionStream,Cea608Stream:l.Cea608Stream,MetadataStream:n("./metadata-stream")};for(o in i)i.hasOwnProperty(o)&&(c[o]=i[o]);t.exports=c},{"../utils/stream.js":62,"./caption-stream":49,"./metadata-stream":51,"./stream-types":53,"./stream-types.js":53,"./timestamp-rollover-stream":54}],51:[function(n,t){"use strict";var o=n("../utils/stream"),s=n("./stream-types"),f=function(n,t,i){for(var u="",r=t;r<i;r++)u+="%"+("00"+n[r].toString(16)).slice(-2);return u},i=function(n,t,i){return decodeURIComponent(f(n,t,i))},h=function(n,t,i){return unescape(f(n,t,i))},r=function(n){return n[0]<<21|n[1]<<14|n[2]<<7|n[3]},e={TXXX:function(n){var t;if(n.data[0]===3){for(t=1;t<n.data.length;t++)if(n.data[t]===0){n.description=i(n.data,1,t);n.value=i(n.data,t+1,n.data.length).replace(/\0*$/,"");break}n.data=n.value}},WXXX:function(n){var t;if(n.data[0]===3)for(t=1;t<n.data.length;t++)if(n.data[t]===0){n.description=i(n.data,1,t);n.url=i(n.data,t+1,n.data.length);break}},PRIV:function(n){for(var t=0;t<n.data.length;t++)if(n.data[t]===0){n.owner=h(n.data,0,t);break}n.privateData=n.data.subarray(t+1);n.data=n.privateData}},u;u=function(n){var f={debug:!!(n&&n.debug),descriptor:n&&n.descriptor},i=0,t=[],o=0,h;if(u.prototype.init.call(this),this.dispatchType=s.METADATA_STREAM_TYPE.toString(16),f.descriptor)for(h=0;h<f.descriptor.length;h++)this.dispatchType+=("00"+f.descriptor[h].toString(16)).slice(-2);this.push=function(n){var u,s,a,h,l,y,c,v;if(n.type==="timed-metadata"){if(n.dataAlignmentIndicator&&(o=0,t.length=0),t.length===0&&(n.data.length<10||n.data[0]!=="I".charCodeAt(0)||n.data[1]!=="D".charCodeAt(0)||n.data[2]!=="3".charCodeAt(0))){f.debug&&console.log("Skipping unrecognized metadata packet");return}if(t.push(n),o+=n.data.byteLength,t.length===1&&(i=r(n.data.subarray(6,10))+10),!(o<i)){for(u={data:new Uint8Array(i),frames:[],pts:t[0].pts,dts:t[0].dts},l=0;l<i;)u.data.set(t[0].data.subarray(0,i-l),l),l+=t[0].data.byteLength,o-=t[0].data.byteLength,t.shift();s=10;u.data[5]&64&&(s+=4,s+=r(u.data.subarray(10,14)),i-=r(u.data.subarray(16,20)));do{if(a=r(u.data.subarray(s+4,s+8)),a<1)return console.log("Malformed ID3 frame encountered. Skipping metadata parsing.");y=String.fromCharCode(u.data[s],u.data[s+1],u.data[s+2],u.data[s+3]);h={id:y,data:u.data.subarray(s+10,s+a+10)};h.key=h.id;e[h.id]&&(e[h.id](h),h.owner==="com.apple.streaming.transportStreamTimestamp"&&(c=h.data,v=(c[3]&1)<<30|c[4]<<22|c[5]<<14|c[6]<<6|c[7]>>>2,v*=4,v+=c[7]&3,h.timeStamp=v,u.pts===undefined&&u.dts===undefined&&(u.pts=h.timeStamp,u.dts=h.timeStamp),this.trigger("timestamp",h)));u.frames.push(h);s+=10;s+=a}while(s<i);this.trigger("data",u)}}}};u.prototype=new o;t.exports=u},{"../utils/stream":62,"./stream-types":53}],52:[function(n,t){"use strict";var u=n("./stream-types.js"),e=function(n){var t=n[1]&31;return t<<=8,t|n[2]},i=function(n){return!!(n[1]&64)},r=function(n){var t=0;return(n[3]&48)>>>4>1&&(t+=n[4]+1),t},o=function(n,t){var i=e(n);return i===0?"pat":i===t?"pmt":t?"pes":null},s=function(n){var u=i(n),t=4+r(n);return u&&(t+=n[t]+1),(n[t+10]&31)<<8|n[t+11]},h=function(n){var e={},c=i(n),t=4+r(n),o,s,h,f,u;if(c&&(t+=n[t]+1),n[t+5]&1){for(o=(n[t+1]&15)<<8|n[t+2],s=3+o-4,h=(n[t+10]&15)<<8|n[t+11],f=12+h;f<s;)u=t+f,e[(n[u+1]&31)<<8|n[u+2]]=n[u],f+=((n[u+3]&15)<<8|n[u+4])+5;return e}},c=function(n,t){var i=e(n),r=t[i];switch(r){case u.H264_STREAM_TYPE:return"video";case u.ADTS_STREAM_TYPE:return"audio";case u.METADATA_STREAM_TYPE:return"timed-metadata";default:return null}},l=function(n){var e=i(n),t,u,f;return e?(t=4+r(n),t>=n.byteLength)?null:(u=null,f=n[t+7],f&192&&(u={},u.pts=(n[t+9]&14)<<27|(n[t+10]&255)<<20|(n[t+11]&254)<<12|(n[t+12]&255)<<5|(n[t+13]&254)>>>3,u.pts*=4,u.pts+=(n[t+13]&6)>>>1,u.dts=u.pts,f&64&&(u.dts=(n[t+14]&14)<<27|(n[t+15]&255)<<20|(n[t+16]&254)<<12|(n[t+17]&255)<<5|(n[t+18]&254)>>>3,u.dts*=4,u.dts+=(n[t+18]&6)>>>1)),u):null},f=function(n){switch(n){case 5:return"slice_layer_without_partitioning_rbsp_idr";case 6:return"sei_rbsp";case 7:return"seq_parameter_set_rbsp";case 8:return"pic_parameter_set_rbsp";case 9:return"access_unit_delimiter_rbsp";default:return null}},a=function(n){for(var s=4+r(n),i=n.subarray(s),t=0,u=0,o=!1,e;u<i.byteLength-3;u++)if(i[u+2]===1){t=u+5;break}while(t<i.byteLength)switch(i[t]){case 0:if(i[t-1]!==0){t+=2;break}else if(i[t-2]!==0){t++;break}u+3!==t-2&&(e=f(i[u+3]&31),e==="slice_layer_without_partitioning_rbsp_idr"&&(o=!0));do t++;while(i[t]!==1&&t<i.length);u=t-2;t+=3;break;case 1:if(i[t-1]!==0||i[t-2]!==0){t+=3;break}e=f(i[u+3]&31);e==="slice_layer_without_partitioning_rbsp_idr"&&(o=!0);u=t-2;t+=3;break;default:t+=3}return i=i.subarray(u),t-=u,u=0,i&&i.byteLength>3&&(e=f(i[u+3]&31),e==="slice_layer_without_partitioning_rbsp_idr"&&(o=!0)),o};t.exports={parseType:o,parsePat:s,parsePmt:h,parsePayloadUnitStartIndicator:i,parsePesType:c,parsePesTime:l,videoPacketContainsKeyFrame:a}},{"./stream-types.js":53}],53:[function(n,t){"use strict";t.exports={H264_STREAM_TYPE:27,ADTS_STREAM_TYPE:15,METADATA_STREAM_TYPE:21}},{}],54:[function(n,t){"use strict";var u=n("../utils/stream"),f=8589934592,e=4294967296,i=function(n,t){var i=1;for(n>t&&(i=-1);Math.abs(t-n)>e;)n+=i*f;return n},r=function(n){var u,t;r.prototype.init.call(this);this.type_=n;this.push=function(n){n.type===this.type_&&(t===undefined&&(t=n.dts),n.dts=i(n.dts,t),n.pts=i(n.pts,t),u=n.dts,this.trigger("data",n))};this.flush=function(){t=u;this.trigger("done")};this.discontinuity=function(){t=void 0;u=void 0}};r.prototype=new u;t.exports={TimestampRolloverStream:r,handleRollover:i}},{"../utils/stream":62}],55:[function(n,t){t.exports={generator:n("./mp4-generator"),Transmuxer:n("./transmuxer").Transmuxer,AudioSegmentStream:n("./transmuxer").AudioSegmentStream,VideoSegmentStream:n("./transmuxer").VideoSegmentStream}},{"./mp4-generator":56,"./transmuxer":58}],56:[function(n,t){"use strict";var h=Math.pow(2,32)-1,r,c,l,f,a,v,y,p,e,w,b,k,d,g,nt,tt,it,rt,ut,ft,et,o,i,s,ot,st,ht,ct,lt,at,vt,yt,u,pt,wt,bt;(function(){var n;if(i={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],mvex:[],mvhd:[],sdtp:[],smhd:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],styp:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[]},typeof Uint8Array!="undefined"){for(n in i)i.hasOwnProperty(n)&&(i[n]=[n.charCodeAt(0),n.charCodeAt(1),n.charCodeAt(2),n.charCodeAt(3)]);s=new Uint8Array(["i".charCodeAt(0),"s".charCodeAt(0),"o".charCodeAt(0),"m".charCodeAt(0)]);st=new Uint8Array(["a".charCodeAt(0),"v".charCodeAt(0),"c".charCodeAt(0),"1".charCodeAt(0)]);ot=new Uint8Array([0,0,0,1]);ht=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]);ct=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);lt={video:ht,audio:ct};yt=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]);vt=new Uint8Array([0,0,0,0,0,0,0,0]);u=new Uint8Array([0,0,0,0,0,0,0,0]);pt=u;wt=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]);bt=u;at=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0])}})();r=function(n){for(var r=[],u=0,i,f,t=1;t<arguments.length;t++)r.push(arguments[t]);for(t=r.length;t--;)u+=r[t].byteLength;for(i=new Uint8Array(u+8),f=new DataView(i.buffer,i.byteOffset,i.byteLength),f.setUint32(0,i.byteLength),i.set(n,4),t=0,u=8;t<r.length;t++)i.set(r[t],u),u+=r[t].byteLength;return i};c=function(){return r(i.dinf,r(i.dref,yt))};l=function(n){return r(i.esds,new Uint8Array([0,0,0,0,3,25,0,0,0,4,17,64,21,0,6,0,0,0,218,192,0,0,218,192,5,2,n.audioobjecttype<<3|n.samplingfrequencyindex>>>1,n.samplingfrequencyindex<<7|n.channelcount<<3,6,1,2]))};f=function(){return r(i.ftyp,s,ot,s,st)};tt=function(n){return r(i.hdlr,lt[n])};a=function(n){return r(i.mdat,n)};nt=function(n){var t=new Uint8Array([0,0,0,0,0,0,0,2,0,0,0,3,0,1,95,144,n.duration>>>24&255,n.duration>>>16&255,n.duration>>>8&255,n.duration&255,85,196,0,0]);return n.samplerate&&(t[12]=n.samplerate>>>24&255,t[13]=n.samplerate>>>16&255,t[14]=n.samplerate>>>8&255,t[15]=n.samplerate&255),r(i.mdhd,t)};g=function(n){return r(i.mdia,nt(n),tt(n.type),y(n))};v=function(n){return r(i.mfhd,new Uint8Array([0,0,0,0,(n&4278190080)>>24,(n&16711680)>>16,(n&65280)>>8,n&255]))};y=function(n){return r(i.minf,n.type==="video"?r(i.vmhd,at):r(i.smhd,vt),c(),rt(n))};p=function(n,t){for(var f=[],u=t.length;u--;)f[u]=ft(t[u]);return r.apply(null,[i.moof,v(n)].concat(f))};e=function(n){for(var t=n.length,u=[];t--;)u[t]=k(n[t]);return r.apply(null,[i.moov,b(4294967295)].concat(u).concat(w(n)))};w=function(n){for(var t=n.length,u=[];t--;)u[t]=et(n[t]);return r.apply(null,[i.mvex].concat(u))};b=function(n){var t=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,2,0,1,95,144,(n&4278190080)>>24,(n&16711680)>>16,(n&65280)>>8,n&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return r(i.mvhd,t)};it=function(n){for(var f=n.samples||[],e=new Uint8Array(4+f.length),u,t=0;t<f.length;t++)u=f[t].flags,e[t+4]=u.dependsOn<<4|u.isDependedOn<<2|u.hasRedundancy;return r(i.sdtp,e)};rt=function(n){return r(i.stbl,ut(n),r(i.stts,bt),r(i.stsc,pt),r(i.stsz,wt),r(i.stco,u))},function(){var n,t;ut=function(u){return r(i.stsd,new Uint8Array([0,0,0,0,0,0,0,1]),u.type==="video"?n(u):t(u))};n=function(n){for(var u=n.sps||[],f=n.pps||[],e=[],o=[],t=0;t<u.length;t++)e.push((u[t].byteLength&65280)>>>8),e.push(u[t].byteLength&255),e=e.concat(Array.prototype.slice.call(u[t]));for(t=0;t<f.length;t++)o.push((f[t].byteLength&65280)>>>8),o.push(f[t].byteLength&255),o=o.concat(Array.prototype.slice.call(f[t]));return r(i.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,(n.width&65280)>>8,n.width&255,(n.height&65280)>>8,n.height&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,19,118,105,100,101,111,106,115,45,99,111,110,116,114,105,98,45,104,108,115,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),r(i.avcC,new Uint8Array([1,n.profileIdc,n.profileCompatibility,n.levelIdc,255].concat([u.length]).concat(e).concat([f.length]).concat(o))),r(i.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])))};t=function(n){return r(i.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,(n.channelcount&65280)>>8,n.channelcount&255,(n.samplesize&65280)>>8,n.samplesize&255,0,0,0,0,(n.samplerate&65280)>>8,n.samplerate&255,0,0]),l(n))}}();d=function(n){var t=new Uint8Array([0,0,0,7,0,0,0,0,0,0,0,0,(n.id&4278190080)>>24,(n.id&16711680)>>16,(n.id&65280)>>8,n.id&255,0,0,0,0,(n.duration&4278190080)>>24,(n.duration&16711680)>>16,(n.duration&65280)>>8,n.duration&255,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,(n.width&65280)>>8,n.width&255,0,0,(n.height&65280)>>8,n.height&255,0,0]);return r(i.tkhd,t)};ft=function(n){var e,s,f,c,l,t,u;return(e=r(i.tfhd,new Uint8Array([0,0,0,58,(n.id&4278190080)>>24,(n.id&16711680)>>16,(n.id&65280)>>8,n.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0])),t=Math.floor(n.baseMediaDecodeTime/(h+1)),u=Math.floor(n.baseMediaDecodeTime%(h+1)),s=r(i.tfdt,new Uint8Array([1,0,0,0,t>>>24&255,t>>>16&255,t>>>8&255,t&255,u>>>24&255,u>>>16&255,u>>>8&255,u&255])),l=92,n.type==="audio")?(f=o(n,l),r(i.traf,e,s,f)):(c=it(n),f=o(n,c.length+l),r(i.traf,e,s,f,c))};k=function(n){return n.duration=n.duration||4294967295,r(i.trak,d(n),g(n))};et=function(n){var t=new Uint8Array([0,0,0,0,(n.id&4278190080)>>24,(n.id&16711680)>>16,(n.id&65280)>>8,n.id&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]);return n.type!=="video"&&(t[t.length-1]=0),r(i.trex,t)},function(){var t,u,n;n=function(n,t){var i=0,r=0,u=0,f=0;return n.length&&(n[0].duration!==undefined&&(i=1),n[0].size!==undefined&&(r=2),n[0].flags!==undefined&&(u=4),n[0].compositionTimeOffset!==undefined&&(f=8)),[0,0,i|r|u|f,1,(n.length&4278190080)>>>24,(n.length&16711680)>>>16,(n.length&65280)>>>8,n.length&255,(t&4278190080)>>>24,(t&16711680)>>>16,(t&65280)>>>8,t&255]};u=function(t,u){var o,e,f,s;for(e=t.samples||[],u+=20+16*e.length,o=n(e,u),s=0;s<e.length;s++)f=e[s],o=o.concat([(f.duration&4278190080)>>>24,(f.duration&16711680)>>>16,(f.duration&65280)>>>8,f.duration&255,(f.size&4278190080)>>>24,(f.size&16711680)>>>16,(f.size&65280)>>>8,f.size&255,f.flags.isLeading<<2|f.flags.dependsOn,f.flags.isDependedOn<<6|f.flags.hasRedundancy<<4|f.flags.paddingValue<<1|f.flags.isNonSyncSample,f.flags.degradationPriority&61440,f.flags.degradationPriority&15,(f.compositionTimeOffset&4278190080)>>>24,(f.compositionTimeOffset&16711680)>>>16,(f.compositionTimeOffset&65280)>>>8,f.compositionTimeOffset&255]);return r(i.trun,new Uint8Array(o))};t=function(t,u){var o,e,f,s;for(e=t.samples||[],u+=20+8*e.length,o=n(e,u),s=0;s<e.length;s++)f=e[s],o=o.concat([(f.duration&4278190080)>>>24,(f.duration&16711680)>>>16,(f.duration&65280)>>>8,f.duration&255,(f.size&4278190080)>>>24,(f.size&16711680)>>>16,(f.size&65280)>>>8,f.size&255]);return r(i.trun,new Uint8Array(o))};o=function(n,i){return n.type==="audio"?t(n,i):u(n,i)}}();t.exports={ftyp:f,mdat:a,moof:p,moov:e,initSegment:function(n){var i=f(),r=e(n),t;return t=new Uint8Array(i.byteLength+r.byteLength),t.set(i),t.set(r,i.byteLength),t}}},{}],57:[function(n,t){"use strict";var i,r,u,f;i=function(n,t){var e=[],u,f,h,o,s;if(!t.length)return null;for(u=0;u<n.byteLength;)f=n[u]<<24,f|=n[u+1]<<16,f|=n[u+2]<<8,f|=n[u+3],h=r(n.subarray(u+4,u+8)),o=f>1?u+f:n.byteLength,h===t[0]&&(t.length===1?e.push(n.subarray(u+8,o)):(s=i(n.subarray(u+8,o),t.slice(1)),s.length&&(e=e.concat(s)))),u=o;return e};r=function(n){var t="";return t+=String.fromCharCode(n[0]),t+=String.fromCharCode(n[1]),t+=String.fromCharCode(n[2]),t+String.fromCharCode(n[3])};u=function(n){var t=i(n,["moov","trak"]);return t.reduce(function(n,t){var u,e,r,o,f;return(u=i(t,["tkhd"])[0],!u)?null:(e=u[0],r=e===0?12:20,o=u[r]<<24|u[r+1]<<16|u[r+2]<<8|u[r+3],f=i(t,["mdia","mdhd"])[0],!f)?null:(e=f[0],r=e===0?12:20,n[o]=f[r]<<24|f[r+1]<<16|f[r+2]<<8|f[r+3],n)},{})};f=function(n,t){var u,f,r;return u=i(t,["moof","traf"]),f=[].concat.apply([],u.map(function(t){return i(t,["tfhd"]).map(function(r){var f,e,u;return f=r[4]<<24|r[5]<<16|r[6]<<8|r[7],e=n[f]||9e4,u=i(t,["tfdt"]).map(function(n){var i,t;return i=n[0],t=n[4]<<24|n[5]<<16|n[6]<<8|n[7],i===1&&(t*=Math.pow(2,32),t+=n[8]<<24|n[9]<<16|n[10]<<8|n[11]),t})[0],u=u||Infinity,u/e})})),r=Math.min.apply(null,f),isFinite(r)?r:0};t.exports={parseType:r,timescale:u,startTime:f}},{}],58:[function(n,t){"use strict";var s=n("../utils/stream.js"),e=n("./mp4-generator.js"),i=n("../m2ts/m2ts.js"),w=n("../codecs/adts.js"),nt=n("../codecs/h264").H264Stream,tt=n("../aac"),it=n("../data/silence"),b=n("../utils/clock"),l=["audioobjecttype","channelcount","samplerate","samplingfrequencyindex","samplesize"],a=["width","height","profileIdc","levelIdc","profileCompatibility"],v=9e4,o,r,h,u,k,d,c,f,y,p,g;k=function(){return{size:0,flags:{isLeading:0,dependsOn:1,isDependedOn:0,hasRedundancy:0,degradationPriority:0}}};d=function(n){return n[0]==="I".charCodeAt(0)&&n[1]==="D".charCodeAt(0)&&n[2]==="3".charCodeAt(0)?!0:!1};p=function(n,t){var i;if(n.length!==t.length)return!1;for(i=0;i<n.length;i++)if(n[i]!==t[i])return!1;return!0};g=function(n){for(var i,r=0,t=0;t<n.length;t++)i=n[t],r+=i.data.byteLength;return r};r=function(n){var t=[],s=0,i=0,u=0,o=Infinity;r.prototype.init.call(this);this.push=function(i){c(n,i);n&&l.forEach(function(t){n[t]=i[t]});t.push(i)};this.setEarliestDts=function(t){i=t-n.timelineStartInfo.baseMediaDecodeTime};this.setVideoBaseMediaDecodeTime=function(n){o=n};this.setAudioAppendStart=function(n){u=n};this.flush=function(){var i,r,o,u;if(t.length===0){this.trigger("done","AudioSegmentStream");return}i=this.trimAdtsFramesByEarliestDts_(t);n.baseMediaDecodeTime=y(n);this.prefixWithSilence_(n,i);n.samples=this.generateSampleTable_(i);o=e.mdat(this.concatenateFrameData_(i));t=[];r=e.moof(s,[n]);u=new Uint8Array(r.byteLength+o.byteLength);s++;u.set(r);u.set(o,r.byteLength);f(n);this.trigger("data",{track:n,boxes:u});this.trigger("done","AudioSegmentStream")};this.prefixWithSilence_=function(n,t){var h,e=0,c=0,i=0,s=0,r,f;if(t.length&&(h=b.audioTsToVideoTs(n.baseMediaDecodeTime,n.samplerate),e=Math.ceil(v/(n.samplerate/1024)),u&&o&&(c=h-Math.max(u,o),i=Math.floor(c/e),s=i*e),!(i<1)&&!(s>v/2))){for(r=it[n.samplerate],r||(r=t[0].data),f=0;f<i;f++)t.splice(f,0,{data:r});n.baseMediaDecodeTime-=Math.floor(b.videoTsToAudioTs(s,n.samplerate))}};this.trimAdtsFramesByEarliestDts_=function(t){return n.minSegmentDts>=i?t:(n.minSegmentDts=Infinity,t.filter(function(t){return t.dts>=i?(n.minSegmentDts=Math.min(n.minSegmentDts,t.dts),n.minSegmentPts=n.minSegmentDts,!0):!1}))};this.generateSampleTable_=function(n){for(var i,r=[],t=0;t<n.length;t++)i=n[t],r.push({size:i.data.byteLength,duration:1024});return r};this.concatenateFrameData_=function(n){for(var i,r=0,u=new Uint8Array(g(n)),t=0;t<n.length;t++)i=n[t],u.set(i.data,r),r+=i.data.byteLength;return u}};r.prototype=new s;o=function(n,t){var h=0,i=[],r=[],u,s;t=t||{};o.prototype.init.call(this);delete n.minPTS;this.gopCache_=[];this.push=function(t){c(n,t);t.nalUnitType!=="seq_parameter_set_rbsp"||u||(u=t.config,n.sps=[t.data],a.forEach(function(t){n[t]=u[t]},this));t.nalUnitType!=="pic_parameter_set_rbsp"||s||(s=t.data,n.pps=[t.data]);i.push(t)};this.flush=function(){for(var p,o,u,s,a,l,v;i.length;){if(i[0].nalUnitType==="access_unit_delimiter_rbsp")break;i.shift()}if(i.length===0){this.resetStream_();this.trigger("done","VideoSegmentStream");return}if(p=this.groupNalsIntoFrames_(i),u=this.groupFramesIntoGops_(p),u[0][0].keyFrame||(o=this.getGopForFusion_(i[0],n),o?(u.unshift(o),u.byteLength+=o.byteLength,u.nalCount+=o.nalCount,u.pts=o.pts,u.dts=o.dts,u.duration+=o.duration):u=this.extendFirstKeyFrame_(u)),r.length){if(v=t.alignGopsAtEnd?this.alignGopsAtEnd_(u):this.alignGopsAtStart_(u),!v){this.gopCache_.unshift({gop:u.pop(),pps:n.pps,sps:n.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);i=[];this.resetStream_();this.trigger("done","VideoSegmentStream");return}f(n);u=v}c(n,u);n.samples=this.generateSampleTable_(u);a=e.mdat(this.concatenateNalData_(u));n.baseMediaDecodeTime=y(n);this.trigger("processedGopsInfo",u.map(function(n){return{pts:n.pts,dts:n.dts,byteLength:n.byteLength}}));this.gopCache_.unshift({gop:u.pop(),pps:n.pps,sps:n.sps});this.gopCache_.length=Math.min(6,this.gopCache_.length);i=[];this.trigger("baseMediaDecodeTime",n.baseMediaDecodeTime);this.trigger("timelineStartInfo",n.timelineStartInfo);s=e.moof(h,[n]);l=new Uint8Array(s.byteLength+a.byteLength);h++;l.set(s);l.set(a,s.byteLength);this.trigger("data",{track:n,boxes:l});this.resetStream_();this.trigger("done","VideoSegmentStream")};this.resetStream_=function(){f(n);u=undefined;s=undefined};this.getGopForFusion_=function(t){for(var o=Infinity,i,u,f,r,e=0;e<this.gopCache_.length;e++)(r=this.gopCache_[e],f=r.gop,n.pps&&p(n.pps[0],r.pps[0])&&n.sps&&p(n.sps[0],r.sps[0]))&&(f.dts<n.timelineStartInfo.dts||(i=t.dts-f.dts-f.duration,i>=-1e4&&i<=45e3&&(!u||o>i)&&(u=r,o=i)));return u?u.gop:null};this.extendFirstKeyFrame_=function(n){var t;return!n[0][0].keyFrame&&n.length>1&&(t=n.shift(),n.byteLength-=t.byteLength,n.nalCount-=t.nalCount,n[0][0].dts=t.dts,n[0][0].pts=t.pts,n[0][0].duration+=t.duration),n};this.groupNalsIntoFrames_=function(n){var u,i,t=[],r=[];for(t.byteLength=0,u=0;u<n.length;u++)i=n[u],i.nalUnitType==="access_unit_delimiter_rbsp"?(t.length&&(t.duration=i.dts-t.dts,r.push(t)),t=[i],t.byteLength=i.data.byteLength,t.pts=i.pts,t.dts=i.dts):(i.nalUnitType==="slice_layer_without_partitioning_rbsp_idr"&&(t.keyFrame=!0),t.duration=i.dts-t.dts,t.byteLength+=i.data.byteLength,t.push(i));return r.length&&(!t.duration||t.duration<=0)&&(t.duration=r[r.length-1].duration),r.push(t),r};this.groupFramesIntoGops_=function(n){var u,r,t=[],i=[];for(t.byteLength=0,t.nalCount=0,t.duration=0,t.pts=n[0].pts,t.dts=n[0].dts,i.byteLength=0,i.nalCount=0,i.duration=0,i.pts=n[0].pts,i.dts=n[0].dts,u=0;u<n.length;u++)r=n[u],r.keyFrame?(t.length&&(i.push(t),i.byteLength+=t.byteLength,i.nalCount+=t.nalCount,i.duration+=t.duration),t=[r],t.nalCount=r.length,t.byteLength=r.byteLength,t.pts=r.pts,t.dts=r.dts,t.duration=r.duration):(t.duration+=r.duration,t.nalCount+=r.length,t.byteLength+=r.byteLength,t.push(r));return i.length&&t.duration<=0&&(t.duration=i[i.length-1].duration),i.byteLength+=t.byteLength,i.nalCount+=t.nalCount,i.duration+=t.duration,i.push(t),i};this.generateSampleTable_=function(n,t){for(var f,i,e,r,o=t||0,s=[],u=0;u<n.length;u++)for(e=n[u],f=0;f<e.length;f++)r=e[f],i=k(),i.dataOffset=o,i.compositionTimeOffset=r.pts-r.dts,i.duration=r.duration,i.size=4*r.length,i.size+=r.byteLength,r.keyFrame&&(i.flags.dependsOn=2),o+=i.size,s.push(i);return s};this.concatenateNalData_=function(n){for(var i,r,e,o,u,f=0,h=n.byteLength,c=n.nalCount,l=h+4*c,s=new Uint8Array(l),a=new DataView(s.buffer),t=0;t<n.length;t++)for(e=n[t],i=0;i<e.length;i++)for(o=e[i],r=0;r<o.length;r++)u=o[r],a.setUint32(f,u.data.byteLength),f+=4,s.set(u.data,f),f+=u.data.byteLength;return s};this.alignGopsAtStart_=function(n){var f,i,e,u,o,s,h,t;for(o=n.byteLength,s=n.nalCount,h=n.duration,f=i=0;f<r.length&&i<n.length;){if(e=r[f],u=n[i],e.pts===u.pts)break;if(u.pts>e.pts){f++;continue}i++;o-=u.byteLength;s-=u.nalCount;h-=u.duration}return i===0?n:i===n.length?null:(t=n.slice(i),t.byteLength=o,t.duration=h,t.nalCount=s,t.pts=t[0].pts,t.dts=t[0].dts,t)};this.alignGopsAtEnd_=function(n){var u,i,s,h,f,e,c,t,o;for(u=r.length-1,i=n.length-1,f=null,e=!1;u>=0&&i>=0;){if(s=r[u],h=n[i],s.pts===h.pts){e=!0;break}if(s.pts>h.pts){u--;continue}u===r.length-1&&(f=i);i--}return!e&&f===null?null:(c=e?i:f,c===0)?n:(t=n.slice(c),o=t.reduce(function(n,t){return n.byteLength+=t.byteLength,n.duration+=t.duration,n.nalCount+=t.nalCount,n},{byteLength:0,duration:0,nalCount:0}),t.byteLength=o.byteLength,t.duration=o.duration,t.nalCount=o.nalCount,t.pts=t[0].pts,t.dts=t[0].dts,t)};this.alignGopsWith=function(n){r=n}};o.prototype=new s;c=function(n,t){typeof t.pts=="number"&&(n.timelineStartInfo.pts===undefined&&(n.timelineStartInfo.pts=t.pts),n.minSegmentPts=n.minSegmentPts===undefined?t.pts:Math.min(n.minSegmentPts,t.pts),n.maxSegmentPts=n.maxSegmentPts===undefined?t.pts:Math.max(n.maxSegmentPts,t.pts));typeof t.dts=="number"&&(n.timelineStartInfo.dts===undefined&&(n.timelineStartInfo.dts=t.dts),n.minSegmentDts=n.minSegmentDts===undefined?t.dts:Math.min(n.minSegmentDts,t.dts),n.maxSegmentDts=n.maxSegmentDts===undefined?t.dts:Math.max(n.maxSegmentDts,t.dts))};f=function(n){delete n.minSegmentDts;delete n.maxSegmentDts;delete n.minSegmentPts;delete n.maxSegmentPts};y=function(n){var t,i,r=n.minSegmentDts-n.timelineStartInfo.dts;return t=n.timelineStartInfo.baseMediaDecodeTime,t+=r,t=Math.max(0,t),n.type==="audio"&&(i=n.samplerate/v,t*=i,t=Math.floor(t)),t};u=function(n,t){this.numberOfTracks=0;this.metadataStream=t;this.remuxTracks=typeof n.remux!="undefined"?!!n.remux:!0;this.pendingTracks=[];this.videoTrack=null;this.pendingBoxes=[];this.pendingCaptions=[];this.pendingMetadata=[];this.pendingBytes=0;this.emittedTracks=0;u.prototype.init.call(this);this.push=function(n){if(n.text)return this.pendingCaptions.push(n);if(n.frames)return this.pendingMetadata.push(n);this.pendingTracks.push(n.track);this.pendingBoxes.push(n.boxes);this.pendingBytes+=n.boxes.byteLength;n.track.type==="video"&&(this.videoTrack=n.track);n.track.type==="audio"&&(this.audioTrack=n.track)}};u.prototype=new s;u.prototype.flush=function(n){var s=0,i={captions:[],captionStreams:{},metadata:[],info:{}},r,u,o,f=0,t;if(this.pendingTracks.length<this.numberOfTracks){if(n!=="VideoSegmentStream"&&n!=="AudioSegmentStream")return;if(this.remuxTracks)return;if(this.pendingTracks.length===0){this.emittedTracks++;this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0);return}}for(this.videoTrack?(f=this.videoTrack.timelineStartInfo.pts,a.forEach(function(n){i.info[n]=this.videoTrack[n]},this)):this.audioTrack&&(f=this.audioTrack.timelineStartInfo.pts,l.forEach(function(n){i.info[n]=this.audioTrack[n]},this)),i.type=this.pendingTracks.length===1?this.pendingTracks[0].type:"combined",this.emittedTracks+=this.pendingTracks.length,o=e.initSegment(this.pendingTracks),i.initSegment=new Uint8Array(o.byteLength),i.initSegment.set(o),i.data=new Uint8Array(this.pendingBytes),t=0;t<this.pendingBoxes.length;t++)i.data.set(this.pendingBoxes[t],s),s+=this.pendingBoxes[t].byteLength;for(t=0;t<this.pendingCaptions.length;t++)r=this.pendingCaptions[t],r.startTime=r.startPts-f,r.startTime/=9e4,r.endTime=r.endPts-f,r.endTime/=9e4,i.captionStreams[r.stream]=!0,i.captions.push(r);for(t=0;t<this.pendingMetadata.length;t++)u=this.pendingMetadata[t],u.cueTime=u.pts-f,u.cueTime/=9e4,i.metadata.push(u);i.metadata.dispatchType=this.metadataStream.dispatchType;this.pendingTracks.length=0;this.videoTrack=null;this.pendingBoxes.length=0;this.pendingCaptions.length=0;this.pendingBytes=0;this.pendingMetadata.length=0;this.trigger("data",i);this.emittedTracks>=this.numberOfTracks&&(this.trigger("done"),this.emittedTracks=0)};h=function(n){var s=this,c=!0,e,t;h.prototype.init.call(this);n=n||{};this.baseMediaDecodeTime=n.baseMediaDecodeTime||0;this.transmuxPipeline_={};this.setupAacPipeline=function(){var f={};this.transmuxPipeline_=f;f.type="aac";f.metadataStream=new i.MetadataStream;f.aacStream=new tt;f.audioTimestampRolloverStream=new i.TimestampRolloverStream("audio");f.timedMetadataTimestampRolloverStream=new i.TimestampRolloverStream("timed-metadata");f.adtsStream=new w;f.coalesceStream=new u(n,f.metadataStream);f.headOfPipeline=f.aacStream;f.aacStream.pipe(f.audioTimestampRolloverStream).pipe(f.adtsStream);f.aacStream.pipe(f.timedMetadataTimestampRolloverStream).pipe(f.metadataStream).pipe(f.coalesceStream);f.metadataStream.on("timestamp",function(n){f.aacStream.setTimestamp(n.timeStamp)});f.aacStream.on("data",function(n){n.type!=="timed-metadata"||f.audioSegmentStream||(t=t||{timelineStartInfo:{baseMediaDecodeTime:s.baseMediaDecodeTime},codec:"adts",type:"audio"},f.coalesceStream.numberOfTracks++,f.audioSegmentStream=new r(t),f.adtsStream.pipe(f.audioSegmentStream).pipe(f.coalesceStream))});f.coalesceStream.on("data",this.trigger.bind(this,"data"));f.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setupTsPipeline=function(){var f={};this.transmuxPipeline_=f;f.type="ts";f.metadataStream=new i.MetadataStream;f.packetStream=new i.TransportPacketStream;f.parseStream=new i.TransportParseStream;f.elementaryStream=new i.ElementaryStream;f.videoTimestampRolloverStream=new i.TimestampRolloverStream("video");f.audioTimestampRolloverStream=new i.TimestampRolloverStream("audio");f.timedMetadataTimestampRolloverStream=new i.TimestampRolloverStream("timed-metadata");f.adtsStream=new w;f.h264Stream=new nt;f.captionStream=new i.CaptionStream;f.coalesceStream=new u(n,f.metadataStream);f.headOfPipeline=f.packetStream;f.packetStream.pipe(f.parseStream).pipe(f.elementaryStream);f.elementaryStream.pipe(f.videoTimestampRolloverStream).pipe(f.h264Stream);f.elementaryStream.pipe(f.audioTimestampRolloverStream).pipe(f.adtsStream);f.elementaryStream.pipe(f.timedMetadataTimestampRolloverStream).pipe(f.metadataStream).pipe(f.coalesceStream);f.h264Stream.pipe(f.captionStream).pipe(f.coalesceStream);f.elementaryStream.on("data",function(i){var u;if(i.type==="metadata"){for(u=i.tracks.length;u--;)e||i.tracks[u].type!=="video"?t||i.tracks[u].type!=="audio"||(t=i.tracks[u],t.timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime):(e=i.tracks[u],e.timelineStartInfo.baseMediaDecodeTime=s.baseMediaDecodeTime);if(e&&!f.videoSegmentStream){f.coalesceStream.numberOfTracks++;f.videoSegmentStream=new o(e,n);f.videoSegmentStream.on("timelineStartInfo",function(n){t&&(t.timelineStartInfo=n,f.audioSegmentStream.setEarliestDts(n.dts))});f.videoSegmentStream.on("processedGopsInfo",s.trigger.bind(s,"gopInfo"));f.videoSegmentStream.on("baseMediaDecodeTime",function(n){t&&f.audioSegmentStream.setVideoBaseMediaDecodeTime(n)});f.h264Stream.pipe(f.videoSegmentStream).pipe(f.coalesceStream)}t&&!f.audioSegmentStream&&(f.coalesceStream.numberOfTracks++,f.audioSegmentStream=new r(t),f.adtsStream.pipe(f.audioSegmentStream).pipe(f.coalesceStream))}});f.coalesceStream.on("data",this.trigger.bind(this,"data"));f.coalesceStream.on("done",this.trigger.bind(this,"done"))};this.setBaseMediaDecodeTime=function(n){var i=this.transmuxPipeline_;this.baseMediaDecodeTime=n;t&&(t.timelineStartInfo.dts=undefined,t.timelineStartInfo.pts=undefined,f(t),t.timelineStartInfo.baseMediaDecodeTime=n,i.audioTimestampRolloverStream&&i.audioTimestampRolloverStream.discontinuity());e&&(i.videoSegmentStream&&(i.videoSegmentStream.gopCache_=[],i.videoTimestampRolloverStream.discontinuity()),e.timelineStartInfo.dts=undefined,e.timelineStartInfo.pts=undefined,f(e),i.captionStream.reset(),e.timelineStartInfo.baseMediaDecodeTime=n);i.timedMetadataTimestampRolloverStream&&i.timedMetadataTimestampRolloverStream.discontinuity()};this.setAudioAppendStart=function(n){t&&this.transmuxPipeline_.audioSegmentStream.setAudioAppendStart(n)};this.alignGopsWith=function(n){e&&this.transmuxPipeline_.videoSegmentStream&&this.transmuxPipeline_.videoSegmentStream.alignGopsWith(n)};this.push=function(n){if(c){var t=d(n);t&&this.transmuxPipeline_.type!=="aac"?this.setupAacPipeline():t||this.transmuxPipeline_.type==="ts"||this.setupTsPipeline();c=!1}this.transmuxPipeline_.headOfPipeline.push(n)};this.flush=function(){c=!0;this.transmuxPipeline_.headOfPipeline.flush()};this.resetCaptions=function(){this.transmuxPipeline_.captionStream&&this.transmuxPipeline_.captionStream.reset()}};h.prototype=new s;t.exports={Transmuxer:h,VideoSegmentStream:o,AudioSegmentStream:r,AUDIO_PROPERTIES:l,VIDEO_PROPERTIES:a}},{"../aac":38,"../codecs/adts.js":40,"../codecs/h264":41,"../data/silence":42,"../m2ts/m2ts.js":50,"../utils/clock":60,"../utils/stream.js":62,"./mp4-generator.js":56}],59:[function(n,t){"use strict";var o=n("../m2ts/stream-types.js"),e=n("../m2ts/timestamp-rollover-stream.js").handleRollover,i={};i.ts=n("../m2ts/probe.js");i.aac=n("../aac/probe.js");var f=9e4,r=188,u=71,s=function(n){return n[0]==="I".charCodeAt(0)&&n[1]==="D".charCodeAt(0)&&n[2]==="3".charCodeAt(0)?!0:!1},h=function(n,t){for(var e=0,f=r,o,s;f<n.byteLength;){if(n[e]===u&&n[f]===u){o=n.subarray(e,f);s=i.ts.parseType(o,t.pid);switch(s){case"pat":t.pid||(t.pid=i.ts.parsePat(o));break;case"pmt":t.table||(t.table=i.ts.parsePmt(o))}if(t.pid&&t.table)return;e+=r;f+=r;continue}e++;f++}},c=function(n,t,f){for(var o=0,e=r,s,l,a,v,h,c=!1;e<n.byteLength;){if(n[o]===u&&n[e]===u){s=n.subarray(o,e);l=i.ts.parseType(s,t.pid);switch(l){case"pes":a=i.ts.parsePesType(s,t.table);v=i.ts.parsePayloadUnitStartIndicator(s);a==="audio"&&v&&(h=i.ts.parsePesTime(s),h&&(h.type="audio",f.audio.push(h),c=!0))}if(c)break;o+=r;e+=r;continue}o++;e++}for(e=n.byteLength,o=e-r,c=!1;o>=0;){if(n[o]===u&&n[e]===u){s=n.subarray(o,e);l=i.ts.parseType(s,t.pid);switch(l){case"pes":a=i.ts.parsePesType(s,t.table);v=i.ts.parsePayloadUnitStartIndicator(s);a==="audio"&&v&&(h=i.ts.parsePesTime(s),h&&(h.type="audio",f.audio.push(h),c=!0))}if(c)break;o-=r;e-=r;continue}o--;e--}},l=function(n,t,f){for(var s=0,o=r,e,v,y,a,h,p,w,b,l=!1,c={data:[],size:0};o<n.byteLength;){if(n[s]===u&&n[o]===u){e=n.subarray(s,o);v=i.ts.parseType(e,t.pid);switch(v){case"pes":if(y=i.ts.parsePesType(e,t.table),a=i.ts.parsePayloadUnitStartIndicator(e),y==="video"&&(a&&!l&&(h=i.ts.parsePesTime(e),h&&(h.type="video",f.video.push(h),l=!0)),!f.firstKeyFrame)){if(a&&c.size!==0){for(p=new Uint8Array(c.size),w=0;c.data.length;)b=c.data.shift(),p.set(b,w),w+=b.byteLength;i.ts.videoPacketContainsKeyFrame(p)&&(f.firstKeyFrame=i.ts.parsePesTime(p),f.firstKeyFrame.type="video");c.size=0}c.data.push(e);c.size+=e.byteLength}}if(l&&f.firstKeyFrame)break;s+=r;o+=r;continue}s++;o++}for(o=n.byteLength,s=o-r,l=!1;s>=0;){if(n[s]===u&&n[o]===u){e=n.subarray(s,o);v=i.ts.parseType(e,t.pid);switch(v){case"pes":y=i.ts.parsePesType(e,t.table);a=i.ts.parsePayloadUnitStartIndicator(e);y==="video"&&a&&(h=i.ts.parsePesTime(e),h&&(h.type="video",f.video.push(h),l=!0))}if(l)break;s-=r;o-=r;continue}s--;o--}},a=function(n,t){var u,r,i;n.audio&&n.audio.length&&(u=t,typeof u=="undefined"&&(u=n.audio[0].dts),n.audio.forEach(function(n){n.dts=e(n.dts,u);n.pts=e(n.pts,u);n.dtsTime=n.dts/f;n.ptsTime=n.pts/f}));n.video&&n.video.length&&(r=t,typeof r=="undefined"&&(r=n.video[0].dts),n.video.forEach(function(n){n.dts=e(n.dts,r);n.pts=e(n.pts,r);n.dtsTime=n.dts/f;n.ptsTime=n.pts/f}),n.firstKeyFrame&&(i=n.firstKeyFrame,i.dts=e(i.dts,r),i.pts=e(i.pts,r),i.dtsTime=i.dts/f,i.ptsTime=i.dts/f))},v=function(n){for(var e=!1,h=0,o=null,u=null,r=0,t=0,s,l,c,a;n.length-t>=3;){l=i.aac.parseType(n,t);switch(l){case"timed-metadata":if(n.length-t<10){e=!0;break}if(r=i.aac.parseId3TagSize(n,t),r>n.length){e=!0;break}u===null&&(s=n.subarray(t,t+r),u=i.aac.parseAacTimestamp(s));t+=r;break;case"audio":if(n.length-t<7){e=!0;break}if(r=i.aac.parseAdtsSize(n,t),r>n.length){e=!0;break}o===null&&(s=n.subarray(t,t+r),o=i.aac.parseSampleRate(s));h++;t+=r;break;default:t++}if(e)return null}return o===null||u===null?null:(c=f/o,a={audio:[{type:"audio",dts:u,pts:u},{type:"audio",dts:u+h*1024*c,pts:u+h*1024*c}]},a)},y=function(n){var i={pid:null,table:null},t={},r,u;h(n,i);for(r in i.table)if(i.table.hasOwnProperty(r)){u=i.table[r];switch(u){case o.H264_STREAM_TYPE:t.video=[];l(n,i,t);t.video.length===0&&delete t.video;break;case o.ADTS_STREAM_TYPE:t.audio=[];c(n,i,t);t.audio.length===0&&delete t.audio}}return t},p=function(n,t){var r=s(n),i;return(i=r?v(n):y(n),!i||!i.audio&&!i.video)?null:(a(i,t),i)};t.exports={inspect:p}},{"../aac/probe.js":39,"../m2ts/probe.js":52,"../m2ts/stream-types.js":53,"../m2ts/timestamp-rollover-stream.js":54}],60:[function(n,t){var e=9e4,i,r,u,f,o,s;i=function(n){return n*e};r=function(n,t){return n*t};u=function(n){return n/e};f=function(n,t){return n/t};o=function(n,t){return i(f(n,t))};s=function(n,t){return r(u(n),t)};t.exports={secondsToVideoTs:i,secondsToAudioTs:r,videoTsToSeconds:u,audioTsToSeconds:f,audioTsToVideoTs:o,videoTsToAudioTs:s}},{}],61:[function(n,t){"use strict";var i;i=function(n){var i=n.byteLength,r=0,t=0;this.length=function(){return 8*i};this.bitsAvailable=function(){return 8*i+t};this.loadWord=function(){var f=n.byteLength-i,e=new Uint8Array(4),u=Math.min(4,i);if(u===0)throw new Error("no bytes available");e.set(n.subarray(f,f+u));r=new DataView(e.buffer).getUint32(0);t=u*8;i-=u};this.skipBits=function(n){var u;t>n?(r<<=n,t-=n):(n-=t,u=Math.floor(n/8),n-=u*8,i-=u,this.loadWord(),r<<=n,t-=n)};this.readBits=function(n){var u=Math.min(t,n),f=r>>>32-u;return(t-=u,t>0?r<<=u:i>0&&this.loadWord(),u=n-u,u>0)?f<<u|this.readBits(u):f};this.skipLeadingZeros=function(){for(var n=0;n<t;++n)if((r&2147483648>>>n)!=0)return r<<=n,t-=n,n;return this.loadWord(),n+this.skipLeadingZeros()};this.skipUnsignedExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.skipExpGolomb=function(){this.skipBits(1+this.skipLeadingZeros())};this.readUnsignedExpGolomb=function(){var n=this.skipLeadingZeros();return this.readBits(n+1)-1};this.readExpGolomb=function(){var n=this.readUnsignedExpGolomb();return 1&n?1+n>>>1:-1*(n>>>1)};this.readBoolean=function(){return this.readBits(1)===1};this.readUnsignedByte=function(){return this.readBits(8)};this.loadWord()};t.exports=i},{}],62:[function(n,t){"use strict";var i=function(){this.init=function(){var n={};this.on=function(t,i){n[t]||(n[t]=[]);n[t]=n[t].concat(i)};this.off=function(t,i){var r;return n[t]?(r=n[t].indexOf(i),n[t]=n[t].slice(),n[t].splice(r,1),r>-1):!1};this.trigger=function(t){var r,i,u,f;if(r=n[t],r)if(arguments.length===2)for(u=r.length,i=0;i<u;++i)r[i].call(this,arguments[1]);else{for(f=[],i=arguments.length,i=1;i<arguments.length;++i)f.push(arguments[i]);for(u=r.length,i=0;i<u;++i)r[i].apply(this,f)}};this.dispose=function(){n={}}}};i.prototype.pipe=function(n){this.on("data",function(t){n.push(t)});this.on("done",function(t){n.flush(t)});return n};i.prototype.push=function(n){this.trigger("data",n)};i.prototype.flush=function(n){this.trigger("done",n)};t.exports=i},{}],63:[function(t,i,r){(function(t){var f=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/\;?#]*)?(.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,e=/^([^\/;?#]*)(.*)$/,o=/(?:\/|^)\.(?=\/)/g,s=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,u={buildAbsoluteURL:function(n,t,i){var s,r,f,h,o,c,l;if(i=i||{},n=n.trim(),t=t.trim(),!t){if(!i.alwaysNormalize)return n;if(s=this.parseURL(n),!s)throw new Error("Error trying to parse base URL.");return s.path=u.normalizePath(s.path),u.buildURLFromParts(s)}if(r=this.parseURL(t),!r)throw new Error("Error trying to parse relative URL.");if(r.scheme)return i.alwaysNormalize?(r.path=u.normalizePath(r.path),u.buildURLFromParts(r)):t;if(f=this.parseURL(n),!f)throw new Error("Error trying to parse base URL.");return!f.netLoc&&f.path&&f.path[0]!=="/"&&(h=e.exec(f.path),f.netLoc=h[1],f.path=h[2]),f.netLoc&&!f.path&&(f.path="/"),o={scheme:f.scheme,netLoc:r.netLoc,path:null,params:r.params,query:r.query,fragment:r.fragment},r.netLoc||(o.netLoc=f.netLoc,r.path[0]!=="/"&&(r.path?(c=f.path,l=c.substring(0,c.lastIndexOf("/")+1)+r.path,o.path=u.normalizePath(l)):(o.path=f.path,r.params||(o.params=f.params,r.query||(o.query=f.query))))),o.path===null&&(o.path=i.alwaysNormalize?u.normalizePath(r.path):r.path),u.buildURLFromParts(o)},parseURL:function(n){var t=f.exec(n);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(n){for(n=n.split("").reverse().join("").replace(o,"");n.length!==(n=n.replace(s,"")).length;);return n.split("").reverse().join("")},buildURLFromParts:function(n){return n.scheme+n.netLoc+n.path+n.params+n.query+n.fragment}};typeof r=="object"&&typeof i=="object"?i.exports=u:typeof n=="function"&&n.amd?n([],function(){return u}):typeof r=="object"?r.URLToolkit=u:t.URLToolkit=u})(this)},{}],64:[function(n,t,i){(function(r){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}Object.defineProperty(i,"__esModule",{value:!0});var s=n("global/window"),e=f(s),h=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,u=f(h),c=function(n){Object.defineProperties(n.frame,{id:{get:function(){return u["default"].log.warn("cue.frame.id is deprecated. Use cue.value.key instead."),n.value.key}},value:{get:function(){return u["default"].log.warn("cue.frame.value is deprecated. Use cue.value.data instead."),n.value.data}},privateData:{get:function(){return u["default"].log.warn("cue.frame.privateData is deprecated. Use cue.value.data instead."),n.value.data}}})},o=function(n){var t=undefined;return isNaN(n)||Math.abs(n)===Infinity?Number.MAX_VALUE:n},l=function(n,t,i){var r=e["default"].WebKitDataCue||e["default"].VTTCue;t&&t.forEach(function(n){var t=n.stream;this.inbandTextTracks_[t].addCue(new r(n.startTime+this.timestampOffset,n.endTime+this.timestampOffset,n.text))},n);i&&function(){var t=o(n.mediaSource_.duration);i.forEach(function(n){var t=n.cueTime+this.timestampOffset;n.frames.forEach(function(n){var i=new r(t,t,n.value||n.url||n.data||"");i.frame=n;i.value=n;c(i);this.metadataTrack_.addCue(i)},this)},n);n.metadataTrack_&&n.metadataTrack_.cues&&n.metadataTrack_.cues.length&&function(){for(var u,f,r=n.metadataTrack_.cues,e=[],i=0;i<r.length;i++)r[i]&&e.push(r[i]);u=e.reduce(function(n,t){var i=n[t.startTime]||[];return i.push(t),n[t.startTime]=i,n},{});f=Object.keys(u).sort(function(n,t){return Number(n)-Number(t)});f.forEach(function(n,i){var r=u[n],e=Number(f[i+1])||t;r.forEach(function(n){n.endTime=e})})}()}()};i["default"]={addTextTrackData:l,durationOfVideo:o};t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"global/window":32}],65:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(n){return/mp4a\.\d+.\d+/i.test(n)},u=function(n){return/avc1\.[\da-f]+/i.test(n)},f=function(n){var t={type:"",parameters:{}},i=n.trim().split(";");return t.type=i.shift().trim(),i.forEach(function(n){var i=n.trim().split("="),r,u;i.length>1&&(r=i[0].replace(/"/g,"").trim(),u=i[1].replace(/"/g,"").trim(),t.parameters[r]=u)}),t},e=function(n){return n.map(function(n){return n.replace(/avc1\.(\d+)\.(\d+)/i,function(n,t,i){var r=("00"+Number(t).toString(16)).slice(-2),u=("00"+Number(i).toString(16)).slice(-2);return"avc1."+r+"00"+u})})};i["default"]={isAudioCodec:r,parseContentType:f,isVideoCodec:u,translateLegacyCodecs:e};t.exports=i["default"]},{}],66:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(n,t,i){var u=t.player_,r,f;if(i.captions&&i.captions.length){n.inbandTextTracks_||(n.inbandTextTracks_={});for(r in i.captionStreams)n.inbandTextTracks_[r]||(u.tech_.trigger({type:"usage",name:"hls-608"}),f=u.textTracks().getTrackById(r),n.inbandTextTracks_[r]=f?f:u.addRemoteTextTrack({kind:"captions",id:r,label:r},!1).track)}i.metadata&&i.metadata.length&&!n.metadataTrack_&&(n.metadataTrack_=u.addRemoteTextTrack({kind:"metadata",label:"Timed Metadata"},!1).track,n.metadataTrack_.inBandMetadataTrackDispatchType=i.metadata.dispatchType)};i["default"]=r;t.exports=i["default"]},{}],67:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});i["default"]={TIME_BETWEEN_CHUNKS:1,BYTES_PER_CHUNK:32768};t.exports=i["default"]},{}],68:[function(n,t,i){(function(r){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function l(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function a(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var o,s,e;Object.defineProperty(i,"__esModule",{value:!0});o=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();s=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var v=n("global/document"),y=u(v),p=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,h=u(p),w=n("./flash-source-buffer"),b=u(w),k=n("./flash-constants"),c=u(k),d=n("./codec-utils"),f=function(n){function t(){var n=this;l(this,t);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);this.sourceBuffers=[];this.readyState="closed";this.on(["sourceopen","webkitsourceopen"],function(t){n.swfObj=y["default"].getElementById(t.swfId);n.player_=h["default"](n.swfObj.parentNode);n.tech_=n.swfObj.tech;n.readyState="open";n.tech_.on("seeking",function(){for(var t=n.sourceBuffers.length;t--;)n.sourceBuffers[t].abort()});n.swfObj&&n.swfObj.vjs_load()})}return a(t,n),o(t,[{key:"addSeekableRange_",value:function(){}},{key:"addSourceBuffer",value:function(n){var i=d.parseContentType(n),t=undefined;if(i.type==="video/mp2t"||i.type==="audio/mp2t")t=new b["default"](this);else throw new Error("NotSupportedError (Video.js)");return this.sourceBuffers.push(t),t}},{key:"endOfStream",value:function(n){n==="network"?this.tech_.error(2):n==="decode"&&this.tech_.error(3);this.readyState!=="ended"&&(this.readyState="ended",this.swfObj.vjs_endOfStream())}}]),t}(h["default"].EventTarget);i["default"]=f;try{Object.defineProperty(f.prototype,"duration",{get:function(){return this.swfObj?this.swfObj.vjs_getProperty("duration"):NaN},set:function(n){var t=undefined,i=this.swfObj.vjs_getProperty("duration");if(this.swfObj.vjs_setProperty("duration",n),n<i)for(t=0;t<this.sourceBuffers.length;t++)this.sourceBuffers[t].remove(n,i);return n}})}catch(tt){f.prototype.duration=NaN}for(e in c["default"])f[e]=c["default"][e];t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./codec-utils":65,"./flash-constants":67,"./flash-source-buffer":69,"global/document":31}],69:[function(n,t,i){(function(r){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function y(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function p(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var c,l;Object.defineProperty(i,"__esModule",{value:!0});c=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();l=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var w=n("global/window"),f=u(w),b=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,o=u(b),k=n("mux.js/lib/flv"),d=u(k),g=n("./remove-cues-from-track"),e=u(g),nt=n("./create-text-tracks-if-necessary"),tt=u(nt),it=n("./add-text-track-data"),rt=n("./flash-transmuxer-worker"),ut=u(rt),ft=n("webwackify"),et=u(ft),ot=n("./flash-constants"),s=u(ot),st=function(){var t=undefined;try{t=n.resolve("./flash-transmuxer-worker")}catch(i){}return t},h=function(n){f["default"].setTimeout(n,s["default"].TIME_BETWEEN_CHUNKS)},a=function(){return Math.random().toString(36).slice(2,8)},v=function(n,t){(typeof t!="number"||t<0)&&(t=0);var i=Math.pow(10,t);return Math.round(n*i)/i},ht=function(n){function t(n){var i=this,r,u,h;y(this,t);l(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);r=undefined;this.chunkSize_=s["default"].BYTES_PER_CHUNK;this.buffer_=[];this.bufferSize_=0;this.basePtsOffset_=NaN;this.mediaSource_=n;this.audioBufferEnd_=NaN;this.videoBufferEnd_=NaN;this.updating=!1;this.timestampOffset_=0;r=f["default"].btoa(String.fromCharCode.apply(null,Array.prototype.slice.call(d["default"].getFlvHeader())));u=this.mediaSource_.player_.id().replace(/[^a-zA-Z0-9]/g,"_");this.flashEncodedHeaderName_="vjs_flashEncodedHeader_"+u+a();this.flashEncodedDataName_="vjs_flashEncodedData_"+u+a();f["default"][this.flashEncodedHeaderName_]=function(){return delete f["default"][i.flashEncodedHeaderName_],r};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedHeaderName_);this.transmuxer_=et["default"](ut["default"],st());this.transmuxer_.postMessage({action:"init",options:{}});this.transmuxer_.onmessage=function(n){n.data.action==="data"&&i.receiveBuffer_(n.data.segment)};this.one("updateend",function(){i.mediaSource_.tech_.trigger("loadedmetadata")});Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(n){typeof n=="number"&&n>=0&&(this.timestampOffset_=n,this.mediaSource_.swfObj.vjs_discontinuity(),this.basePtsOffset_=NaN,this.audioBufferEnd_=NaN,this.videoBufferEnd_=NaN,this.transmuxer_.postMessage({action:"reset"}))}});Object.defineProperty(this,"buffered",{get:function(){if(!this.mediaSource_||!this.mediaSource_.swfObj||!("vjs_getProperty"in this.mediaSource_.swfObj))return o["default"].createTimeRange();var n=this.mediaSource_.swfObj.vjs_getProperty("buffered");return n&&n.length&&(n[0][0]=v(n[0][0],3),n[0][1]=v(n[0][1],3)),o["default"].createTimeRanges(n)}});this.mediaSource_.player_.on("seeked",function(){if(e["default"](0,Infinity,i.metadataTrack_),i.inbandTextTracks_)for(var n in i.inbandTextTracks_)e["default"](0,Infinity,i.inbandTextTracks_[n])});h=this.onHlsReset_.bind(this);this.mediaSource_.player_.tech_.on("hls-reset",h);this.mediaSource_.player_.tech_.hls.on("dispose",function(){i.transmuxer_.terminate();i.mediaSource_.player_.tech_.off("hls-reset",h)})}return p(t,n),c(t,[{key:"appendBuffer",value:function(n){var t=undefined;if(this.updating){t=new Error("SourceBuffer.append() cannot be called while an update is in progress");t.name="InvalidStateError";t.code=11;throw t;}this.updating=!0;this.mediaSource_.readyState="open";this.trigger({type:"update"});this.transmuxer_.postMessage({action:"push",data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength},[n.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"abort",value:function(){this.buffer_=[];this.bufferSize_=0;this.mediaSource_.swfObj.vjs_abort();this.updating&&(this.updating=!1,this.trigger({type:"updateend"}))}},{key:"remove",value:function(n,t){if(e["default"](n,t,this.metadataTrack_),this.inbandTextTracks_)for(var i in this.inbandTextTracks_)e["default"](n,t,this.inbandTextTracks_[i]);this.trigger({type:"update"});this.trigger({type:"updateend"})}},{key:"receiveBuffer_",value:function(n){var t=this;tt["default"](this,this.mediaSource_,n);it.addTextTrackData(this,n.captions,n.metadata);h(function(){var i=t.convertTagsToData_(n);t.buffer_.length===0&&h(t.processBuffer_.bind(t));i&&(t.buffer_.push(i),t.bufferSize_+=i.byteLength)})}},{key:"processBuffer_",value:function(){var r=this,t=s["default"].BYTES_PER_CHUNK,n,u,e,i,o;if(!this.buffer_.length){this.updating!==!1&&(this.updating=!1,this.trigger({type:"updateend"}));return}for(n=this.buffer_[0].subarray(0,t),n.byteLength<t||this.buffer_[0].byteLength===t?this.buffer_.shift():this.buffer_[0]=this.buffer_[0].subarray(t),this.bufferSize_-=n.byteLength,u=[],e=n.byteLength,i=0;i<e;i++)u.push(String.fromCharCode(n[i]));o=f["default"].btoa(u.join(""));f["default"][this.flashEncodedDataName_]=function(){return h(r.processBuffer_.bind(r)),delete f["default"][r.flashEncodedDataName_],o};this.mediaSource_.swfObj.vjs_appendChunkReady(this.flashEncodedDataName_)}},{key:"convertTagsToData_",value:function(n){var p=0,f=this.mediaSource_.tech_,i=0,a=undefined,e=n.tags.videoTags,s=n.tags.audioTags,w,b,t,l,k,o,h,c,r,u,y;if(isNaN(this.basePtsOffset_)&&(e.length||s.length)&&(w=e[0]||{pts:Infinity},b=s[0]||{pts:Infinity},this.basePtsOffset_=Math.min(b.pts,w.pts)),f.seeking()&&(this.videoBufferEnd_=NaN,this.audioBufferEnd_=NaN),isNaN(this.videoBufferEnd_)?(f.buffered().length&&(i=f.buffered().end(0)-this.timestampOffset),f.seeking()&&(i=Math.max(i,f.currentTime()-this.timestampOffset)),i*=1e3,i+=this.basePtsOffset_):i=this.videoBufferEnd_+.1,t=e.length,t&&e[t-1].pts>=i){while(--t)if((l=e[t],!(l.pts>i))&&(l.keyFrame||l.metaDataTag))break;while(t){if(k=e[t-1],!k.metaDataTag)break;t--}}for(o=e.slice(t),h=undefined,h=isNaN(this.audioBufferEnd_)?i:this.audioBufferEnd_+.1,o.length&&(h=Math.min(h,o[0].pts)),t=0;t<s.length;){if(s[t].pts>=h)break;t++}if(c=s.slice(t),c.length&&(this.audioBufferEnd_=c[c.length-1].pts),o.length&&(this.videoBufferEnd_=o[o.length-1].pts),r=this.getOrderedTags_(o,c),r.length!==0){if(r[0].pts<i&&f.seeking()){var d=f.currentTime(),g=(i-r[0].pts)/1e3,v=d-g;v<1/30&&(v=0);try{this.mediaSource_.swfObj.vjs_adjustCurrentTime(v)}catch(nt){}}for(u=0;u<r.length;u++)p+=r[u].bytes.byteLength;for(a=new Uint8Array(p),u=0,y=0;u<r.length;u++)a.set(r[u].bytes,y),y+=r[u].bytes.byteLength;return a}}},{key:"getOrderedTags_",value:function(n,t){for(var i=undefined,r=[];n.length||t.length;)i=n.length?t.length?t[0].dts<n[0].dts?t.shift():n.shift():n.shift():t.shift(),r.push(i);return r}},{key:"onHlsReset_",value:function(){this.transmuxer_.postMessage({action:"resetCaptions"})}}]),t}(o["default"].EventTarget);i["default"]=ht;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./add-text-track-data":64,"./create-text-tracks-if-necessary":66,"./flash-constants":67,"./flash-transmuxer-worker":70,"./remove-cues-from-track":72,"global/window":32,"mux.js/lib/flv":46,webwackify:76}],70:[function(n,t,i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function o(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var r;Object.defineProperty(i,"__esModule",{value:!0});r=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var s=n("global/window"),f=u(s),h=n("mux.js/lib/flv"),c=u(h),l=function(n){n.on("data",function(n){f["default"].postMessage({action:"data",segment:n})});n.on("done",function(){f["default"].postMessage({action:"done"})})},e=function(){function n(t){o(this,n);this.options=t||{};this.init()}return r(n,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose();this.transmuxer=new c["default"].Transmuxer(this.options);l(this.transmuxer)}},{key:"push",value:function(n){var t=new Uint8Array(n.data,n.byteOffset,n.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function(){this.init()}},{key:"flush",value:function(){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}}]),n}(),a=function(n){n.onmessage=function(n){if(n.data.action==="init"&&n.data.options){this.messageHandlers=new e(n.data.options);return}this.messageHandlers||(this.messageHandlers=new e);n.data&&n.data.action&&n.data.action!=="init"&&this.messageHandlers[n.data.action]&&this.messageHandlers[n.data.action](n.data)}};i["default"]=function(n){return new a(n)};t.exports=i["default"]},{"global/window":32,"mux.js/lib/flv":46}],71:[function(n,t,i){(function(r){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function h(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function c(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var o,s;Object.defineProperty(i,"__esModule",{value:!0});o=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();s=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var l=n("global/window"),a=u(l),v=n("global/document"),y=u(v),p=typeof window!="undefined"?window.videojs:typeof r!="undefined"?r.videojs:null,e=u(p),w=n("./virtual-source-buffer"),b=u(w),k=n("./add-text-track-data"),f=n("./codec-utils"),d=function(n){function t(){var n=this,i;h(this,t);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this);i=undefined;this.nativeMediaSource_=new a["default"].MediaSource;for(i in this.nativeMediaSource_)i in t.prototype||typeof this.nativeMediaSource_[i]!="function"||(this[i]=this.nativeMediaSource_[i].bind(this.nativeMediaSource_));this.duration_=NaN;Object.defineProperty(this,"duration",{get:function(){return this.duration_===Infinity?this.duration_:this.nativeMediaSource_.duration},set:function(n){if(this.duration_=n,n!==Infinity){this.nativeMediaSource_.duration=n;return}}});Object.defineProperty(this,"seekable",{get:function(){return this.duration_===Infinity?e["default"].createTimeRanges([[0,this.nativeMediaSource_.duration]]):this.nativeMediaSource_.seekable}});Object.defineProperty(this,"readyState",{get:function(){return this.nativeMediaSource_.readyState}});Object.defineProperty(this,"activeSourceBuffers",{get:function(){return this.activeSourceBuffers_}});this.sourceBuffers=[];this.activeSourceBuffers_=[];this.updateActiveSourceBuffers_=function(){var t,u,i,r,f;if(n.activeSourceBuffers_.length=0,n.sourceBuffers.length===1){t=n.sourceBuffers[0];t.appendAudioInitSegment_=!0;t.audioDisabled_=!t.audioCodec_;n.activeSourceBuffers_.push(t);return}for(u=!1,i=!0,r=0;r<n.player_.audioTracks().length;r++)if(f=n.player_.audioTracks()[r],f.enabled&&f.kind!=="main"){u=!0;i=!1;break}n.sourceBuffers.forEach(function(t){if(t.appendAudioInitSegment_=!0,t.videoCodec_&&t.audioCodec_)t.audioDisabled_=u;else if(t.videoCodec_&&!t.audioCodec_)t.audioDisabled_=!0,i=!1;else if(!t.videoCodec_&&t.audioCodec_&&(t.audioDisabled_=i,i))return;n.activeSourceBuffers_.push(t)})};this.onPlayerMediachange_=function(){n.sourceBuffers.forEach(function(n){n.appendAudioInitSegment_=!0})};this.onHlsReset_=function(){n.sourceBuffers.forEach(function(n){n.transmuxer_&&n.transmuxer_.postMessage({action:"resetCaptions"})})};this.onHlsSegmentTimeMapping_=function(t){n.sourceBuffers.forEach(function(n){return n.timeMapping_=t.mapping})};["sourceopen","sourceclose","sourceended"].forEach(function(n){this.nativeMediaSource_.addEventListener(n,this.trigger.bind(this))},this);this.on("sourceopen",function(){var t=y["default"].querySelector('[src="'+n.url_+'"]');if(t){n.player_=e["default"](t.parentNode);n.player_.tech_.on("hls-reset",n.onHlsReset_);n.player_.tech_.on("hls-segment-time-mapping",n.onHlsSegmentTimeMapping_);if(n.player_.audioTracks&&n.player_.audioTracks()){n.player_.audioTracks().on("change",n.updateActiveSourceBuffers_);n.player_.audioTracks().on("addtrack",n.updateActiveSourceBuffers_);n.player_.audioTracks().on("removetrack",n.updateActiveSourceBuffers_)}n.player_.on("mediachange",n.onPlayerMediachange_)}});this.on("sourceended",function(){for(var r,t,u=k.durationOfVideo(n.duration),i=0;i<n.sourceBuffers.length;i++)r=n.sourceBuffers[i],t=r.metadataTrack_&&r.metadataTrack_.cues,t&&t.length&&(t[t.length-1].endTime=u)});this.on("sourceclose",function(){(this.sourceBuffers.forEach(function(n){n.transmuxer_&&n.transmuxer_.terminate()}),this.sourceBuffers.length=0,this.player_)&&(this.player_.audioTracks&&this.player_.audioTracks()&&(this.player_.audioTracks().off("change",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("addtrack",this.updateActiveSourceBuffers_),this.player_.audioTracks().off("removetrack",this.updateActiveSourceBuffers_)),this.player_.el_&&(this.player_.off("mediachange",this.onPlayerMediachange_),this.player_.tech_.off("hls-reset",this.onHlsReset_),this.player_.tech_.off("hls-segment-time-mapping",this.onHlsSegmentTimeMapping_)))})}return c(t,n),o(t,[{key:"addSeekableRange_",value:function(n,t){var i=undefined;if(this.duration!==Infinity){i=new Error("MediaSource.addSeekableRange() can only be invoked when the duration is Infinity");i.name="InvalidStateError";i.code=11;throw i;}(t>this.nativeMediaSource_.duration||isNaN(this.nativeMediaSource_.duration))&&(this.nativeMediaSource_.duration=t)}},{key:"addSourceBuffer",value:function(n){var i=undefined,r=f.parseContentType(n),t;return/^(video|audio)\/mp2t$/i.test(r.type)?(t=[],r.parameters&&r.parameters.codecs&&(t=r.parameters.codecs.split(","),t=f.translateLegacyCodecs(t),t=t.filter(function(n){return f.isAudioCodec(n)||f.isVideoCodec(n)})),t.length===0&&(t=["avc1.4d400d","mp4a.40.2"]),i=new b["default"](this,t),this.sourceBuffers.length!==0&&(this.sourceBuffers[0].createRealSourceBuffers_(),i.createRealSourceBuffers_(),this.sourceBuffers[0].audioDisabled_=!0)):i=this.nativeMediaSource_.addSourceBuffer(n),this.sourceBuffers.push(i),i}}]),t}(e["default"].EventTarget);i["default"]=d;t.exports=i["default"]}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./virtual-source-buffer":75,"global/document":31,"global/window":32}],72:[function(n,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=function(n,t,i){var u=undefined,r=undefined;if(i&&i.cues)for(u=i.cues.length;u--;)r=i.cues[u],r.startTime<=t&&r.endTime>=n&&i.removeCue(r)};i["default"]=r;t.exports=i["default"]},{}],73:[function(n,t,i){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}function o(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}var u;Object.defineProperty(i,"__esModule",{value:!0});u=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();var s=n("global/window"),r=f(s),h=n("mux.js/lib/mp4"),c=f(h),l=function(n){n.on("data",function(n){var i=n.initSegment,t;n.initSegment={data:i.buffer,byteOffset:i.byteOffset,byteLength:i.byteLength};t=n.data;n.data=t.buffer;r["default"].postMessage({action:"data",segment:n,byteOffset:t.byteOffset,byteLength:t.byteLength},[n.data])});if(n.captionStream)n.captionStream.on("data",function(n){r["default"].postMessage({action:"caption",data:n})});n.on("done",function(){r["default"].postMessage({action:"done"})});n.on("gopInfo",function(n){r["default"].postMessage({action:"gopInfo",gopInfo:n})})},e=function(){function n(t){o(this,n);this.options=t||{};this.init()}return u(n,[{key:"init",value:function(){this.transmuxer&&this.transmuxer.dispose();this.transmuxer=new c["default"].Transmuxer(this.options);l(this.transmuxer)}},{key:"push",value:function(n){var t=new Uint8Array(n.data,n.byteOffset,n.byteLength);this.transmuxer.push(t)}},{key:"reset",value:function(){this.init()}},{key:"setTimestampOffset",value:function(n){var t=n.timestampOffset||0;this.transmuxer.setBaseMediaDecodeTime(Math.round(t*9e4))}},{key:"setAudioAppendStart",value:function(n){this.transmuxer.setAudioAppendStart(Math.ceil(n.appendStart*9e4))}},{key:"flush",value:function(){this.transmuxer.flush()}},{key:"resetCaptions",value:function(){this.transmuxer.resetCaptions()}},{key:"alignGopsWith",value:function(n){this.transmuxer.alignGopsWith(n.gopsToAlignWith.slice())}}]),n}(),a=function(n){n.onmessage=function(n){if(n.data.action==="init"&&n.data.options){this.messageHandlers=new e(n.data.options);return}this.messageHandlers||(this.messageHandlers=new e);n.data&&n.data.action&&n.data.action!=="init"&&this.messageHandlers[n.data.action]&&this.messageHandlers[n.data.action](n.data)}};i["default"]=function(n){return new a(n)};t.exports=i["default"]},{"global/window":32,"mux.js/lib/mp4":55}],74:[function(n,t,i){(function(t){"use strict";function f(n){return n&&n.__esModule?n:{"default":n}}var s;Object.defineProperty(i,"__esModule",{value:!0});var v=n("global/window"),u=f(v),y=n("./flash-media-source"),h=f(y),p=n("./html-media-source"),c=f(p),w=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,r=f(w),l=0,b={mode:"auto"};r["default"].mediaSources={};var a=function(n,t){var i=r["default"].mediaSources[n];if(i)i.trigger({type:"sourceopen",swfId:t});else throw new Error("Media Source not found (Video.js)");},o=function(){return!!u["default"].MediaSource&&!!u["default"].MediaSource.isTypeSupported&&u["default"].MediaSource.isTypeSupported('video/mp4;codecs="avc1.4d400d,mp4a.40.2"')},e=function(n){var t=r["default"].mergeOptions(b,n);if(this.MediaSource={open:a,supportsNativeMediaSources:o},t.mode==="html5"||t.mode==="auto"&&o())return new c["default"];if(r["default"].getTech("Flash"))return new h["default"];throw new Error("Cannot use Flash or Html5 to create a MediaSource for this video");};i.MediaSource=e;e.open=a;e.supportsNativeMediaSources=o;s={createObjectURL:function(n){var t=undefined;return n instanceof c["default"]?(t=u["default"].URL.createObjectURL(n.nativeMediaSource_),n.url_=t,t):(n instanceof h["default"])?(t="blob:vjs-media-source/"+l,l++,r["default"].mediaSources[t]=n,t):(t=u["default"].URL.createObjectURL(n),n.url_=t,t)}};i.URL=s;r["default"].MediaSource=e;r["default"].URL=s}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./flash-media-source":68,"./html-media-source":71,"global/window":32}],75:[function(n,t,i){(function(t){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function v(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function y(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var o,s,f,e,a;Object.defineProperty(i,"__esModule",{value:!0});o=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}();s=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}};var p=typeof window!="undefined"?window.videojs:typeof t!="undefined"?t.videojs:null,r=u(p),w=n("./create-text-tracks-if-necessary"),b=u(w),k=n("./remove-cues-from-track"),h=u(k),d=n("./add-text-track-data"),g=n("webwackify"),nt=u(g),tt=n("./transmuxer-worker"),it=u(tt),c=n("./codec-utils"),rt=function(){var t=undefined;try{t=n.resolve("./transmuxer-worker")}catch(i){}return t},ut=function(n,t){var i=n.addSourceBuffer(t),r=Object.create(null),u,f;r.updating=!1;r.realBuffer_=i;u=function(n){typeof i[n]=="function"?r[n]=function(){return i[n].apply(i,arguments)}:typeof r[n]=="undefined"&&Object.defineProperty(r,n,{get:function(){return i[n]},set:function(t){return i[n]=t}})};for(f in i)u(f);return r},l=function(n,t,i){if(!t||!n.length)return[];for(var u=Math.ceil((t.currentTime()-i+3)*9e4),r=undefined,r=0;r<n.length;r++)if(n[r].pts>u)break;return n.slice(r)};i.gopsSafeToAlignWith=l;f=function(n,t,i){if(!t.length)return n;if(i)return t.slice();var u=t[0].pts,r=0;for(r;r<n.length;r++)if(n[r].pts>=u)break;return n.slice(0,r).concat(t)};i.updateGopBuffer=f;e=function(n,t,i,r){for(var o=Math.ceil((t-r)*9e4),s=Math.ceil((i-r)*9e4),e=n.slice(),f=n.length,u;f--;)if(n[f].pts<=s)break;if(f===-1)return e;for(u=f+1;u--;)if(n[u].pts<=o)break;return u=Math.max(u,0),e.splice(u,f-u+1),e};i.removeGopBuffer=e;a=function(n){function t(n,i){var u=this,f;v(this,t);s(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,r["default"].EventTarget);this.timestampOffset_=0;this.pendingBuffers_=[];this.bufferUpdating_=!1;this.mediaSource_=n;this.codecs_=i;this.audioCodec_=null;this.videoCodec_=null;this.audioDisabled_=!1;this.appendAudioInitSegment_=!0;this.gopBuffer_=[];this.timeMapping_=0;this.safeAppend_=r["default"].browser.IE_VERSION>=11;f={remux:!1,alignGopsAtEnd:this.safeAppend_};this.codecs_.forEach(function(n){c.isAudioCodec(n)?u.audioCodec_=n:c.isVideoCodec(n)&&(u.videoCodec_=n)});this.transmuxer_=nt["default"](it["default"],rt());this.transmuxer_.postMessage({action:"init",options:f});this.transmuxer_.onmessage=function(n){return n.data.action==="data"?u.data_(n):n.data.action==="done"?u.done_(n):n.data.action==="gopInfo"?u.appendGopInfo_(n):void 0};Object.defineProperty(this,"timestampOffset",{get:function(){return this.timestampOffset_},set:function(n){typeof n=="number"&&n>=0&&(this.timestampOffset_=n,this.appendAudioInitSegment_=!0,this.gopBuffer_.length=0,this.timeMapping_=0,this.transmuxer_.postMessage({action:"setTimestampOffset",timestampOffset:n}))}});Object.defineProperty(this,"appendWindowStart",{get:function(){return(this.videoBuffer_||this.audioBuffer_).appendWindowStart},set:function(n){this.videoBuffer_&&(this.videoBuffer_.appendWindowStart=n);this.audioBuffer_&&(this.audioBuffer_.appendWindowStart=n)}});Object.defineProperty(this,"updating",{get:function(){return!!(this.bufferUpdating_||!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.updating||this.videoBuffer_&&this.videoBuffer_.updating)}});Object.defineProperty(this,"buffered",{get:function(){var i=null,u=null,f=0,t=[],s=[];if(!this.videoBuffer_&&!this.audioBuffer_)return r["default"].createTimeRange();if(!this.videoBuffer_)return this.audioBuffer_.buffered;if(!this.audioBuffer_||this.audioDisabled_)return this.videoBuffer_.buffered;if(this.videoBuffer_.buffered.length===0&&this.audioBuffer_.buffered.length===0)return r["default"].createTimeRange();for(var e=this.videoBuffer_.buffered,o=this.audioBuffer_.buffered,n=e.length;n--;)t.push({time:e.start(n),type:"start"}),t.push({time:e.end(n),type:"end"});for(n=o.length;n--;)t.push({time:o.start(n),type:"start"}),t.push({time:o.end(n),type:"end"});for(t.sort(function(n,t){return n.time-t.time}),n=0;n<t.length;n++)t[n].type==="start"?(f++,f===2&&(i=t[n].time)):t[n].type==="end"&&(f--,f===1&&(u=t[n].time)),i!==null&&u!==null&&(s.push([i,u]),i=null,u=null);return r["default"].createTimeRanges(s)}})}return y(t,n),o(t,[{key:"data_",value:function(n){var t=n.data.segment;t.data=new Uint8Array(t.data,n.data.byteOffset,n.data.byteLength);t.initSegment=new Uint8Array(t.initSegment.data,t.initSegment.byteOffset,t.initSegment.byteLength);b["default"](this,this.mediaSource_,t);this.pendingBuffers_.push(t);return}},{key:"done_",value:function(){if(this.mediaSource_.readyState==="closed"){this.pendingBuffers_.length=0;return}this.processPendingSegments_();return}},{key:"createRealSourceBuffers_",value:function(){var n=this,t=["audio","video"];t.forEach(function(i){var r,u,f;n[i+"Codec_"]&&(n[i+"Buffer_"]||(r=null,n.mediaSource_[i+"Buffer_"]?(r=n.mediaSource_[i+"Buffer_"],r.updating=!1):(u=i+"Codec_",f=i+'/mp4;codecs="'+n[u]+'"',r=ut(n.mediaSource_.nativeMediaSource_,f),n.mediaSource_[i+"Buffer_"]=r),n[i+"Buffer_"]=r,["update","updatestart","updateend"].forEach(function(u){r.addEventListener(u,function(){if(i!=="audio"||!n.audioDisabled_){u==="updateend"&&(n[i+"Buffer_"].updating=!1);var r=t.every(function(t){return t==="audio"&&n.audioDisabled_?!0:i!==t&&n[t+"Buffer_"]&&n[t+"Buffer_"].updating?!1:!0});if(r)return n.trigger(u)}})})))})}},{key:"appendBuffer",value:function(n){if(this.bufferUpdating_=!0,this.audioBuffer_&&this.audioBuffer_.buffered.length){var t=this.audioBuffer_.buffered;this.transmuxer_.postMessage({action:"setAudioAppendStart",appendStart:t.end(t.length-1)})}this.videoBuffer_&&this.transmuxer_.postMessage({action:"alignGopsWith",gopsToAlignWith:l(this.gopBuffer_,this.mediaSource_.player_,this.timeMapping_)});this.transmuxer_.postMessage({action:"push",data:n.buffer,byteOffset:n.byteOffset,byteLength:n.byteLength},[n.buffer]);this.transmuxer_.postMessage({action:"flush"})}},{key:"appendGopInfo_",value:function(n){this.gopBuffer_=f(this.gopBuffer_,n.data.gopInfo,this.safeAppend_)}},{key:"remove",value:function(n,t){if(this.videoBuffer_&&(this.videoBuffer_.updating=!0,this.videoBuffer_.remove(n,t),this.gopBuffer_=e(this.gopBuffer_,n,t,this.timeMapping_)),!this.audioDisabled_&&this.audioBuffer_&&(this.audioBuffer_.updating=!0,this.audioBuffer_.remove(n,t)),h["default"](n,t,this.metadataTrack_),this.inbandTextTracks_)for(var i in this.inbandTextTracks_)h["default"](n,t,this.inbandTextTracks_[i])}},{key:"processPendingSegments_",value:function(){var n={video:{segments:[],bytes:0},audio:{segments:[],bytes:0},captions:[],metadata:[]},t;n=this.pendingBuffers_.reduce(function(n,t){var i=t.type,r=t.data,u=t.initSegment;return n[i].segments.push(r),n[i].bytes+=r.byteLength,n[i].initSegment=u,t.captions&&(n.captions=n.captions.concat(t.captions)),t.info&&(n[i].info=t.info),t.metadata&&(n.metadata=n.metadata.concat(t.metadata)),n},n);this.videoBuffer_||this.audioBuffer_||(n.video.bytes===0&&(this.videoCodec_=null),n.audio.bytes===0&&(this.audioCodec_=null),this.createRealSourceBuffers_());n.audio.info&&this.mediaSource_.trigger({type:"audioinfo",info:n.audio.info});n.video.info&&this.mediaSource_.trigger({type:"videoinfo",info:n.video.info});this.appendAudioInitSegment_&&(!this.audioDisabled_&&this.audioBuffer_&&(n.audio.segments.unshift(n.audio.initSegment),n.audio.bytes+=n.audio.initSegment.byteLength),this.appendAudioInitSegment_=!1);t=!1;this.videoBuffer_&&n.video.bytes?(n.video.segments.unshift(n.video.initSegment),n.video.bytes+=n.video.initSegment.byteLength,this.concatAndAppendSegments_(n.video,this.videoBuffer_),d.addTextTrackData(this,n.captions,n.metadata)):this.videoBuffer_&&(this.audioDisabled_||!this.audioBuffer_)&&(t=!0);!this.audioDisabled_&&this.audioBuffer_&&this.concatAndAppendSegments_(n.audio,this.audioBuffer_);this.pendingBuffers_.length=0;t&&this.trigger("updateend");this.bufferUpdating_=!1}},{key:"concatAndAppendSegments_",value:function(n,t){var r=0,i=undefined;if(n.bytes){i=new Uint8Array(n.bytes);n.segments.forEach(function(n){i.set(n,r);r+=n.byteLength});try{t.updating=!0;t.appendBuffer(i)}catch(u){this.mediaSource_.player_&&this.mediaSource_.player_.error({code:-3,type:"APPEND_BUFFER_ERR",message:u.message,originalError:u})}}}},{key:"abort",value:function(){this.videoBuffer_&&this.videoBuffer_.abort();!this.audioDisabled_&&this.audioBuffer_&&this.audioBuffer_.abort();this.transmuxer_&&this.transmuxer_.postMessage({action:"reset"});this.pendingBuffers_.length=0;this.bufferUpdating_=!1}}]),t}(r["default"].EventTarget);i["default"]=a}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./add-text-track-data":64,"./codec-utils":65,"./create-text-tracks-if-necessary":66,"./remove-cues-from-track":72,"./transmuxer-worker":73,webwackify:76}],76:[function(n,t){var u=arguments[3],i=arguments[4],f=arguments[5],r=JSON.stringify,e=!1,h=function(n){function t(r){if(i[r])return i[r].exports;var u=i[r]={i:r,l:!1,exports:{}};return n[r].call(u.exports,u,u.exports,t),u.l=!0,u.exports}var i={};return t.m=n,t.c=i,t.d=function(n,i,r){t.o(n,i)||Object.defineProperty(n,i,{configurable:!1,enumerable:!0,get:r})},t.n=function(n){var i=n&&n.__esModule?function(){return n["default"]}:function(){return n};return t.d(i,"a",i),i},t.o=function(n,t){return Object.prototype.hasOwnProperty.call(n,t)},t.p="",t(t.s=entryModule)},o,s;typeof u=="undefined"&&(e=!0,u=h,i=__webpack_modules__);o=function(n){for(var h,c,o,l,a,s=Object.keys(f),t,e=0;e<s.length;e++)if(o=s[e],h=f[o].exports,h===n||h&&h.default===n){t=o;break}if(!t){for(t=Math.floor(Math.pow(16,8)*Math.random()).toString(16),c={},e=0;e<s.length;e++)o=s[e],c[o]=o;i[t]=["function(require,module,exports){"+n+"(self); }",c]}return l=Math.floor(Math.pow(16,8)*Math.random()).toString(16),a={},a[t]=t,i[l]=["function(require,module,exports){var f = require("+r(t)+");(f.default ? f.default : f)(self);}",a],"("+u+")({"+Object.keys(i).map(function(n){return r(n)+":["+i[n][0]+","+r(i[n][1])+"]"}).join(",")+"},{},["+r(l)+"])"};s=function(n,t){var h=typeof t=="string",f,e,o,s,c;return f=h?{}:[],Object.keys(i).forEach(function(n){i[n]&&(f[n]=i[n].toString())}),e=__webpack_require__(t),e&&(e===n||e.default===n)||(o=f[t],f[t]=o.substring(0,o.length-1)+"\n"+n.name+"();\n}"),h?(t=r(t),c=Object.keys(f).map(function(n){return r(n)+":"+f[n]}),s="{"+c.join(",")+"}"):s="["+f.join(",")+"]","var fn = ("+u.toString().replace("entryModule",t)+")("+s+');\n(typeof fn === "function") && fn(self);'};t.exports=function(n,t){var u=e?s(n,t):o(n);var f=new Blob([u],{type:"text/javascript"}),h=window.URL||window.webkitURL||window.mozURL||window.msURL,i=h.createObjectURL(f),r=new Worker(i);return r.objectURL=i,r}},{}],77:[function(n,t){(function(i){"use strict";function u(n){return n&&n.__esModule?n:{"default":n}}function nt(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function");}function tt(n,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function, not "+typeof t);n.prototype=Object.create(t&&t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}});t&&(Object.setPrototypeOf?Object.setPrototypeOf(n,t):n.__proto__=t)}var g=function(){function n(n,t){for(var i,r=0;r<t.length;r++)i=t[r],i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,i.key,i)}return function(t,i,r){return i&&n(t.prototype,i),r&&n(t,r),t}}(),y=function(n,t,i){var e=!0,r,f,o;n:while(e){var u=n,s=t,h=i;if(e=!1,u===null&&(u=Function.prototype),r=Object.getOwnPropertyDescriptor(u,s),r===undefined){if(f=Object.getPrototypeOf(u),f===null)return undefined;n=f;t=s;i=h;e=!0;r=f=undefined;continue n}else return"value"in r?r.value:(o=r.get,o===undefined)?undefined:o.call(h)}},it=n("global/document"),o=u(it),rt=n("./playlist-loader"),ut=u(rt),ft=n("./playlist"),et=u(ft),ot=n("./xhr"),p=u(ot),h=n("aes-decrypter"),st=n("./bin-utils"),ht=u(st),c=n("videojs-contrib-media-sources"),ct=n("m3u8-parser"),lt=u(ct),at=typeof window!="undefined"?window.videojs:typeof i!="undefined"?i.videojs:null,r=u(at),vt=n("./master-playlist-controller"),yt=n("./config"),w=u(yt),pt=n("./rendition-mixin"),wt=u(pt),bt=n("global/window"),kt=u(bt),dt=n("./playback-watcher"),gt=u(dt),ni=n("./reload-source-on-error"),b=u(ni),s=n("./playlist-selectors.js"),f={PlaylistLoader:ut["default"],Playlist:et["default"],Decrypter:h.Decrypter,AsyncStream:h.AsyncStream,decrypt:h.decrypt,utils:ht["default"],STANDARD_PLAYLIST_SELECTOR:s.lastBandwidthSelector,INITIAL_PLAYLIST_SELECTOR:s.lowestBitrateCompatibleVariantSelector,comparePlaylistBandwidth:s.comparePlaylistBandwidth,comparePlaylistResolution:s.comparePlaylistResolution,xhr:p["default"]()},k=4194304,l,d,v;["GOAL_BUFFER_LENGTH","MAX_GOAL_BUFFER_LENGTH","GOAL_BUFFER_LENGTH_RATE","BUFFER_LOW_WATER_LINE","MAX_BUFFER_LOW_WATER_LINE","BUFFER_LOW_WATER_LINE_RATE","BANDWIDTH_VARIANCE"].forEach(function(n){Object.defineProperty(f,n,{get:function(){return r["default"].log.warn("using Hls."+n+" is UNSAFE be sure you know what you are doing"),w["default"][n]},set:function(t){if(r["default"].log.warn("using Hls."+n+" is UNSAFE be sure you know what you are doing"),typeof t!="number"||t<0){r["default"].log.warn("value of Hls."+n+" must be greater than or equal to 0");return}w["default"][n]=t}})});l=function(n,t){for(var u=t.media(),r=-1,i=0;i<n.length;i++)if(n[i].id===u.uri){r=i;break}n.selectedIndex_=r;n.trigger({selectedIndex:r,type:"change"})};d=function(n,t){t.representations().forEach(function(t){n.addQualityLevel(t)});l(n,t.playlists)};f.canPlaySource=function(){return r["default"].log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};f.supportsNativeHls=function(){var t=o["default"].createElement("video"),n;return r["default"].getTech("Html5").isSupported()?(n=["application/vnd.apple.mpegurl","audio/mpegurl","audio/x-mpegurl","application/x-mpegurl","video/x-mpegurl","video/mpegurl","application/mpegurl"],n.some(function(n){return/maybe|probably/i.test(t.canPlayType(n))})):!1}();f.isSupported=function(){return r["default"].log.warn("HLS is no longer a tech. Please remove it from your player's techOrder.")};var ti=r["default"].getComponent("Component"),a=function(n){function t(n,i,u){var f=this,e;if(nt(this,t),y(Object.getPrototypeOf(t.prototype),"constructor",this).call(this,i,u.hls),i.options_&&i.options_.playerId&&(e=r["default"](i.options_.playerId),e.hasOwnProperty("hls")||Object.defineProperty(e,"hls",{get:function(){return r["default"].log.warn("player.hls is deprecated. Use player.tech_.hls instead."),i.trigger({type:"usage",name:"hls-player-access"}),f}})),this.tech_=i,this.source_=n,this.stats={},this.ignoreNextSeekingEvent_=!1,this.setOptions_(),this.options_.overrideNative&&(i.featuresNativeVideoTracks||i.featuresNativeAudioTracks))throw new Error("Overriding native HLS requires emulated tracks. See https://git.io/vMpjB");this.on(o["default"],["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],function(){var n=o["default"].fullscreenElement||o["default"].webkitFullscreenElement||o["default"].mozFullScreenElement||o["default"].msFullscreenElement;n&&n.contains(f.tech_.el())&&f.masterPlaylistController_.fastQualityChange_()});this.on(this.tech_,"seeking",function(){if(this.ignoreNextSeekingEvent_){this.ignoreNextSeekingEvent_=!1;return}this.setCurrentTime(this.tech_.currentTime())});this.on(this.tech_,"error",function(){this.masterPlaylistController_&&this.masterPlaylistController_.pauseLoading()});this.on(this.tech_,"play",this.play)}return tt(t,n),g(t,[{key:"setOptions_",value:function(){var n=this;this.options_.withCredentials=this.options_.withCredentials||!1;typeof this.options_.blacklistDuration!="number"&&(this.options_.blacklistDuration=300);typeof this.options_.bandwidth!="number"&&(this.options_.bandwidth=k);this.options_.enableLowInitialPlaylist=this.options_.enableLowInitialPlaylist&&this.options_.bandwidth===k;["withCredentials","bandwidth"].forEach(function(t){typeof n.source_[t]!="undefined"&&(n.options_[t]=n.source_[t])});this.bandwidth=this.options_.bandwidth}},{key:"src",value:function(n){var t=this;if(n){this.setOptions_();this.options_.url=this.source_.src;this.options_.tech=this.tech_;this.options_.externHls=f;this.masterPlaylistController_=new vt.MasterPlaylistController(this.options_);this.playbackWatcher_=new gt["default"](r["default"].mergeOptions(this.options_,{seekable:function(){return t.seekable()}}));this.masterPlaylistController_.on("error",function(){var n=r["default"].players[t.tech_.options_.playerId];n.error(t.masterPlaylistController_.error)});this.masterPlaylistController_.selectPlaylist=this.selectPlaylist?this.selectPlaylist.bind(this):f.STANDARD_PLAYLIST_SELECTOR.bind(this);this.masterPlaylistController_.selectInitialPlaylist=f.INITIAL_PLAYLIST_SELECTOR.bind(this);this.playlists=this.masterPlaylistController_.masterPlaylistLoader_;this.mediaSource=this.masterPlaylistController_.mediaSource;Object.defineProperties(this,{selectPlaylist:{get:function(){return this.masterPlaylistController_.selectPlaylist},set:function(n){this.masterPlaylistController_.selectPlaylist=n.bind(this)}},throughput:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.throughput.rate},set:function(n){this.masterPlaylistController_.mainSegmentLoader_.throughput.rate=n;this.masterPlaylistController_.mainSegmentLoader_.throughput.count=1}},bandwidth:{get:function(){return this.masterPlaylistController_.mainSegmentLoader_.bandwidth},set:function(n){this.masterPlaylistController_.mainSegmentLoader_.bandwidth=n;this.masterPlaylistController_.mainSegmentLoader_.throughput={rate:0,count:0}}},systemBandwidth:{get:function(){var t=1/(this.bandwidth||1),n=undefined;return n=this.throughput>0?1/this.throughput:0,Math.floor(1/(t+n))},set:function(){r["default"].log.error('The "systemBandwidth" property is read-only')}}});Object.defineProperties(this.stats,{bandwidth:{get:function(){return t.bandwidth||0},enumerable:!0},mediaRequests:{get:function(){return t.masterPlaylistController_.mediaRequests_()||0},enumerable:!0},mediaRequestsAborted:{get:function(){return t.masterPlaylistController_.mediaRequestsAborted_()||0},enumerable:!0},mediaRequestsTimedout:{get:function(){return t.masterPlaylistController_.mediaRequestsTimedout_()||0},enumerable:!0},mediaRequestsErrored:{get:function(){return t.masterPlaylistController_.mediaRequestsErrored_()||0},enumerable:!0},mediaTransferDuration:{get:function(){return t.masterPlaylistController_.mediaTransferDuration_()||0},enumerable:!0},mediaBytesTransferred:{get:function(){return t.masterPlaylistController_.mediaBytesTransferred_()||0},enumerable:!0},mediaSecondsLoaded:{get:function(){return t.masterPlaylistController_.mediaSecondsLoaded_()||0},enumerable:!0}});this.tech_.one("canplay",this.masterPlaylistController_.setupFirstPlay.bind(this.masterPlaylistController_));this.masterPlaylistController_.on("selectedinitialmedia",function(){wt["default"](t)});this.on(this.masterPlaylistController_,"progress",function(){this.tech_.trigger("progress")});this.on(this.masterPlaylistController_,"firstplay",function(){this.ignoreNextSeekingEvent_=!0});(this.tech_.ready(function(){return t.setupQualityLevels_()}),this.tech_.el())&&this.tech_.src(r["default"].URL.createObjectURL(this.masterPlaylistController_.mediaSource))}}},{key:"setupQualityLevels_",value:function(){var n=this,t=r["default"].players[this.tech_.options_.playerId];if(t&&t.qualityLevels){this.qualityLevels_=t.qualityLevels();this.masterPlaylistController_.on("selectedinitialmedia",function(){d(n.qualityLevels_,n)});this.playlists.on("mediachange",function(){l(n.qualityLevels_,n.playlists)})}}},{key:"play",value:function(){this.masterPlaylistController_.play()}},{key:"setCurrentTime",value:function(n){this.masterPlaylistController_.setCurrentTime(n)}},{key:"duration",value:function(){return this.masterPlaylistController_.duration()}},{key:"seekable",value:function(){return this.masterPlaylistController_.seekable()}},{key:"dispose",value:function(){this.playbackWatcher_&&this.playbackWatcher_.dispose();this.masterPlaylistController_&&this.masterPlaylistController_.dispose();this.qualityLevels_&&this.qualityLevels_.dispose();y(Object.getPrototypeOf(t.prototype),"dispose",this).call(this)}}]),t}(ti),e=function e(n){return{canHandleSource:function(t){var u=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],i=r["default"].mergeOptions(r["default"].options,u);return i.hls&&i.hls.mode&&i.hls.mode!==n?!1:e.canPlayType(t.type,i)},handleSource:function(t,i){var u=arguments.length<=2||arguments[2]===undefined?{}:arguments[2],f=r["default"].mergeOptions(r["default"].options,u,{hls:{mode:n}});return n==="flash"&&i.setTimeout(function(){i.trigger("loadstart")},1),i.hls=new a(t,i,f),i.hls.xhr=p["default"](),i.hls.src(t.src),i.hls},canPlayType:function(n){var t=arguments.length<=1||arguments[1]===undefined?{}:arguments[1],i=r["default"].mergeOptions(r["default"].options,t);return e.canPlayType(n,i)?"maybe":""}}};e.canPlayType=function(n,t){if(r["default"].browser.IE_VERSION&&r["default"].browser.IE_VERSION<=10)return!1;return!t.hls.overrideNative&&f.supportsNativeHls?!1:/^(audio|video|application)\/(x-|vnd\.apple\.)?mpegurl/i.test(n)};(typeof r["default"].MediaSource=="undefined"||typeof r["default"].URL=="undefined")&&(r["default"].MediaSource=c.MediaSource,r["default"].URL=c.URL);v=r["default"].getTech("Flash");c.MediaSource.supportsNativeMediaSources()&&r["default"].getTech("Html5").registerSourceHandler(e("html5"),0);kt["default"].Uint8Array&&v&&v.registerSourceHandler(e("flash"));r["default"].HlsHandler=a;r["default"].HlsSourceHandler=e;r["default"].Hls=f;r["default"].use||r["default"].registerComponent("Hls",f);r["default"].m3u8=lt["default"];r["default"].options.hls=r["default"].options.hls||{};r["default"].registerPlugin?r["default"].registerPlugin("reloadSourceOnError",b["default"]):r["default"].plugin("reloadSourceOnError",b["default"]);t.exports={Hls:f,HlsHandler:a,HlsSourceHandler:e}}).call(this,typeof global!="undefined"?global:typeof self!="undefined"?self:typeof window!="undefined"?window:{})},{"./bin-utils":2,"./config":3,"./master-playlist-controller":5,"./playback-watcher":8,"./playlist":11,"./playlist-loader":9,"./playlist-selectors.js":10,"./reload-source-on-error":13,"./rendition-mixin":14,"./xhr":21,"aes-decrypter":25,"global/document":31,"global/window":32,"m3u8-parser":33,"videojs-contrib-media-sources":74}]},{},[77])(77)});
/*
//# sourceMappingURL=videojs-contrib-hls.min.js.map
*/